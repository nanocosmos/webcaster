/*! nanoStream Webcaster
Copyright (c) 2023, nanocosmos gmbh
https://www.nanocosmos.de/support

LEGAL NOTICE:
This material is subject to the terms and conditions defined in
separate license conditions found at https://www.nanocosmos.de/terms or in a separate agreement.
All information contained herein is, and remains the property of nanocosmos GmbH and its suppliers if any.
The intellectual and technical concepts contained herein are proprietary to nanocosmos GmbH,
and are protected by trade secret or copyright law. Dissemination of this information or reproduction
of this material is strictly forbidden unless prior written permission is obtained from nanocosmos.
 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.WebcasterApiV6=t():e.WebcasterApiV6=t()}(this,()=>(()=>{"use strict";var e={132:(e,t,i)=>{i.r(t),i.d(t,{default:()=>ce});var n={};i.r(n),i.d(n,{fixNegotiationNeeded:()=>P,shimAddTrackRemoveTrack:()=>E,shimAddTrackRemoveTrackWithNative:()=>k,shimGetDisplayMedia:()=>S,shimGetSendersWithDtmf:()=>T,shimGetStats:()=>R,shimGetUserMedia:()=>b,shimMediaStream:()=>C,shimOnTrack:()=>w,shimPeerConnection:()=>O,shimSenderReceiverGetStats:()=>x});var r={};i.r(r),i.d(r,{shimAddTransceiver:()=>V,shimCreateAnswer:()=>U,shimCreateOffer:()=>B,shimGetDisplayMedia:()=>j,shimGetParameters:()=>Z,shimGetUserMedia:()=>M,shimOnTrack:()=>N,shimPeerConnection:()=>D,shimRTCDataChannel:()=>F,shimReceiverGetStats:()=>I,shimRemoveStream:()=>L,shimSenderGetStats:()=>A});var s={};i.r(s),i.d(s,{shimAudioContext:()=>Q,shimCallbacksAPI:()=>q,shimConstraints:()=>W,shimCreateOfferLegacy:()=>J,shimGetUserMedia:()=>G,shimLocalStreamsAPI:()=>$,shimRTCIceServerUrls:()=>K,shimRemoteStreamsAPI:()=>z,shimTrackEventTransceiver:()=>H});var a={};i.r(a),i.d(a,{removeExtmapAllowMixed:()=>re,shimAddIceCandidateNullOrEmpty:()=>se,shimConnectionState:()=>ne,shimMaxMessageSize:()=>te,shimParameterlessSetLocalDescription:()=>ae,shimRTCIceCandidate:()=>ee,shimSendThrowTypeError:()=>ie});let o=!0,c=!0;function d(e,t,i){const n=e.match(t);return n&&n.length>=i&&parseInt(n[i],10)}function l(e,t,i){if(!e.RTCPeerConnection)return;const n=e.RTCPeerConnection.prototype,r=n.addEventListener;n.addEventListener=function(e,n){if(e!==t)return r.apply(this,arguments);const s=e=>{const t=i(e);t&&(n.handleEvent?n.handleEvent(t):n(t))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(n,s),r.apply(this,[e,s])};const s=n.removeEventListener;n.removeEventListener=function(e,i){if(e!==t||!this._eventMap||!this._eventMap[t])return s.apply(this,arguments);if(!this._eventMap[t].has(i))return s.apply(this,arguments);const n=this._eventMap[t].get(i);return this._eventMap[t].delete(i),0===this._eventMap[t].size&&delete this._eventMap[t],0===Object.keys(this._eventMap).length&&delete this._eventMap,s.apply(this,[e,n])},Object.defineProperty(n,"on"+t,{get(){return this["_on"+t]},set(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}function u(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(o=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function p(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(c=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function h(){if("object"==typeof window){if(o)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}}function m(e,t){c&&console.warn(e+" is deprecated, please use "+t+" instead.")}function f(e){return"[object Object]"===Object.prototype.toString.call(e)}function g(e){return f(e)?Object.keys(e).reduce(function(t,i){const n=f(e[i]),r=n?g(e[i]):e[i],s=n&&!Object.keys(r).length;return void 0===r||s?t:Object.assign(t,{[i]:r})},{}):e}function v(e,t,i){t&&!i.has(t.id)&&(i.set(t.id,t),Object.keys(t).forEach(n=>{n.endsWith("Id")?v(e,e.get(t[n]),i):n.endsWith("Ids")&&t[n].forEach(t=>{v(e,e.get(t),i)})}))}function y(e,t,i){const n=i?"outbound-rtp":"inbound-rtp",r=new Map;if(null===t)return r;const s=[];return e.forEach(e=>{"track"===e.type&&e.trackIdentifier===t.id&&s.push(e)}),s.forEach(t=>{e.forEach(i=>{i.type===n&&i.trackId===t.id&&v(e,i,r)})}),r}const _=h;function b(e,t){const i=e&&e.navigator;if(!i.mediaDevices)return;const n=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;const t={};return Object.keys(e).forEach(i=>{if("require"===i||"advanced"===i||"mediaSource"===i)return;const n="object"==typeof e[i]?e[i]:{ideal:e[i]};void 0!==n.exact&&"number"==typeof n.exact&&(n.min=n.max=n.exact);const r=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==n.ideal){t.optional=t.optional||[];let e={};"number"==typeof n.ideal?(e[r("min",i)]=n.ideal,t.optional.push(e),e={},e[r("max",i)]=n.ideal,t.optional.push(e)):(e[r("",i)]=n.ideal,t.optional.push(e))}void 0!==n.exact&&"number"!=typeof n.exact?(t.mandatory=t.mandatory||{},t.mandatory[r("",i)]=n.exact):["min","max"].forEach(e=>{void 0!==n[e]&&(t.mandatory=t.mandatory||{},t.mandatory[r(e,i)]=n[e])})}),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},r=function(e,r){if(t.version>=61)return r(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"==typeof e.audio){const t=function(e,t,i){t in e&&!(i in e)&&(e[i]=e[t],delete e[t])};t((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),t(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=n(e.audio)}if(e&&"object"==typeof e.video){let s=e.video.facingMode;s=s&&("object"==typeof s?s:{ideal:s});const a=t.version<66;if(s&&("user"===s.exact||"environment"===s.exact||"user"===s.ideal||"environment"===s.ideal)&&(!i.mediaDevices.getSupportedConstraints||!i.mediaDevices.getSupportedConstraints().facingMode||a)){let t;if(delete e.video.facingMode,"environment"===s.exact||"environment"===s.ideal?t=["back","rear"]:"user"!==s.exact&&"user"!==s.ideal||(t=["front"]),t)return i.mediaDevices.enumerateDevices().then(i=>{let a=(i=i.filter(e=>"videoinput"===e.kind)).find(e=>t.some(t=>e.label.toLowerCase().includes(t)));return!a&&i.length&&t.includes("back")&&(a=i[i.length-1]),a&&(e.video.deviceId=s.exact?{exact:a.deviceId}:{ideal:a.deviceId}),e.video=n(e.video),_("chrome: "+JSON.stringify(e)),r(e)})}e.video=n(e.video)}return _("chrome: "+JSON.stringify(e)),r(e)},s=function(e){return t.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(i.getUserMedia=function(e,t,n){r(e,e=>{i.webkitGetUserMedia(e,t,e=>{n&&n(s(e))})})}.bind(i),i.mediaDevices.getUserMedia){const e=i.mediaDevices.getUserMedia.bind(i.mediaDevices);i.mediaDevices.getUserMedia=function(t){return r(t,t=>e(t).then(e=>{if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length)throw e.getTracks().forEach(e=>{e.stop()}),new DOMException("","NotFoundError");return e},e=>Promise.reject(s(e))))}}}function S(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&("function"==typeof t?e.navigator.mediaDevices.getDisplayMedia=function(i){return t(i).then(t=>{const n=i.video&&i.video.width,r=i.video&&i.video.height,s=i.video&&i.video.frameRate;return i.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:s||3}},n&&(i.video.mandatory.maxWidth=n),r&&(i.video.mandatory.maxHeight=r),e.navigator.mediaDevices.getUserMedia(i)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}function C(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function w(e){if("object"==typeof e&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=t=>{t.stream.addEventListener("addtrack",i=>{let n;n=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(e=>e.track&&e.track.id===i.track.id):{track:i.track};const r=new Event("track");r.track=i.track,r.receiver=n,r.transceiver={receiver:n},r.streams=[t.stream],this.dispatchEvent(r)}),t.stream.getTracks().forEach(i=>{let n;n=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(e=>e.track&&e.track.id===i.id):{track:i};const r=new Event("track");r.track=i,r.receiver=n,r.transceiver={receiver:n},r.streams=[t.stream],this.dispatchEvent(r)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else l(e,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function T(e){if("object"==typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const i=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){let r=i.apply(this,arguments);return r||(r=t(this,e),this._senders.push(r)),r};const n=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){n.apply(this,arguments);const t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}const i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._senders=this._senders||[],i.apply(this,[e]),e.getTracks().forEach(e=>{this._senders.push(t(this,e))})};const n=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._senders=this._senders||[],n.apply(this,[e]),e.getTracks().forEach(e=>{const t=this._senders.find(t=>t.track===e);t&&this._senders.splice(this._senders.indexOf(t),1)})}}else if("object"==typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function R(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,i,n]=arguments;if(arguments.length>0&&"function"==typeof e)return t.apply(this,arguments);if(0===t.length&&(0===arguments.length||"function"!=typeof e))return t.apply(this,[]);const r=function(e){const t={};return e.result().forEach(e=>{const i={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach(t=>{i[t]=e.stat(t)}),t[i.id]=i}),t},s=function(e){return new Map(Object.keys(e).map(t=>[t,e[t]]))};if(arguments.length>=2){const n=function(e){i(s(r(e)))};return t.apply(this,[n,e])}return new Promise((e,i)=>{t.apply(this,[function(t){e(s(r(t)))},i])}).then(i,n)}}function x(e){if(!("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e});const i=e.RTCPeerConnection.prototype.addTrack;i&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=i.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){const e=this;return this._pc.getStats().then(t=>y(t,e.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e}),l(e,"track",e=>(e.receiver._pc=e.srcElement,e)),e.RTCRtpReceiver.prototype.getStats=function(){const e=this;return this._pc.getStats().then(t=>y(t,e.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const e=arguments[0];let t,i,n;return this.getSenders().forEach(i=>{i.track===e&&(t?n=!0:t=i)}),this.getReceivers().forEach(t=>(t.track===e&&(i?n=!0:i=t),t.track===e)),n||t&&i?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):t?t.getStats():i?i.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function k(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(e=>this._shimmedLocalStreams[e][0])};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,i){if(!i)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const n=t.apply(this,arguments);return this._shimmedLocalStreams[i.id]?-1===this._shimmedLocalStreams[i.id].indexOf(n)&&this._shimmedLocalStreams[i.id].push(n):this._shimmedLocalStreams[i.id]=[i,n],n};const i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach(e=>{if(this.getSenders().find(t=>t.track===e))throw new DOMException("Track already exists.","InvalidAccessError")});const t=this.getSenders();i.apply(this,arguments);const n=this.getSenders().filter(e=>-1===t.indexOf(e));this._shimmedLocalStreams[e.id]=[e].concat(n)};const n=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],n.apply(this,arguments)};const r=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach(t=>{const i=this._shimmedLocalStreams[t].indexOf(e);-1!==i&&this._shimmedLocalStreams[t].splice(i,1),1===this._shimmedLocalStreams[t].length&&delete this._shimmedLocalStreams[t]}),r.apply(this,arguments)}}function E(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return k(e);const i=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const e=i.apply(this);return this._reverseStreams=this._reverseStreams||{},e.map(e=>this._reverseStreams[e.id])};const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach(e=>{if(this.getSenders().find(t=>t.track===e))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[t.id]){const i=new e.MediaStream(t.getTracks());this._streams[t.id]=i,this._reverseStreams[i.id]=t,t=i}n.apply(this,[t])};const r=e.RTCPeerConnection.prototype.removeStream;function s(e,t){let i=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(t=>{const n=e._reverseStreams[t],r=e._streams[n.id];i=i.replace(new RegExp(r.id,"g"),n.id)}),new RTCSessionDescription({type:t.type,sdp:i})}e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},r.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,i){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const n=[].slice.call(arguments,1);if(1!==n.length||!n[0].getTracks().find(e=>e===t))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(e=>e.track===t))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const r=this._streams[i.id];if(r)r.addTrack(t),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const n=new e.MediaStream([t]);this._streams[i.id]=n,this._reverseStreams[n.id]=i,this.addStream(n)}return this.getSenders().find(e=>e.track===t)},["createOffer","createAnswer"].forEach(function(t){const i=e.RTCPeerConnection.prototype[t],n={[t](){const e=arguments;return arguments.length&&"function"==typeof arguments[0]?i.apply(this,[t=>{const i=s(this,t);e[0].apply(null,[i])},t=>{e[1]&&e[1].apply(null,t)},arguments[2]]):i.apply(this,arguments).then(e=>s(this,e))}};e.RTCPeerConnection.prototype[t]=n[t]});const a=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(e,t){let i=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(t=>{const n=e._reverseStreams[t],r=e._streams[n.id];i=i.replace(new RegExp(n.id,"g"),r.id)}),new RTCSessionDescription({type:t.type,sdp:i})}(this,arguments[0]),a.apply(this,arguments)):a.apply(this,arguments)};const o=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const e=o.get.apply(this);return""===e.type?e:s(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(e._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let t;this._streams=this._streams||{},Object.keys(this._streams).forEach(i=>{this._streams[i].getTracks().find(t=>e.track===t)&&(t=this._streams[i])}),t&&(1===t.getTracks().length?this.removeStream(this._reverseStreams[t.id]):t.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}function O(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){const i=e.RTCPeerConnection.prototype[t],n={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=n[t]})}function P(e,t){l(e,"negotiationneeded",e=>{const i=e.target;if(!(t.version<72||i.getConfiguration&&"plan-b"===i.getConfiguration().sdpSemantics)||"stable"===i.signalingState)return e})}function M(e,t){const i=e&&e.navigator,n=e&&e.MediaStreamTrack;if(i.getUserMedia=function(e,t,n){m("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),i.mediaDevices.getUserMedia(e).then(t,n)},!(t.version>55&&"autoGainControl"in i.mediaDevices.getSupportedConstraints())){const e=function(e,t,i){t in e&&!(i in e)&&(e[i]=e[t],delete e[t])},t=i.mediaDevices.getUserMedia.bind(i.mediaDevices);if(i.mediaDevices.getUserMedia=function(i){return"object"==typeof i&&"object"==typeof i.audio&&(i=JSON.parse(JSON.stringify(i)),e(i.audio,"autoGainControl","mozAutoGainControl"),e(i.audio,"noiseSuppression","mozNoiseSuppression")),t(i)},n&&n.prototype.getSettings){const t=n.prototype.getSettings;n.prototype.getSettings=function(){const i=t.apply(this,arguments);return e(i,"mozAutoGainControl","autoGainControl"),e(i,"mozNoiseSuppression","noiseSuppression"),i}}if(n&&n.prototype.applyConstraints){const t=n.prototype.applyConstraints;n.prototype.applyConstraints=function(i){return"audio"===this.kind&&"object"==typeof i&&(i=JSON.parse(JSON.stringify(i)),e(i,"autoGainControl","mozAutoGainControl"),e(i,"noiseSuppression","mozNoiseSuppression")),t.apply(this,[i])}}}}function j(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(i){if(!i||!i.video){const e=new DOMException("getDisplayMedia without video constraints is undefined");return e.name="NotFoundError",e.code=8,Promise.reject(e)}return!0===i.video?i.video={mediaSource:t}:i.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(i)})}function N(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function D(e,t){if("object"!=typeof e||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){const i=e.RTCPeerConnection.prototype[t],n={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=n[t]});const i={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},n=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,r,s]=arguments;return n.apply(this,[e||null]).then(e=>{if(t.version<53&&!r)try{e.forEach(e=>{e.type=i[e.type]||e.type})}catch(t){if("TypeError"!==t.name)throw t;e.forEach((t,n)=>{e.set(n,Object.assign({},t,{type:i[t.type]||t.type}))})}return e}).then(r,s)}}function A(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e});const i=e.RTCPeerConnection.prototype.addTrack;i&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=i.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function I(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e}),l(e,"track",e=>(e.receiver._pc=e.srcElement,e)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function L(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(e){m("removeStream","removeTrack"),this.getSenders().forEach(t=>{t.track&&e.getTracks().includes(t.track)&&this.removeTrack(t)})})}function F(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function V(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];const e=arguments[1],i=e&&"sendEncodings"in e;i&&e.sendEncodings.forEach(e=>{if("rid"in e){if(!/^[a-z0-9]{0,16}$/i.test(e.rid))throw new TypeError("Invalid RID value provided.")}if("scaleResolutionDownBy"in e&&!(parseFloat(e.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(parseFloat(e.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const n=t.apply(this,arguments);if(i){const{sender:t}=n,i=t.getParameters();(!("encodings"in i)||1===i.encodings.length&&0===Object.keys(i.encodings[0]).length)&&(i.encodings=e.sendEncodings,t.sendEncodings=e.sendEncodings,this.setParametersPromises.push(t.setParameters(i).then(()=>{delete t.sendEncodings}).catch(()=>{delete t.sendEncodings})))}return n})}function Z(e){if("object"!=typeof e||!e.RTCRtpSender)return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const e=t.apply(this,arguments);return"encodings"in e||(e.encodings=[].concat(this.sendEncodings||[{}])),e})}function B(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function U(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function $(e){if("object"==typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getAudioTracks().forEach(i=>t.call(this,i,e)),e.getVideoTracks().forEach(i=>t.call(this,i,e))},e.RTCPeerConnection.prototype.addTrack=function(e,...i){return i&&i.forEach(e=>{this._localStreams?this._localStreams.includes(e)||this._localStreams.push(e):this._localStreams=[e]}),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);const t=this._localStreams.indexOf(e);if(-1===t)return;this._localStreams.splice(t,1);const i=e.getTracks();this.getSenders().forEach(e=>{i.includes(e.track)&&this.removeTrack(e)})})}}function z(e){if("object"==typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=e=>{e.streams.forEach(e=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(e))return;this._remoteStreams.push(e);const t=new Event("addstream");t.stream=e,this.dispatchEvent(t)})})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach(t=>{if(e._remoteStreams||(e._remoteStreams=[]),e._remoteStreams.indexOf(t)>=0)return;e._remoteStreams.push(t);const i=new Event("addstream");i.stream=t,e.dispatchEvent(i)})}),t.apply(e,arguments)}}}function q(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,i=t.createOffer,n=t.createAnswer,r=t.setLocalDescription,s=t.setRemoteDescription,a=t.addIceCandidate;t.createOffer=function(e,t){const n=arguments.length>=2?arguments[2]:arguments[0],r=i.apply(this,[n]);return t?(r.then(e,t),Promise.resolve()):r},t.createAnswer=function(e,t){const i=arguments.length>=2?arguments[2]:arguments[0],r=n.apply(this,[i]);return t?(r.then(e,t),Promise.resolve()):r};let o=function(e,t,i){const n=r.apply(this,[e]);return i?(n.then(t,i),Promise.resolve()):n};t.setLocalDescription=o,o=function(e,t,i){const n=s.apply(this,[e]);return i?(n.then(t,i),Promise.resolve()):n},t.setRemoteDescription=o,o=function(e,t,i){const n=a.apply(this,[e]);return i?(n.then(t,i),Promise.resolve()):n},t.addIceCandidate=o}function G(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const e=t.mediaDevices,i=e.getUserMedia.bind(e);t.mediaDevices.getUserMedia=e=>i(W(e))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,i,n){t.mediaDevices.getUserMedia(e).then(i,n)}.bind(t))}function W(e){return e&&void 0!==e.video?Object.assign({},e,{video:g(e.video)}):e}function K(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,i){if(e&&e.iceServers){const t=[];for(let i=0;i<e.iceServers.length;i++){let n=e.iceServers[i];!n.hasOwnProperty("urls")&&n.hasOwnProperty("url")?(m("RTCIceServer.url","RTCIceServer.urls"),n=JSON.parse(JSON.stringify(n)),n.urls=n.url,delete n.url,t.push(n)):t.push(e.iceServers[i])}e.iceServers=t}return new t(e,i)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function H(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function J(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);const t=this.getTransceivers().find(e=>"audio"===e.receiver.track.kind);!1===e.offerToReceiveAudio&&t?"sendrecv"===t.direction?t.setDirection?t.setDirection("sendonly"):t.direction="sendonly":"recvonly"===t.direction&&(t.setDirection?t.setDirection("inactive"):t.direction="inactive"):!0!==e.offerToReceiveAudio||t||this.addTransceiver("audio",{direction:"recvonly"}),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);const i=this.getTransceivers().find(e=>"video"===e.receiver.track.kind);!1===e.offerToReceiveVideo&&i?"sendrecv"===i.direction?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":"recvonly"===i.direction&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):!0!==e.offerToReceiveVideo||i||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function Q(e){"object"!=typeof e||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var X=i(349),Y=i.n(X);function ee(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"==typeof e&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){const i=new t(e),n=Y().parseCandidate(e.candidate),r=Object.assign(i,n);return r.toJSON=function(){return{candidate:r.candidate,sdpMid:r.sdpMid,sdpMLineIndex:r.sdpMLineIndex,usernameFragment:r.usernameFragment}},r}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,l(e,"icecandidate",t=>(t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t))}function te(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return void 0===this._sctp?null:this._sctp}});const i=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===t.browser&&t.version>=76){const{sdpSemantics:e}=this.getConfiguration();"plan-b"===e&&Object.defineProperty(this,"sctp",{get(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(function(e){if(!e||!e.sdp)return!1;const t=Y().splitSections(e.sdp);return t.shift(),t.some(e=>{const t=Y().parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")})}(arguments[0])){const e=function(e){const t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;const i=parseInt(t[1],10);return i!=i?-1:i}(arguments[0]),i=function(e){let i=65536;return"firefox"===t.browser&&(i=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),i}(e),n=function(e,i){let n=65536;"firefox"===t.browser&&57===t.version&&(n=65535);const r=Y().matchPrefix(e.sdp,"a=max-message-size:");return r.length>0?n=parseInt(r[0].substr(19),10):"firefox"===t.browser&&-1!==i&&(n=2147483637),n}(arguments[0],e);let r;r=0===i&&0===n?Number.POSITIVE_INFINITY:0===i||0===n?Math.max(i,n):Math.min(i,n);const s={};Object.defineProperty(s,"maxMessageSize",{get:()=>r}),this._sctp=s}return i.apply(this,arguments)}}function ie(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(e,t){const i=e.send;e.send=function(){const n=arguments[0],r=n.length||n.size||n.byteLength;if("open"===e.readyState&&t.sctp&&r>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return i.apply(e,arguments)}}const i=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const e=i.apply(this,arguments);return t(e,this),e},l(e,"datachannel",e=>(t(e.channel,e.target),e))}function ne(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(e=>{const i=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=e=>{const t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;const i=new Event("connectionstatechange",e);t.dispatchEvent(i)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),i.apply(this,arguments)}})}function re(e,t){if(!e.RTCPeerConnection)return;if("chrome"===t.browser&&t.version>=71)return;if("safari"===t.browser&&t.version>=605)return;const i=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(t){if(t&&t.sdp&&-1!==t.sdp.indexOf("\na=extmap-allow-mixed")){const i=t.sdp.split("\n").filter(e=>"a=extmap-allow-mixed"!==e.trim()).join("\n");e.RTCSessionDescription&&t instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:t.type,sdp:i}):t.sdp=i}return i.apply(this,arguments)}}function se(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const i=e.RTCPeerConnection.prototype.addIceCandidate;i&&0!==i.length&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===t.browser&&t.version<78||"firefox"===t.browser&&t.version<68||"safari"===t.browser)&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():i.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function ae(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const i=e.RTCPeerConnection.prototype.setLocalDescription;i&&0!==i.length&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let e=arguments[0]||{};if("object"!=typeof e||e.type&&e.sdp)return i.apply(this,arguments);if(e={type:e.type,sdp:e.sdp},!e.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":e.type="offer";break;default:e.type="answer"}if(e.sdp||"offer"!==e.type&&"answer"!==e.type)return i.apply(this,[e]);return("offer"===e.type?this.createOffer:this.createAnswer).apply(this).then(e=>i.apply(this,[e]))})}const oe=function({window:e}={},t={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const i=h,o=function(e){const t={browser:null,version:null};if(void 0===e||!e.navigator)return t.browser="Not a browser.",t;const{navigator:i}=e;if(i.mozGetUserMedia)t.browser="firefox",t.version=d(i.userAgent,/Firefox\/(\d+)\./,1);else if(i.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection&&!e.RTCIceGatherer)t.browser="chrome",t.version=d(i.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!e.RTCPeerConnection||!i.userAgent.match(/AppleWebKit\/(\d+)\./))return t.browser="Not a supported browser.",t;t.browser="safari",t.version=d(i.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}return t}(e),c={browserDetails:o,commonShim:a,extractVersion:d,disableLog:u,disableWarnings:p,sdp:X};switch(o.browser){case"chrome":if(!n||!O||!t.shimChrome)return i("Chrome shim is not included in this adapter release."),c;if(null===o.version)return i("Chrome shim can not determine version, not shimming."),c;i("adapter.js shimming chrome."),c.browserShim=n,se(e,o),ae(e),b(e,o),C(e),O(e,o),w(e),E(e,o),T(e),R(e),x(e),P(e,o),ee(e),ne(e),te(e,o),ie(e),re(e,o);break;case"firefox":if(!r||!D||!t.shimFirefox)return i("Firefox shim is not included in this adapter release."),c;i("adapter.js shimming firefox."),c.browserShim=r,se(e,o),ae(e),M(e,o),D(e,o),N(e),L(e),A(e),I(e),F(e),V(e),Z(e),B(e),U(e),ee(e),ne(e),te(e,o),ie(e);break;case"safari":if(!s||!t.shimSafari)return i("Safari shim is not included in this adapter release."),c;i("adapter.js shimming safari."),c.browserShim=s,se(e,o),ae(e),K(e),J(e),q(e),$(e),z(e),H(e),G(e),Q(e),ee(e),te(e,o),ie(e),re(e,o);break;default:i("Unsupported browser!")}return c}({window:"undefined"==typeof window?void 0:window}),ce=oe},349:e=>{const t={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};t.localCName=t.generateIdentifier(),t.splitLines=function(e){return e.trim().split("\n").map(e=>e.trim())},t.splitSections=function(e){return e.split("\nm=").map((e,t)=>(t>0?"m="+e:e).trim()+"\r\n")},t.getDescription=function(e){const i=t.splitSections(e);return i&&i[0]},t.getMediaSections=function(e){const i=t.splitSections(e);return i.shift(),i},t.matchPrefix=function(e,i){return t.splitLines(e).filter(e=>0===e.indexOf(i))},t.parseCandidate=function(e){let t;t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" ");const i={foundation:t[0],component:{1:"rtp",2:"rtcp"}[t[1]]||t[1],protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]};for(let e=8;e<t.length;e+=2)switch(t[e]){case"raddr":i.relatedAddress=t[e+1];break;case"rport":i.relatedPort=parseInt(t[e+1],10);break;case"tcptype":i.tcpType=t[e+1];break;case"ufrag":i.ufrag=t[e+1],i.usernameFragment=t[e+1];break;default:void 0===i[t[e]]&&(i[t[e]]=t[e+1])}return i},t.writeCandidate=function(e){const t=[];t.push(e.foundation);const i=e.component;"rtp"===i?t.push(1):"rtcp"===i?t.push(2):t.push(i),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);const n=e.type;return t.push("typ"),t.push(n),"host"!==n&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},t.parseIceOptions=function(e){return e.substr(14).split(" ")},t.parseRtpMap=function(e){let t=e.substr(9).split(" ");const i={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),i.name=t[0],i.clockRate=parseInt(t[1],10),i.channels=3===t.length?parseInt(t[2],10):1,i.numChannels=i.channels,i},t.writeRtpMap=function(e){let t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);const i=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==i?"/"+i:"")+"\r\n"},t.parseExtmap=function(e){const t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1]}},t.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},t.parseFmtp=function(e){const t={};let i;const n=e.substr(e.indexOf(" ")+1).split(";");for(let e=0;e<n.length;e++)i=n[e].trim().split("="),t[i[0].trim()]=i[1];return t},t.writeFmtp=function(e){let t="",i=e.payloadType;if(void 0!==e.preferredPayloadType&&(i=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){const n=[];Object.keys(e.parameters).forEach(t=>{void 0!==e.parameters[t]?n.push(t+"="+e.parameters[t]):n.push(t)}),t+="a=fmtp:"+i+" "+n.join(";")+"\r\n"}return t},t.parseRtcpFb=function(e){const t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},t.writeRtcpFb=function(e){let t="",i=e.payloadType;return void 0!==e.preferredPayloadType&&(i=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(e=>{t+="a=rtcp-fb:"+i+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"}),t},t.parseSsrcMedia=function(e){const t=e.indexOf(" "),i={ssrc:parseInt(e.substr(7,t-7),10)},n=e.indexOf(":",t);return n>-1?(i.attribute=e.substr(t+1,n-t-1),i.value=e.substr(n+1)):i.attribute=e.substr(t+1),i},t.parseSsrcGroup=function(e){const t=e.substr(13).split(" ");return{semantics:t.shift(),ssrcs:t.map(e=>parseInt(e,10))}},t.getMid=function(e){const i=t.matchPrefix(e,"a=mid:")[0];if(i)return i.substr(6)},t.parseFingerprint=function(e){const t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1].toUpperCase()}},t.getDtlsParameters=function(e,i){return{role:"auto",fingerprints:t.matchPrefix(e+i,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(e,t){let i="a=setup:"+t+"\r\n";return e.fingerprints.forEach(e=>{i+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),i},t.parseCryptoLine=function(e){const t=e.substr(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},t.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"==typeof e.keyParams?t.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},t.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;const t=e.substr(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},t.getCryptoParameters=function(e,i){return t.matchPrefix(e+i,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(e,i){const n=t.matchPrefix(e+i,"a=ice-ufrag:")[0],r=t.matchPrefix(e+i,"a=ice-pwd:")[0];return n&&r?{usernameFragment:n.substr(12),password:r.substr(10)}:null},t.writeIceParameters=function(e){let t="a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n";return e.iceLite&&(t+="a=ice-lite\r\n"),t},t.parseRtpParameters=function(e){const i={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},n=t.splitLines(e)[0].split(" ");for(let r=3;r<n.length;r++){const s=n[r],a=t.matchPrefix(e,"a=rtpmap:"+s+" ")[0];if(a){const n=t.parseRtpMap(a),r=t.matchPrefix(e,"a=fmtp:"+s+" ");switch(n.parameters=r.length?t.parseFmtp(r[0]):{},n.rtcpFeedback=t.matchPrefix(e,"a=rtcp-fb:"+s+" ").map(t.parseRtcpFb),i.codecs.push(n),n.name.toUpperCase()){case"RED":case"ULPFEC":i.fecMechanisms.push(n.name.toUpperCase())}}}return t.matchPrefix(e,"a=extmap:").forEach(e=>{i.headerExtensions.push(t.parseExtmap(e))}),i},t.writeRtpDescription=function(e,i){let n="";n+="m="+e+" ",n+=i.codecs.length>0?"9":"0",n+=" UDP/TLS/RTP/SAVPF ",n+=i.codecs.map(e=>void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType).join(" ")+"\r\n",n+="c=IN IP4 0.0.0.0\r\n",n+="a=rtcp:9 IN IP4 0.0.0.0\r\n",i.codecs.forEach(e=>{n+=t.writeRtpMap(e),n+=t.writeFmtp(e),n+=t.writeRtcpFb(e)});let r=0;return i.codecs.forEach(e=>{e.maxptime>r&&(r=e.maxptime)}),r>0&&(n+="a=maxptime:"+r+"\r\n"),i.headerExtensions&&i.headerExtensions.forEach(e=>{n+=t.writeExtmap(e)}),n},t.parseRtpEncodingParameters=function(e){const i=[],n=t.parseRtpParameters(e),r=-1!==n.fecMechanisms.indexOf("RED"),s=-1!==n.fecMechanisms.indexOf("ULPFEC"),a=t.matchPrefix(e,"a=ssrc:").map(e=>t.parseSsrcMedia(e)).filter(e=>"cname"===e.attribute),o=a.length>0&&a[0].ssrc;let c;const d=t.matchPrefix(e,"a=ssrc-group:FID").map(e=>e.substr(17).split(" ").map(e=>parseInt(e,10)));d.length>0&&d[0].length>1&&d[0][0]===o&&(c=d[0][1]),n.codecs.forEach(e=>{if("RTX"===e.name.toUpperCase()&&e.parameters.apt){let t={ssrc:o,codecPayloadType:parseInt(e.parameters.apt,10)};o&&c&&(t.rtx={ssrc:c}),i.push(t),r&&(t=JSON.parse(JSON.stringify(t)),t.fec={ssrc:o,mechanism:s?"red+ulpfec":"red"},i.push(t))}}),0===i.length&&o&&i.push({ssrc:o});let l=t.matchPrefix(e,"b=");return l.length&&(l=0===l[0].indexOf("b=TIAS:")?parseInt(l[0].substr(7),10):0===l[0].indexOf("b=AS:")?1e3*parseInt(l[0].substr(5),10)*.95-16e3:void 0,i.forEach(e=>{e.maxBitrate=l})),i},t.parseRtcpParameters=function(e){const i={},n=t.matchPrefix(e,"a=ssrc:").map(e=>t.parseSsrcMedia(e)).filter(e=>"cname"===e.attribute)[0];n&&(i.cname=n.value,i.ssrc=n.ssrc);const r=t.matchPrefix(e,"a=rtcp-rsize");i.reducedSize=r.length>0,i.compound=0===r.length;const s=t.matchPrefix(e,"a=rtcp-mux");return i.mux=s.length>0,i},t.writeRtcpParameters=function(e){let t="";return e.reducedSize&&(t+="a=rtcp-rsize\r\n"),e.mux&&(t+="a=rtcp-mux\r\n"),void 0!==e.ssrc&&e.cname&&(t+="a=ssrc:"+e.ssrc+" cname:"+e.cname+"\r\n"),t},t.parseMsid=function(e){let i;const n=t.matchPrefix(e,"a=msid:");if(1===n.length)return i=n[0].substr(7).split(" "),{stream:i[0],track:i[1]};const r=t.matchPrefix(e,"a=ssrc:").map(e=>t.parseSsrcMedia(e)).filter(e=>"msid"===e.attribute);return r.length>0?(i=r[0].value.split(" "),{stream:i[0],track:i[1]}):void 0},t.parseSctpDescription=function(e){const i=t.parseMLine(e),n=t.matchPrefix(e,"a=max-message-size:");let r;n.length>0&&(r=parseInt(n[0].substr(19),10)),isNaN(r)&&(r=65536);const s=t.matchPrefix(e,"a=sctp-port:");if(s.length>0)return{port:parseInt(s[0].substr(12),10),protocol:i.fmt,maxMessageSize:r};const a=t.matchPrefix(e,"a=sctpmap:");if(a.length>0){const e=a[0].substr(10).split(" ");return{port:parseInt(e[0],10),protocol:e[1],maxMessageSize:r}}},t.writeSctpDescription=function(e,t){let i=[];return i="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&i.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),i.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,21)},t.writeSessionBoilerplate=function(e,i,n){let r;const s=void 0!==i?i:2;r=e||t.generateSessionId();return"v=0\r\no="+(n||"thisisadapterortc")+" "+r+" "+s+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},t.getDirection=function(e,i){const n=t.splitLines(e);for(let e=0;e<n.length;e++)switch(n[e]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return n[e].substr(2)}return i?t.getDirection(i):"sendrecv"},t.getKind=function(e){return t.splitLines(e)[0].split(" ")[0].substr(2)},t.isRejected=function(e){return"0"===e.split(" ",2)[1]},t.parseMLine=function(e){const i=t.splitLines(e)[0].substr(2).split(" ");return{kind:i[0],port:parseInt(i[1],10),protocol:i[2],fmt:i.slice(3).join(" ")}},t.parseOLine=function(e){const i=t.matchPrefix(e,"o=")[0].substr(2).split(" ");return{username:i[0],sessionId:i[1],sessionVersion:parseInt(i[2],10),netType:i[3],addressType:i[4],address:i[5]}},t.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;const i=t.splitLines(e);for(let e=0;e<i.length;e++)if(i[e].length<2||"="!==i[e].charAt(1))return!1;return!0},e.exports=t},462:function(e,t,i){var n;!function(r,s){var a="function",o="undefined",c="object",d="string",l="major",u="model",p="name",h="type",m="vendor",f="version",g="architecture",v="console",y="mobile",_="tablet",b="smarttv",S="wearable",C="embedded",w="Amazon",T="Apple",R="ASUS",x="BlackBerry",k="Browser",E="Chrome",O="Firefox",P="Google",M="Huawei",j="LG",N="Microsoft",D="Motorola",A="Opera",I="Samsung",L="Sharp",F="Sony",V="Xiaomi",Z="Zebra",B="Facebook",U="Chromium OS",$="Mac OS",z=function(e){for(var t={},i=0;i<e.length;i++)t[e[i].toUpperCase()]=e[i];return t},q=function(e,t){return typeof e===d&&-1!==G(t).indexOf(G(e))},G=function(e){return e.toLowerCase()},W=function(e,t){if(typeof e===d)return e=e.replace(/^\s\s*/,""),typeof t===o?e:e.substring(0,350)},K=function(e,t){for(var i,n,r,o,d,l,u=0;u<t.length&&!d;){var p=t[u],h=t[u+1];for(i=n=0;i<p.length&&!d&&p[i];)if(d=p[i++].exec(e))for(r=0;r<h.length;r++)l=d[++n],typeof(o=h[r])===c&&o.length>0?2===o.length?typeof o[1]==a?this[o[0]]=o[1].call(this,l):this[o[0]]=o[1]:3===o.length?typeof o[1]!==a||o[1].exec&&o[1].test?this[o[0]]=l?l.replace(o[1],o[2]):s:this[o[0]]=l?o[1].call(this,l,o[2]):s:4===o.length&&(this[o[0]]=l?o[3].call(this,l.replace(o[1],o[2])):s):this[o]=l||s;u+=2}},H=function(e,t){for(var i in t)if(typeof t[i]===c&&t[i].length>0){for(var n=0;n<t[i].length;n++)if(q(t[i][n],e))return"?"===i?s:i}else if(q(t[i],e))return"?"===i?s:i;return e},J={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},Q={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[f,[p,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[f,[p,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[p,f],[/opios[\/ ]+([\w\.]+)/i],[f,[p,A+" Mini"]],[/\bopr\/([\w\.]+)/i],[f,[p,A]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(heytap|ovi)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[p,f],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[f,[p,"UC"+k]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[f,[p,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[f,[p,"WeChat"]],[/konqueror\/([\w\.]+)/i],[f,[p,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[f,[p,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[f,[p,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[p,/(.+)/,"$1 Secure "+k],f],[/\bfocus\/([\w\.]+)/i],[f,[p,O+" Focus"]],[/\bopt\/([\w\.]+)/i],[f,[p,A+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[f,[p,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[f,[p,"Dolphin"]],[/coast\/([\w\.]+)/i],[f,[p,A+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[f,[p,"MIUI "+k]],[/fxios\/([-\w\.]+)/i],[f,[p,O]],[/\bqihu|(qi?ho?o?|360)browser/i],[[p,"360 "+k]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[p,/(.+)/,"$1 "+k],f],[/(comodo_dragon)\/([\w\.]+)/i],[[p,/_/g," "],f],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[p,f],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[p],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[p,B],f],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[p,f],[/\bgsa\/([\w\.]+) .*safari\//i],[f,[p,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[f,[p,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[f,[p,E+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[p,E+" WebView"],f],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[f,[p,"Android "+k]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[p,f],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[f,[p,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[f,p],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[p,[f,H,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[p,f],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[p,"Netscape"],f],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[f,[p,O+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[p,f],[/(cobalt)\/([\w\.]+)/i],[p,[f,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[g,"amd64"]],[/(ia32(?=;))/i],[[g,G]],[/((?:i[346]|x)86)[;\)]/i],[[g,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[g,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[g,"armhf"]],[/windows (ce|mobile); ppc;/i],[[g,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[g,/ower/,"",G]],[/(sun4\w)[;\)]/i],[[g,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[g,G]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[u,[m,I],[h,_]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[u,[m,I],[h,y]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[u,[m,T],[h,y]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[u,[m,T],[h,_]],[/(macintosh);/i],[u,[m,T]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[u,[m,L],[h,y]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[u,[m,M],[h,_]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[u,[m,M],[h,y]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[u,/_/g," "],[m,V],[h,y]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[u,/_/g," "],[m,V],[h,_]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[u,[m,"OPPO"],[h,y]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[u,[m,"Vivo"],[h,y]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[u,[m,"Realme"],[h,y]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[u,[m,D],[h,y]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[u,[m,D],[h,_]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[u,[m,j],[h,_]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[u,[m,j],[h,y]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[u,[m,"Lenovo"],[h,_]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[u,/_/g," "],[m,"Nokia"],[h,y]],[/(pixel c)\b/i],[u,[m,P],[h,_]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[u,[m,P],[h,y]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[u,[m,F],[h,y]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[u,"Xperia Tablet"],[m,F],[h,_]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[u,[m,"OnePlus"],[h,y]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo[c-r]{2})( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[u,[m,w],[h,_]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[u,/(.+)/g,"Fire Phone $1"],[m,w],[h,y]],[/(playbook);[-\w\),; ]+(rim)/i],[u,m,[h,_]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[u,[m,x],[h,y]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[u,[m,R],[h,_]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[u,[m,R],[h,y]],[/(nexus 9)/i],[u,[m,"HTC"],[h,_]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[m,[u,/_/g," "],[h,y]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[u,[m,"Acer"],[h,_]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[u,[m,"Meizu"],[h,y]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron|infinix|tecno)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[m,u,[h,y]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[m,u,[h,_]],[/(surface duo)/i],[u,[m,N],[h,_]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[u,[m,"Fairphone"],[h,y]],[/(u304aa)/i],[u,[m,"AT&T"],[h,y]],[/\bsie-(\w*)/i],[u,[m,"Siemens"],[h,y]],[/\b(rct\w+) b/i],[u,[m,"RCA"],[h,_]],[/\b(venue[\d ]{2,7}) b/i],[u,[m,"Dell"],[h,_]],[/\b(q(?:mv|ta)\w+) b/i],[u,[m,"Verizon"],[h,_]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[u,[m,"Barnes & Noble"],[h,_]],[/\b(tm\d{3}\w+) b/i],[u,[m,"NuVision"],[h,_]],[/\b(k88) b/i],[u,[m,"ZTE"],[h,_]],[/\b(nx\d{3}j) b/i],[u,[m,"ZTE"],[h,y]],[/\b(gen\d{3}) b.+49h/i],[u,[m,"Swiss"],[h,y]],[/\b(zur\d{3}) b/i],[u,[m,"Swiss"],[h,_]],[/\b((zeki)?tb.*\b) b/i],[u,[m,"Zeki"],[h,_]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[m,"Dragon Touch"],u,[h,_]],[/\b(ns-?\w{0,9}) b/i],[u,[m,"Insignia"],[h,_]],[/\b((nxa|next)-?\w{0,9}) b/i],[u,[m,"NextBook"],[h,_]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[m,"Voice"],u,[h,y]],[/\b(lvtel\-)?(v1[12]) b/i],[[m,"LvTel"],u,[h,y]],[/\b(ph-1) /i],[u,[m,"Essential"],[h,y]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[u,[m,"Envizen"],[h,_]],[/\b(trio[-\w\. ]+) b/i],[u,[m,"MachSpeed"],[h,_]],[/\btu_(1491) b/i],[u,[m,"Rotor"],[h,_]],[/(shield[\w ]+) b/i],[u,[m,"Nvidia"],[h,_]],[/(sprint) (\w+)/i],[m,u,[h,y]],[/(kin\.[onetw]{3})/i],[[u,/\./g," "],[m,N],[h,y]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[u,[m,Z],[h,_]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[u,[m,Z],[h,y]],[/smart-tv.+(samsung)/i],[m,[h,b]],[/hbbtv.+maple;(\d+)/i],[[u,/^/,"SmartTV"],[m,I],[h,b]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[m,j],[h,b]],[/(apple) ?tv/i],[m,[u,T+" TV"],[h,b]],[/crkey/i],[[u,E+"cast"],[m,P],[h,b]],[/droid.+aft(\w+)( bui|\))/i],[u,[m,w],[h,b]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[u,[m,L],[h,b]],[/(bravia[\w ]+)( bui|\))/i],[u,[m,F],[h,b]],[/(mitv-\w{5}) bui/i],[u,[m,V],[h,b]],[/Hbbtv.*(technisat) (.*);/i],[m,u,[h,b]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[m,W],[u,W],[h,b]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[h,b]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[m,u,[h,v]],[/droid.+; (shield) bui/i],[u,[m,"Nvidia"],[h,v]],[/(playstation [345portablevi]+)/i],[u,[m,F],[h,v]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[u,[m,N],[h,v]],[/((pebble))app/i],[m,u,[h,S]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[u,[m,T],[h,S]],[/droid.+; (glass) \d/i],[u,[m,P],[h,S]],[/droid.+; (wt63?0{2,3})\)/i],[u,[m,Z],[h,S]],[/(quest( 2| pro)?)/i],[u,[m,B],[h,S]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[m,[h,C]],[/(aeobc)\b/i],[u,[m,w],[h,C]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[u,[h,y]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[u,[h,_]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[h,_]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[h,y]],[/(android[-\w\. ]{0,9});.+buil/i],[u,[m,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[f,[p,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[f,[p,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[p,f],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[f,p]],os:[[/microsoft (windows) (vista|xp)/i],[p,f],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[p,[f,H,J]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[p,"Windows"],[f,H,J]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[f,/_/g,"."],[p,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[p,$],[f,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[f,p],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[p,f],[/\(bb(10);/i],[f,[p,x]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[f,[p,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[f,[p,O+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[f,[p,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[f,[p,"watchOS"]],[/crkey\/([\d\.]+)/i],[f,[p,E+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[p,U],f],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[p,f],[/(sunos) ?([\w\.\d]*)/i],[[p,"Solaris"],f],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[p,f]]},X=function(e,t){if(typeof e===c&&(t=e,e=s),!(this instanceof X))return new X(e,t).getResult();var i=typeof r!==o&&r.navigator?r.navigator:s,n=e||(i&&i.userAgent?i.userAgent:""),v=i&&i.userAgentData?i.userAgentData:s,b=t?function(e,t){var i={};for(var n in e)t[n]&&t[n].length%2==0?i[n]=t[n].concat(e[n]):i[n]=e[n];return i}(Q,t):Q,S=i&&i.userAgent==n;return this.getBrowser=function(){var e,t={};return t[p]=s,t[f]=s,K.call(t,n,b.browser),t[l]=typeof(e=t[f])===d?e.replace(/[^\d\.]/g,"").split(".")[0]:s,S&&i&&i.brave&&typeof i.brave.isBrave==a&&(t[p]="Brave"),t},this.getCPU=function(){var e={};return e[g]=s,K.call(e,n,b.cpu),e},this.getDevice=function(){var e={};return e[m]=s,e[u]=s,e[h]=s,K.call(e,n,b.device),S&&!e[h]&&v&&v.mobile&&(e[h]=y),S&&"Macintosh"==e[u]&&i&&typeof i.standalone!==o&&i.maxTouchPoints&&i.maxTouchPoints>2&&(e[u]="iPad",e[h]=_),e},this.getEngine=function(){var e={};return e[p]=s,e[f]=s,K.call(e,n,b.engine),e},this.getOS=function(){var e={};return e[p]=s,e[f]=s,K.call(e,n,b.os),S&&!e[p]&&v&&"Unknown"!=v.platform&&(e[p]=v.platform.replace(/chrome os/i,U).replace(/macos/i,$)),e},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return n},this.setUA=function(e){return n=typeof e===d&&e.length>350?W(e,350):e,this},this.setUA(n),this};X.VERSION="0.7.36",X.BROWSER=z([p,f,l]),X.CPU=z([g]),X.DEVICE=z([u,m,h,v,y,b,_,S,C]),X.ENGINE=X.OS=z([p,f]),typeof t!==o?(e.exports&&(t=e.exports=X),t.UAParser=X):i.amdO?(n=function(){return X}.call(t,i,t,e))===s||(e.exports=n):typeof r!==o&&(r.UAParser=X);var Y=typeof r!==o&&(r.jQuery||r.Zepto);if(Y&&!Y.ua){var ee=new X;Y.ua=ee.getResult(),Y.ua.get=function(){return ee.getUA()},Y.ua.set=function(e){ee.setUA(e);var t=ee.getResult();for(var i in t)Y.ua[i]=t[i]}}}("object"==typeof window?window:this)}},t={};function i(n){var r=t[n];if(void 0!==r)return r.exports;var s=t[n]={exports:{}};return e[n].call(s.exports,s,s.exports,i),s.exports}i.amdO={},i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var n,r={};i.r(r),i.d(r,{DeviceUtils:()=>ci,HelperUtils:()=>f,LogLevel:()=>b,SHA:()=>pn,StreamUtils:()=>pi,VERSION:()=>un,Webcaster:()=>ln,getLogDumpData:()=>M,getLogger:()=>P,overrideLoggerDefaults:()=>O,overrideOnLogCallback:()=>j}),function(e){e[e.MStreamAlreadyExists=2001]="MStreamAlreadyExists",e[e.MStreamNotFound=2002]="MStreamNotFound",e[e.MStreamNotCreated=2003]="MStreamNotCreated",e[e.General=4e3]="General",e[e.GeneralSetupNotCalled=4001]="GeneralSetupNotCalled",e[e.GeneralBroadcastNotStarted=4002]="GeneralBroadcastNotStarted",e[e.GeneralRecoveryFailed=4003]="GeneralRecoveryFailed",e[e.GeneralLoggerSetupFailed=4004]="GeneralLoggerSetupFailed",e[e.BroadcastPCNotFound=5001]="BroadcastPCNotFound",e[e.BroadcastPCAlreadyExists=5002]="BroadcastPCAlreadyExists",e[e.BroadcastPCAddTransceiverFailed=5003]="BroadcastPCAddTransceiverFailed",e[e.BroadcastCreateOfferFailed=5004]="BroadcastCreateOfferFailed",e[e.BroadcastSetAnswerFailed=5005]="BroadcastSetAnswerFailed",e[e.BroadcastApplyConstraintsFailed=5006]="BroadcastApplyConstraintsFailed",e[e.MDevicesMethodNotSupported=6001]="MDevicesMethodNotSupported",e[e.MDevicesKindNotSupported=6002]="MDevicesKindNotSupported",e[e.MDevicesPermissionQueryFailed=6003]="MDevicesPermissionQueryFailed",e[e.ValidationError=7e3]="ValidationError",e[e.MetricsParseUserAgentFailed=8001]="MetricsParseUserAgentFailed",e[e.MetricsInvalidTrackKind=8002]="MetricsInvalidTrackKind",e[e.MetricsInitStatsCollectFailed=8003]="MetricsInitStatsCollectFailed",e[e.MetricsStopStatsCollectFailed=8004]="MetricsStopStatsCollectFailed",e[e.ServerMalformedResponse=10001]="ServerMalformedResponse",e[e.ServerCreateResourceFailed=10002]="ServerCreateResourceFailed",e[e.ServerRequestFailed=10003]="ServerRequestFailed",e[e.ClientRequestFailed=11001]="ClientRequestFailed",e[e.ClientResourceAlreadyExists=11002]="ClientResourceAlreadyExists",e[e.ClientResourceNotFound=11003]="ClientResourceNotFound",e[e.ClientRequestPending=11004]="ClientRequestPending"}(n||(n={}));class s extends Error{get code(){return this._code}constructor(e,t,i){super(e),this._code=t,this._metadata=i,Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}toString(){return`${this._code} ${super.toString()}`}}class a extends s{get issues(){return this._issues.map(e=>({message:e.message,path:e.path}))}constructor(e,t,i,n){super(e,t,n),this._issues=i,this.name="ValidationError"}toString(){return`${super.toString()}: ${e=this._issues,e.map(e=>`'${e.message} at "${function(e){let t="";for(const i of e)t+=`${i}.`;return t.substring(0,t.length-1)}(e.path)}"'`).join(", ")}`;var e}}class o extends s{constructor(e,t,i){super(e,t,i),this.name="ServerError"}}class c extends s{constructor(e,t,i){super(e,t,i),this.name="ClientRequestError"}}class d extends s{constructor(e,t,i){super(e,t,i),this.name="GeneralError"}}class l extends s{constructor(e,t,i){super(e,t,i),this.name="MediaStreamError"}}class u extends s{constructor(e,t,i){super(e,t,i),this.name="BroadcastError"}}class p extends s{constructor(e,t,i){super(e,t,i),this.name="MediaDevicesError"}}class h extends s{constructor(e,t,i){super(e,t,i),this.name="MetricsError"}}class m{static GeneralError(e,t,i){return new d(e,t,i)}static MediaStreamError(e,t,i){return new l(e,t,i)}static BroadcastError(e,t,i){return new u(e,t,i)}static ServerError(e,t,i){return new o(e,t,i)}static ClientRequestError(e,t,i){return new c(e,t,i)}static MediaDevicesError(e,t,i){return new p(e,t,i)}static ValidationError(e,t,i,n){return new a(e,t,i,n)}static MetricsError(e,t,i){return new h(e,t,i)}}class f{static isBoolean(e){return"boolean"==typeof e}static isUndefined(e){return void 0===e}static isDefined(e){return!f.isUndefined(e)}static isNumber(e){return"number"==typeof e}static isObject(e){return"object"==typeof e}static isString(e){return"string"==typeof e}static orNull(e){return e||null}static orZero(e){return e||0}static orInfinity(e,t=!1){return e||(t?-1/0:1/0)}static oneBitQuantize(e){return 0===e?0:1}static roundToPrecision(e,t=0){const i=Math.pow(10,t);return Math.round(e*i)/i}static kbps(e){return 1e3*e}static mbps(e){return 1e6*e}static cloneSerializable(e){return JSON.parse(JSON.stringify(e))}static isEmpty(e){return 0===Object.keys(e).length}static prettyPrintJson(e){return JSON.stringify(e,null,4)}static msToSecs(e){return e/1e3}static minBy(e,t){const i=Math.min(...e.map(t));return e.find(e=>t(e)===i)}static maxBy(e,t){const i=Math.max(...e.map(t));return e.find(e=>t(e)===i)}static meanBy(e,t){return e.reduce((e,i)=>e+t(i),0)/e.length}static assignInitTypedProps(e,t,i){if(e&&t)for(const n in e)typeof t[n]==typeof e[n]&&(f.isObject(e[n])?i&&null===e[n]?e[n]=t[n]:f.assignInitTypedProps(e[n],t[n],i):e[n]=t[n])}static filterObjectByMask(e,t,i){const n=Object.assign({},t);return f.assignInitTypedProps(n,e,i),n}static removeLastPathPart(e){try{const t=new URL(e).toString();return t.slice(0,t.lastIndexOf("/"))}catch(e){throw new Error(`Failed to parse URL: ${e.message}`)}}static removeTrailingSlash(e){let t=e;return e.endsWith("/")&&(t=e.substring(0,e.length-1)),t}static exponentialBaseOnRange(e,t,i){if(e<=0||t<=0)throw new Error("sideA and sideB must be greater than 0.");if(i<=1)throw new Error("Steps must be greater than 1.");if(e>=t)throw new Error("sideA must be less than sideB.");return Math.pow(t/e,1/(i-1))}static getRandInt(e,t){if(!f.isNumber(e)||!f.isNumber(t))throw new Error("min and max must be numbers");if(e>t)throw new Error("min must be less than or equal to max");return Math.floor(Math.random()*(t-e)+e)}}f.noop=()=>{},f.wait=e=>new Promise((t,i)=>setTimeout(t,e));const{noop:g,isNumber:v,isString:y,isUndefined:_}=f;var b;!function(e){e[e.TRACE=6]="TRACE",e[e.DEBUG=5]="DEBUG",e[e.LOG=4]="LOG",e[e.INFO=3]="INFO",e[e.WARN=2]="WARN",e[e.ERROR=1]="ERROR",e[e.OFF=0]="OFF"}(b||(b={}));const S="logger",C="nanostream-webcaster",w=b.OFF,T={level:w,domain:C,prefix:"",withLevel:!0,enableDebug:!1};let R=g;const x=[],k=new class{constructor(){this._logLineStore=[],this.trace=this._storeMsg.bind(this,b.TRACE),this.debug=this._storeMsg.bind(this,b.DEBUG),this.log=this._storeMsg.bind(this,b.LOG),this.info=this._storeMsg.bind(this,b.INFO),this.warn=this._storeMsg.bind(this,b.WARN),this.error=this._storeMsg.bind(this,b.ERROR)}_storeMsg(e,...t){this._logLineStore.push([e,Date.now(),t.join(" ")]),this._applyLimits()}_applyLimits(){const e=this._logLineStore.length-1e4;e>0&&this._logLineStore.splice(0,e);const t=Date.now();for(;t-this._logLineStore[0][1]>=36e5;)this._logLineStore.shift()}getStoredData(){return this._logLineStore}};function E(e,t){const i=function(e){const t=b[e.toUpperCase()];return v(t)?t:b.OFF}(e);if(function(e,t){return!!v(e.level)&&t<=e.level}(t,i)){const r=function(e,t){const{domain:i,prefix:r,withLevel:s}=e;if(!r)throw m.GeneralError("LoggerConfig can not have empty prefix",n.GeneralLoggerSetupFailed);return`${i} <${r}>${s?` [${b[t]}]`:""} |`}(t,i),s=function(e,t){return console[e]?console[e].bind(console,t):g}(e,r);if(t.enableDebug)return s;const a=[t=>k[e](r,...t),t=>R(e,r,...t)];return(...e)=>a.forEach(t=>t(e))}return g}function O(e,t=!1){if(e.prefix)throw m.GeneralError("Logger defaults can not carry a set `prefix` parameter",n.GeneralLoggerSetupFailed);Object.assign(T,e),t&&localStorage.setItem(S+":"+T.domain,JSON.stringify(T))}function P(e){let t;var i;if(y(e)?(i=e,t=Object.assign(Object.assign({},T),{prefix:i})):t=e,!Number.isInteger(t.level)||t.level<0)throw m.GeneralError("LogLevel has to be integer >= 0 but have: "+t.level,n.GeneralLoggerSetupFailed);const r={trace:E("trace",t),debug:E("debug",t),log:E("log",t),info:E("info",t),warn:E("warn",t),error:E("error",t)};return x.push([t,r]),r}function M(){return k.getStoredData()}function j(e){if(_(e))throw m.GeneralError("Callback is undefined",n.GeneralLoggerSetupFailed);if("function"!=typeof e)throw m.GeneralError("Callback is not a function",n.GeneralLoggerSetupFailed);R=e,x.forEach(([e,t])=>{for(const i in t){const n=i;t[n]=E(n,e)}})}!function(){const e=localStorage.getItem(S+":"+C);e&&O(JSON.parse(e))}();var N,D,A=function(e,t,i,n){return new(i||(i=Promise))(function(r,s){function a(e){try{c(n.next(e))}catch(e){s(e)}}function o(e){try{c(n.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(a,o)}c((n=n.apply(e,t||[])).next())})};!function(e){e.assertEqual=e=>e,e.assertIs=function(e){},e.assertNever=function(e){throw new Error},e.arrayToEnum=e=>{const t={};for(const i of e)t[i]=i;return t},e.getValidEnumValues=t=>{const i=e.objectKeys(t).filter(e=>"number"!=typeof t[t[e]]),n={};for(const e of i)n[e]=t[e];return e.objectValues(n)},e.objectValues=t=>e.objectKeys(t).map(function(e){return t[e]}),e.objectKeys="function"==typeof Object.keys?e=>Object.keys(e):e=>{const t=[];for(const i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.push(i);return t},e.find=(e,t)=>{for(const i of e)if(t(i))return i},e.isInteger="function"==typeof Number.isInteger?e=>Number.isInteger(e):e=>"number"==typeof e&&isFinite(e)&&Math.floor(e)===e,e.joinValues=function(e,t=" | "){return e.map(e=>"string"==typeof e?`'${e}'`:e).join(t)},e.jsonStringifyReplacer=(e,t)=>"bigint"==typeof t?t.toString():t}(N||(N={})),function(e){e.mergeShapes=(e,t)=>Object.assign(Object.assign({},e),t)}(D||(D={}));const I=N.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),L=e=>{switch(typeof e){case"undefined":return I.undefined;case"string":return I.string;case"number":return isNaN(e)?I.nan:I.number;case"boolean":return I.boolean;case"function":return I.function;case"bigint":return I.bigint;case"symbol":return I.symbol;case"object":return Array.isArray(e)?I.array:null===e?I.null:e.then&&"function"==typeof e.then&&e.catch&&"function"==typeof e.catch?I.promise:"undefined"!=typeof Map&&e instanceof Map?I.map:"undefined"!=typeof Set&&e instanceof Set?I.set:"undefined"!=typeof Date&&e instanceof Date?I.date:I.object;default:return I.unknown}},F=N.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class V extends Error{constructor(e){super(),this.issues=[],this.addIssue=e=>{this.issues=[...this.issues,e]},this.addIssues=(e=[])=>{this.issues=[...this.issues,...e]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}get errors(){return this.issues}format(e){const t=e||function(e){return e.message},i={_errors:[]},n=e=>{for(const r of e.issues)if("invalid_union"===r.code)r.unionErrors.map(n);else if("invalid_return_type"===r.code)n(r.returnTypeError);else if("invalid_arguments"===r.code)n(r.argumentsError);else if(0===r.path.length)i._errors.push(t(r));else{let e=i,n=0;for(;n<r.path.length;){const i=r.path[n];n===r.path.length-1?(e[i]=e[i]||{_errors:[]},e[i]._errors.push(t(r))):e[i]=e[i]||{_errors:[]},e=e[i],n++}}};return n(this),i}toString(){return this.message}get message(){return JSON.stringify(this.issues,N.jsonStringifyReplacer,2)}get isEmpty(){return 0===this.issues.length}flatten(e=e=>e.message){const t={},i=[];for(const n of this.issues)n.path.length>0?(t[n.path[0]]=t[n.path[0]]||[],t[n.path[0]].push(e(n))):i.push(e(n));return{formErrors:i,fieldErrors:t}}get formErrors(){return this.flatten()}}V.create=e=>new V(e);const Z=(e,t)=>{let i;switch(e.code){case F.invalid_type:i=e.received===I.undefined?"Required":`Expected ${e.expected}, received ${e.received}`;break;case F.invalid_literal:i=`Invalid literal value, expected ${JSON.stringify(e.expected,N.jsonStringifyReplacer)}`;break;case F.unrecognized_keys:i=`Unrecognized key(s) in object: ${N.joinValues(e.keys,", ")}`;break;case F.invalid_union:i="Invalid input";break;case F.invalid_union_discriminator:i=`Invalid discriminator value. Expected ${N.joinValues(e.options)}`;break;case F.invalid_enum_value:i=`Invalid enum value. Expected ${N.joinValues(e.options)}, received '${e.received}'`;break;case F.invalid_arguments:i="Invalid function arguments";break;case F.invalid_return_type:i="Invalid function return type";break;case F.invalid_date:i="Invalid date";break;case F.invalid_string:"object"==typeof e.validation?"includes"in e.validation?(i=`Invalid input: must include "${e.validation.includes}"`,"number"==typeof e.validation.position&&(i=`${i} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?i=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?i=`Invalid input: must end with "${e.validation.endsWith}"`:N.assertNever(e.validation):i="regex"!==e.validation?`Invalid ${e.validation}`:"Invalid";break;case F.too_small:i="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:"date"===e.type?`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:"Invalid input";break;case F.too_big:i="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"bigint"===e.type?`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"date"===e.type?`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:"Invalid input";break;case F.custom:i="Invalid input";break;case F.invalid_intersection_types:i="Intersection results could not be merged";break;case F.not_multiple_of:i=`Number must be a multiple of ${e.multipleOf}`;break;case F.not_finite:i="Number must be finite";break;default:i=t.defaultError,N.assertNever(e)}return{message:i}};let B=Z;function U(){return B}const $=e=>{const{data:t,path:i,errorMaps:n,issueData:r}=e,s=[...i,...r.path||[]],a=Object.assign(Object.assign({},r),{path:s});let o="";const c=n.filter(e=>!!e).slice().reverse();for(const e of c)o=e(a,{data:t,defaultError:o}).message;return Object.assign(Object.assign({},r),{path:s,message:r.message||o})};function z(e,t){const i=$({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,U(),Z].filter(e=>!!e)});e.common.issues.push(i)}class q{constructor(){this.value="valid"}dirty(){"valid"===this.value&&(this.value="dirty")}abort(){"aborted"!==this.value&&(this.value="aborted")}static mergeArray(e,t){const i=[];for(const n of t){if("aborted"===n.status)return G;"dirty"===n.status&&e.dirty(),i.push(n.value)}return{status:e.value,value:i}}static mergeObjectAsync(e,t){return A(this,void 0,void 0,function*(){const i=[];for(const e of t)i.push({key:yield e.key,value:yield e.value});return q.mergeObjectSync(e,i)})}static mergeObjectSync(e,t){const i={};for(const n of t){const{key:t,value:r}=n;if("aborted"===t.status)return G;if("aborted"===r.status)return G;"dirty"===t.status&&e.dirty(),"dirty"===r.status&&e.dirty(),"__proto__"===t.value||void 0===r.value&&!n.alwaysSet||(i[t.value]=r.value)}return{status:e.value,value:i}}}const G=Object.freeze({status:"aborted"}),W=e=>({status:"dirty",value:e}),K=e=>({status:"valid",value:e}),H=e=>"aborted"===e.status,J=e=>"dirty"===e.status,Q=e=>"valid"===e.status,X=e=>"undefined"!=typeof Promise&&e instanceof Promise;var Y;!function(e){e.errToObj=e=>"string"==typeof e?{message:e}:e||{},e.toString=e=>"string"==typeof e?e:null==e?void 0:e.message}(Y||(Y={}));class ee{constructor(e,t,i,n){this._cachedPath=[],this.parent=e,this.data=t,this._path=i,this._key=n}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const te=(e,t)=>{if(Q(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new V(e.common.issues);return this._error=t,this._error}}};function ie(e){if(!e)return{};const{errorMap:t,invalid_type_error:i,required_error:n,description:r}=e;if(t&&(i||n))throw new Error('Can\'t use "invalid_type_error" or "required_error" in conjunction with custom error map.');if(t)return{errorMap:t,description:r};return{errorMap:(e,t)=>"invalid_type"!==e.code?{message:t.defaultError}:void 0===t.data?{message:null!=n?n:t.defaultError}:{message:null!=i?i:t.defaultError},description:r}}class ne{constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this)}get description(){return this._def.description}_getType(e){return L(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:L(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new q,ctx:{common:e.parent.common,data:e.data,parsedType:L(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(X(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const i=this.safeParse(e,t);if(i.success)return i.data;throw i.error}safeParse(e,t){var i;const n={common:{issues:[],async:null!==(i=null==t?void 0:t.async)&&void 0!==i&&i,contextualErrorMap:null==t?void 0:t.errorMap},path:(null==t?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:L(e)},r=this._parseSync({data:e,path:n.path,parent:n});return te(n,r)}parseAsync(e,t){return A(this,void 0,void 0,function*(){const i=yield this.safeParseAsync(e,t);if(i.success)return i.data;throw i.error})}safeParseAsync(e,t){return A(this,void 0,void 0,function*(){const i={common:{issues:[],contextualErrorMap:null==t?void 0:t.errorMap,async:!0},path:(null==t?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:L(e)},n=this._parse({data:e,path:i.path,parent:i}),r=yield X(n)?n:Promise.resolve(n);return te(i,r)})}refine(e,t){return this._refinement((i,n)=>{const r=e(i),s=()=>n.addIssue(Object.assign({code:F.custom},(e=>"string"==typeof t||void 0===t?{message:t}:"function"==typeof t?t(e):t)(i)));return"undefined"!=typeof Promise&&r instanceof Promise?r.then(e=>!!e||(s(),!1)):!!r||(s(),!1)})}refinement(e,t){return this._refinement((i,n)=>!!e(i)||(n.addIssue("function"==typeof t?t(i,n):t),!1))}_refinement(e){return new Ge({schema:this,typeName:rt.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}optional(){return We.create(this,this._def)}nullable(){return Ke.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return ke.create(this,this._def)}promise(){return qe.create(this,this._def)}or(e){return Pe.create([this,e],this._def)}and(e){return De.create(this,e,this._def)}transform(e){return new Ge(Object.assign(Object.assign({},ie(this._def)),{schema:this,typeName:rt.ZodEffects,effect:{type:"transform",transform:e}}))}default(e){const t="function"==typeof e?e:()=>e;return new He(Object.assign(Object.assign({},ie(this._def)),{innerType:this,defaultValue:t,typeName:rt.ZodDefault}))}brand(){return new Ye(Object.assign({typeName:rt.ZodBranded,type:this},ie(this._def)))}catch(e){const t="function"==typeof e?e:()=>e;return new Je(Object.assign(Object.assign({},ie(this._def)),{innerType:this,catchValue:t,typeName:rt.ZodCatch}))}describe(e){return new(0,this.constructor)(Object.assign(Object.assign({},this._def),{description:e}))}pipe(e){return et.create(this,e)}readonly(){return tt.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const re=/^c[^\s-]{8,}$/i,se=/^[a-z][a-z0-9]*$/,ae=/^[0-9A-HJKMNP-TV-Z]{26}$/,oe=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,ce=/^(?!\.)(?!.*\.\.)([A-Z0-9_+-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i;let de;const le=/^(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))$/,ue=/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,pe=e=>e.precision?e.offset?new RegExp(`^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{${e.precision}}(([+-]\\d{2}(:?\\d{2})?)|Z)$`):new RegExp(`^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{${e.precision}}Z$`):0===e.precision?e.offset?new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(([+-]\\d{2}(:?\\d{2})?)|Z)$"):new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}Z$"):e.offset?new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?(([+-]\\d{2}(:?\\d{2})?)|Z)$"):new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?Z$");function he(e,t){return!("v4"!==t&&t||!le.test(e))||!("v6"!==t&&t||!ue.test(e))}class me extends ne{_parse(e){this._def.coerce&&(e.data=String(e.data));if(this._getType(e)!==I.string){const t=this._getOrReturnCtx(e);return z(t,{code:F.invalid_type,expected:I.string,received:t.parsedType}),G}const t=new q;let i;for(const n of this._def.checks)if("min"===n.kind)e.data.length<n.value&&(i=this._getOrReturnCtx(e,i),z(i,{code:F.too_small,minimum:n.value,type:"string",inclusive:!0,exact:!1,message:n.message}),t.dirty());else if("max"===n.kind)e.data.length>n.value&&(i=this._getOrReturnCtx(e,i),z(i,{code:F.too_big,maximum:n.value,type:"string",inclusive:!0,exact:!1,message:n.message}),t.dirty());else if("length"===n.kind){const r=e.data.length>n.value,s=e.data.length<n.value;(r||s)&&(i=this._getOrReturnCtx(e,i),r?z(i,{code:F.too_big,maximum:n.value,type:"string",inclusive:!0,exact:!0,message:n.message}):s&&z(i,{code:F.too_small,minimum:n.value,type:"string",inclusive:!0,exact:!0,message:n.message}),t.dirty())}else if("email"===n.kind)ce.test(e.data)||(i=this._getOrReturnCtx(e,i),z(i,{validation:"email",code:F.invalid_string,message:n.message}),t.dirty());else if("emoji"===n.kind)de||(de=new RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),de.test(e.data)||(i=this._getOrReturnCtx(e,i),z(i,{validation:"emoji",code:F.invalid_string,message:n.message}),t.dirty());else if("uuid"===n.kind)oe.test(e.data)||(i=this._getOrReturnCtx(e,i),z(i,{validation:"uuid",code:F.invalid_string,message:n.message}),t.dirty());else if("cuid"===n.kind)re.test(e.data)||(i=this._getOrReturnCtx(e,i),z(i,{validation:"cuid",code:F.invalid_string,message:n.message}),t.dirty());else if("cuid2"===n.kind)se.test(e.data)||(i=this._getOrReturnCtx(e,i),z(i,{validation:"cuid2",code:F.invalid_string,message:n.message}),t.dirty());else if("ulid"===n.kind)ae.test(e.data)||(i=this._getOrReturnCtx(e,i),z(i,{validation:"ulid",code:F.invalid_string,message:n.message}),t.dirty());else if("url"===n.kind)try{new URL(e.data)}catch(r){i=this._getOrReturnCtx(e,i),z(i,{validation:"url",code:F.invalid_string,message:n.message}),t.dirty()}else if("regex"===n.kind){n.regex.lastIndex=0;n.regex.test(e.data)||(i=this._getOrReturnCtx(e,i),z(i,{validation:"regex",code:F.invalid_string,message:n.message}),t.dirty())}else if("trim"===n.kind)e.data=e.data.trim();else if("includes"===n.kind)e.data.includes(n.value,n.position)||(i=this._getOrReturnCtx(e,i),z(i,{code:F.invalid_string,validation:{includes:n.value,position:n.position},message:n.message}),t.dirty());else if("toLowerCase"===n.kind)e.data=e.data.toLowerCase();else if("toUpperCase"===n.kind)e.data=e.data.toUpperCase();else if("startsWith"===n.kind)e.data.startsWith(n.value)||(i=this._getOrReturnCtx(e,i),z(i,{code:F.invalid_string,validation:{startsWith:n.value},message:n.message}),t.dirty());else if("endsWith"===n.kind)e.data.endsWith(n.value)||(i=this._getOrReturnCtx(e,i),z(i,{code:F.invalid_string,validation:{endsWith:n.value},message:n.message}),t.dirty());else if("datetime"===n.kind){pe(n).test(e.data)||(i=this._getOrReturnCtx(e,i),z(i,{code:F.invalid_string,validation:"datetime",message:n.message}),t.dirty())}else"ip"===n.kind?he(e.data,n.version)||(i=this._getOrReturnCtx(e,i),z(i,{validation:"ip",code:F.invalid_string,message:n.message}),t.dirty()):N.assertNever(n);return{status:t.value,value:e.data}}_regex(e,t,i){return this.refinement(t=>e.test(t),Object.assign({validation:t,code:F.invalid_string},Y.errToObj(i)))}_addCheck(e){return new me(Object.assign(Object.assign({},this._def),{checks:[...this._def.checks,e]}))}email(e){return this._addCheck(Object.assign({kind:"email"},Y.errToObj(e)))}url(e){return this._addCheck(Object.assign({kind:"url"},Y.errToObj(e)))}emoji(e){return this._addCheck(Object.assign({kind:"emoji"},Y.errToObj(e)))}uuid(e){return this._addCheck(Object.assign({kind:"uuid"},Y.errToObj(e)))}cuid(e){return this._addCheck(Object.assign({kind:"cuid"},Y.errToObj(e)))}cuid2(e){return this._addCheck(Object.assign({kind:"cuid2"},Y.errToObj(e)))}ulid(e){return this._addCheck(Object.assign({kind:"ulid"},Y.errToObj(e)))}ip(e){return this._addCheck(Object.assign({kind:"ip"},Y.errToObj(e)))}datetime(e){var t;return"string"==typeof e?this._addCheck({kind:"datetime",precision:null,offset:!1,message:e}):this._addCheck(Object.assign({kind:"datetime",precision:void 0===(null==e?void 0:e.precision)?null:null==e?void 0:e.precision,offset:null!==(t=null==e?void 0:e.offset)&&void 0!==t&&t},Y.errToObj(null==e?void 0:e.message)))}regex(e,t){return this._addCheck(Object.assign({kind:"regex",regex:e},Y.errToObj(t)))}includes(e,t){return this._addCheck(Object.assign({kind:"includes",value:e,position:null==t?void 0:t.position},Y.errToObj(null==t?void 0:t.message)))}startsWith(e,t){return this._addCheck(Object.assign({kind:"startsWith",value:e},Y.errToObj(t)))}endsWith(e,t){return this._addCheck(Object.assign({kind:"endsWith",value:e},Y.errToObj(t)))}min(e,t){return this._addCheck(Object.assign({kind:"min",value:e},Y.errToObj(t)))}max(e,t){return this._addCheck(Object.assign({kind:"max",value:e},Y.errToObj(t)))}length(e,t){return this._addCheck(Object.assign({kind:"length",value:e},Y.errToObj(t)))}nonempty(e){return this.min(1,Y.errToObj(e))}trim(){return new me(Object.assign(Object.assign({},this._def),{checks:[...this._def.checks,{kind:"trim"}]}))}toLowerCase(){return new me(Object.assign(Object.assign({},this._def),{checks:[...this._def.checks,{kind:"toLowerCase"}]}))}toUpperCase(){return new me(Object.assign(Object.assign({},this._def),{checks:[...this._def.checks,{kind:"toUpperCase"}]}))}get isDatetime(){return!!this._def.checks.find(e=>"datetime"===e.kind)}get isEmail(){return!!this._def.checks.find(e=>"email"===e.kind)}get isURL(){return!!this._def.checks.find(e=>"url"===e.kind)}get isEmoji(){return!!this._def.checks.find(e=>"emoji"===e.kind)}get isUUID(){return!!this._def.checks.find(e=>"uuid"===e.kind)}get isCUID(){return!!this._def.checks.find(e=>"cuid"===e.kind)}get isCUID2(){return!!this._def.checks.find(e=>"cuid2"===e.kind)}get isULID(){return!!this._def.checks.find(e=>"ulid"===e.kind)}get isIP(){return!!this._def.checks.find(e=>"ip"===e.kind)}get minLength(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}function fe(e,t){const i=(e.toString().split(".")[1]||"").length,n=(t.toString().split(".")[1]||"").length,r=i>n?i:n;return parseInt(e.toFixed(r).replace(".",""))%parseInt(t.toFixed(r).replace(".",""))/Math.pow(10,r)}me.create=e=>{var t;return new me(Object.assign({checks:[],typeName:rt.ZodString,coerce:null!==(t=null==e?void 0:e.coerce)&&void 0!==t&&t},ie(e)))};class ge extends ne{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){this._def.coerce&&(e.data=Number(e.data));if(this._getType(e)!==I.number){const t=this._getOrReturnCtx(e);return z(t,{code:F.invalid_type,expected:I.number,received:t.parsedType}),G}let t;const i=new q;for(const n of this._def.checks)if("int"===n.kind)N.isInteger(e.data)||(t=this._getOrReturnCtx(e,t),z(t,{code:F.invalid_type,expected:"integer",received:"float",message:n.message}),i.dirty());else if("min"===n.kind){(n.inclusive?e.data<n.value:e.data<=n.value)&&(t=this._getOrReturnCtx(e,t),z(t,{code:F.too_small,minimum:n.value,type:"number",inclusive:n.inclusive,exact:!1,message:n.message}),i.dirty())}else if("max"===n.kind){(n.inclusive?e.data>n.value:e.data>=n.value)&&(t=this._getOrReturnCtx(e,t),z(t,{code:F.too_big,maximum:n.value,type:"number",inclusive:n.inclusive,exact:!1,message:n.message}),i.dirty())}else"multipleOf"===n.kind?0!==fe(e.data,n.value)&&(t=this._getOrReturnCtx(e,t),z(t,{code:F.not_multiple_of,multipleOf:n.value,message:n.message}),i.dirty()):"finite"===n.kind?Number.isFinite(e.data)||(t=this._getOrReturnCtx(e,t),z(t,{code:F.not_finite,message:n.message}),i.dirty()):N.assertNever(n);return{status:i.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,Y.toString(t))}gt(e,t){return this.setLimit("min",e,!1,Y.toString(t))}lte(e,t){return this.setLimit("max",e,!0,Y.toString(t))}lt(e,t){return this.setLimit("max",e,!1,Y.toString(t))}setLimit(e,t,i,n){return new ge(Object.assign(Object.assign({},this._def),{checks:[...this._def.checks,{kind:e,value:t,inclusive:i,message:Y.toString(n)}]}))}_addCheck(e){return new ge(Object.assign(Object.assign({},this._def),{checks:[...this._def.checks,e]}))}int(e){return this._addCheck({kind:"int",message:Y.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:Y.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:Y.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:Y.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:Y.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:Y.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:Y.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:Y.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:Y.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>"int"===e.kind||"multipleOf"===e.kind&&N.isInteger(e.value))}get isFinite(){let e=null,t=null;for(const i of this._def.checks){if("finite"===i.kind||"int"===i.kind||"multipleOf"===i.kind)return!0;"min"===i.kind?(null===t||i.value>t)&&(t=i.value):"max"===i.kind&&(null===e||i.value<e)&&(e=i.value)}return Number.isFinite(t)&&Number.isFinite(e)}}ge.create=e=>new ge(Object.assign({checks:[],typeName:rt.ZodNumber,coerce:(null==e?void 0:e.coerce)||!1},ie(e)));class ve extends ne{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){this._def.coerce&&(e.data=BigInt(e.data));if(this._getType(e)!==I.bigint){const t=this._getOrReturnCtx(e);return z(t,{code:F.invalid_type,expected:I.bigint,received:t.parsedType}),G}let t;const i=new q;for(const n of this._def.checks)if("min"===n.kind){(n.inclusive?e.data<n.value:e.data<=n.value)&&(t=this._getOrReturnCtx(e,t),z(t,{code:F.too_small,type:"bigint",minimum:n.value,inclusive:n.inclusive,message:n.message}),i.dirty())}else if("max"===n.kind){(n.inclusive?e.data>n.value:e.data>=n.value)&&(t=this._getOrReturnCtx(e,t),z(t,{code:F.too_big,type:"bigint",maximum:n.value,inclusive:n.inclusive,message:n.message}),i.dirty())}else"multipleOf"===n.kind?e.data%n.value!==BigInt(0)&&(t=this._getOrReturnCtx(e,t),z(t,{code:F.not_multiple_of,multipleOf:n.value,message:n.message}),i.dirty()):N.assertNever(n);return{status:i.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,Y.toString(t))}gt(e,t){return this.setLimit("min",e,!1,Y.toString(t))}lte(e,t){return this.setLimit("max",e,!0,Y.toString(t))}lt(e,t){return this.setLimit("max",e,!1,Y.toString(t))}setLimit(e,t,i,n){return new ve(Object.assign(Object.assign({},this._def),{checks:[...this._def.checks,{kind:e,value:t,inclusive:i,message:Y.toString(n)}]}))}_addCheck(e){return new ve(Object.assign(Object.assign({},this._def),{checks:[...this._def.checks,e]}))}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:Y.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:Y.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:Y.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:Y.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:Y.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}ve.create=e=>{var t;return new ve(Object.assign({checks:[],typeName:rt.ZodBigInt,coerce:null!==(t=null==e?void 0:e.coerce)&&void 0!==t&&t},ie(e)))};class ye extends ne{_parse(e){this._def.coerce&&(e.data=Boolean(e.data));if(this._getType(e)!==I.boolean){const t=this._getOrReturnCtx(e);return z(t,{code:F.invalid_type,expected:I.boolean,received:t.parsedType}),G}return K(e.data)}}ye.create=e=>new ye(Object.assign({typeName:rt.ZodBoolean,coerce:(null==e?void 0:e.coerce)||!1},ie(e)));class _e extends ne{_parse(e){this._def.coerce&&(e.data=new Date(e.data));if(this._getType(e)!==I.date){const t=this._getOrReturnCtx(e);return z(t,{code:F.invalid_type,expected:I.date,received:t.parsedType}),G}if(isNaN(e.data.getTime())){return z(this._getOrReturnCtx(e),{code:F.invalid_date}),G}const t=new q;let i;for(const n of this._def.checks)"min"===n.kind?e.data.getTime()<n.value&&(i=this._getOrReturnCtx(e,i),z(i,{code:F.too_small,message:n.message,inclusive:!0,exact:!1,minimum:n.value,type:"date"}),t.dirty()):"max"===n.kind?e.data.getTime()>n.value&&(i=this._getOrReturnCtx(e,i),z(i,{code:F.too_big,message:n.message,inclusive:!0,exact:!1,maximum:n.value,type:"date"}),t.dirty()):N.assertNever(n);return{status:t.value,value:new Date(e.data.getTime())}}_addCheck(e){return new _e(Object.assign(Object.assign({},this._def),{checks:[...this._def.checks,e]}))}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:Y.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:Y.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return null!=e?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return null!=e?new Date(e):null}}_e.create=e=>new _e(Object.assign({checks:[],coerce:(null==e?void 0:e.coerce)||!1,typeName:rt.ZodDate},ie(e)));class be extends ne{_parse(e){if(this._getType(e)!==I.symbol){const t=this._getOrReturnCtx(e);return z(t,{code:F.invalid_type,expected:I.symbol,received:t.parsedType}),G}return K(e.data)}}be.create=e=>new be(Object.assign({typeName:rt.ZodSymbol},ie(e)));class Se extends ne{_parse(e){if(this._getType(e)!==I.undefined){const t=this._getOrReturnCtx(e);return z(t,{code:F.invalid_type,expected:I.undefined,received:t.parsedType}),G}return K(e.data)}}Se.create=e=>new Se(Object.assign({typeName:rt.ZodUndefined},ie(e)));class Ce extends ne{_parse(e){if(this._getType(e)!==I.null){const t=this._getOrReturnCtx(e);return z(t,{code:F.invalid_type,expected:I.null,received:t.parsedType}),G}return K(e.data)}}Ce.create=e=>new Ce(Object.assign({typeName:rt.ZodNull},ie(e)));class we extends ne{constructor(){super(...arguments),this._any=!0}_parse(e){return K(e.data)}}we.create=e=>new we(Object.assign({typeName:rt.ZodAny},ie(e)));class Te extends ne{constructor(){super(...arguments),this._unknown=!0}_parse(e){return K(e.data)}}Te.create=e=>new Te(Object.assign({typeName:rt.ZodUnknown},ie(e)));class Re extends ne{_parse(e){const t=this._getOrReturnCtx(e);return z(t,{code:F.invalid_type,expected:I.never,received:t.parsedType}),G}}Re.create=e=>new Re(Object.assign({typeName:rt.ZodNever},ie(e)));class xe extends ne{_parse(e){if(this._getType(e)!==I.undefined){const t=this._getOrReturnCtx(e);return z(t,{code:F.invalid_type,expected:I.void,received:t.parsedType}),G}return K(e.data)}}xe.create=e=>new xe(Object.assign({typeName:rt.ZodVoid},ie(e)));class ke extends ne{_parse(e){const{ctx:t,status:i}=this._processInputParams(e),n=this._def;if(t.parsedType!==I.array)return z(t,{code:F.invalid_type,expected:I.array,received:t.parsedType}),G;if(null!==n.exactLength){const e=t.data.length>n.exactLength.value,r=t.data.length<n.exactLength.value;(e||r)&&(z(t,{code:e?F.too_big:F.too_small,minimum:r?n.exactLength.value:void 0,maximum:e?n.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:n.exactLength.message}),i.dirty())}if(null!==n.minLength&&t.data.length<n.minLength.value&&(z(t,{code:F.too_small,minimum:n.minLength.value,type:"array",inclusive:!0,exact:!1,message:n.minLength.message}),i.dirty()),null!==n.maxLength&&t.data.length>n.maxLength.value&&(z(t,{code:F.too_big,maximum:n.maxLength.value,type:"array",inclusive:!0,exact:!1,message:n.maxLength.message}),i.dirty()),t.common.async)return Promise.all([...t.data].map((e,i)=>n.type._parseAsync(new ee(t,e,t.path,i)))).then(e=>q.mergeArray(i,e));const r=[...t.data].map((e,i)=>n.type._parseSync(new ee(t,e,t.path,i)));return q.mergeArray(i,r)}get element(){return this._def.type}min(e,t){return new ke(Object.assign(Object.assign({},this._def),{minLength:{value:e,message:Y.toString(t)}}))}max(e,t){return new ke(Object.assign(Object.assign({},this._def),{maxLength:{value:e,message:Y.toString(t)}}))}length(e,t){return new ke(Object.assign(Object.assign({},this._def),{exactLength:{value:e,message:Y.toString(t)}}))}nonempty(e){return this.min(1,e)}}function Ee(e){if(e instanceof Oe){const t={};for(const i in e.shape){const n=e.shape[i];t[i]=We.create(Ee(n))}return new Oe(Object.assign(Object.assign({},e._def),{shape:()=>t}))}return e instanceof ke?new ke(Object.assign(Object.assign({},e._def),{type:Ee(e.element)})):e instanceof We?We.create(Ee(e.unwrap())):e instanceof Ke?Ke.create(Ee(e.unwrap())):e instanceof Ae?Ae.create(e.items.map(e=>Ee(e))):e}ke.create=(e,t)=>new ke(Object.assign({type:e,minLength:null,maxLength:null,exactLength:null,typeName:rt.ZodArray},ie(t)));class Oe extends ne{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(null!==this._cached)return this._cached;const e=this._def.shape(),t=N.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){if(this._getType(e)!==I.object){const t=this._getOrReturnCtx(e);return z(t,{code:F.invalid_type,expected:I.object,received:t.parsedType}),G}const{status:t,ctx:i}=this._processInputParams(e),{shape:n,keys:r}=this._getCached(),s=[];if(!(this._def.catchall instanceof Re&&"strip"===this._def.unknownKeys))for(const e in i.data)r.includes(e)||s.push(e);const a=[];for(const e of r){const t=n[e],r=i.data[e];a.push({key:{status:"valid",value:e},value:t._parse(new ee(i,r,i.path,e)),alwaysSet:e in i.data})}if(this._def.catchall instanceof Re){const e=this._def.unknownKeys;if("passthrough"===e)for(const e of s)a.push({key:{status:"valid",value:e},value:{status:"valid",value:i.data[e]}});else if("strict"===e)s.length>0&&(z(i,{code:F.unrecognized_keys,keys:s}),t.dirty());else if("strip"!==e)throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const e=this._def.catchall;for(const t of s){const n=i.data[t];a.push({key:{status:"valid",value:t},value:e._parse(new ee(i,n,i.path,t)),alwaysSet:t in i.data})}}return i.common.async?Promise.resolve().then(()=>A(this,void 0,void 0,function*(){const e=[];for(const t of a){const i=yield t.key;e.push({key:i,value:yield t.value,alwaysSet:t.alwaysSet})}return e})).then(e=>q.mergeObjectSync(t,e)):q.mergeObjectSync(t,a)}get shape(){return this._def.shape()}strict(e){return Y.errToObj,new Oe(Object.assign(Object.assign(Object.assign({},this._def),{unknownKeys:"strict"}),void 0!==e?{errorMap:(t,i)=>{var n,r,s,a;const o=null!==(s=null===(r=(n=this._def).errorMap)||void 0===r?void 0:r.call(n,t,i).message)&&void 0!==s?s:i.defaultError;return"unrecognized_keys"===t.code?{message:null!==(a=Y.errToObj(e).message)&&void 0!==a?a:o}:{message:o}}}:{}))}strip(){return new Oe(Object.assign(Object.assign({},this._def),{unknownKeys:"strip"}))}passthrough(){return new Oe(Object.assign(Object.assign({},this._def),{unknownKeys:"passthrough"}))}extend(e){return new Oe(Object.assign(Object.assign({},this._def),{shape:()=>Object.assign(Object.assign({},this._def.shape()),e)}))}merge(e){return new Oe({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>Object.assign(Object.assign({},this._def.shape()),e._def.shape()),typeName:rt.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new Oe(Object.assign(Object.assign({},this._def),{catchall:e}))}pick(e){const t={};return N.objectKeys(e).forEach(i=>{e[i]&&this.shape[i]&&(t[i]=this.shape[i])}),new Oe(Object.assign(Object.assign({},this._def),{shape:()=>t}))}omit(e){const t={};return N.objectKeys(this.shape).forEach(i=>{e[i]||(t[i]=this.shape[i])}),new Oe(Object.assign(Object.assign({},this._def),{shape:()=>t}))}deepPartial(){return Ee(this)}partial(e){const t={};return N.objectKeys(this.shape).forEach(i=>{const n=this.shape[i];e&&!e[i]?t[i]=n:t[i]=n.optional()}),new Oe(Object.assign(Object.assign({},this._def),{shape:()=>t}))}required(e){const t={};return N.objectKeys(this.shape).forEach(i=>{if(e&&!e[i])t[i]=this.shape[i];else{let e=this.shape[i];for(;e instanceof We;)e=e._def.innerType;t[i]=e}}),new Oe(Object.assign(Object.assign({},this._def),{shape:()=>t}))}keyof(){return Ue(N.objectKeys(this.shape))}}Oe.create=(e,t)=>new Oe(Object.assign({shape:()=>e,unknownKeys:"strip",catchall:Re.create(),typeName:rt.ZodObject},ie(t))),Oe.strictCreate=(e,t)=>new Oe(Object.assign({shape:()=>e,unknownKeys:"strict",catchall:Re.create(),typeName:rt.ZodObject},ie(t))),Oe.lazycreate=(e,t)=>new Oe(Object.assign({shape:e,unknownKeys:"strip",catchall:Re.create(),typeName:rt.ZodObject},ie(t)));class Pe extends ne{_parse(e){const{ctx:t}=this._processInputParams(e),i=this._def.options;if(t.common.async)return Promise.all(i.map(e=>A(this,void 0,void 0,function*(){const i=Object.assign(Object.assign({},t),{common:Object.assign(Object.assign({},t.common),{issues:[]}),parent:null});return{result:yield e._parseAsync({data:t.data,path:t.path,parent:i}),ctx:i}}))).then(function(e){for(const t of e)if("valid"===t.result.status)return t.result;for(const i of e)if("dirty"===i.result.status)return t.common.issues.push(...i.ctx.common.issues),i.result;const i=e.map(e=>new V(e.ctx.common.issues));return z(t,{code:F.invalid_union,unionErrors:i}),G});{let e;const n=[];for(const r of i){const i=Object.assign(Object.assign({},t),{common:Object.assign(Object.assign({},t.common),{issues:[]}),parent:null}),s=r._parseSync({data:t.data,path:t.path,parent:i});if("valid"===s.status)return s;"dirty"!==s.status||e||(e={result:s,ctx:i}),i.common.issues.length&&n.push(i.common.issues)}if(e)return t.common.issues.push(...e.ctx.common.issues),e.result;const r=n.map(e=>new V(e));return z(t,{code:F.invalid_union,unionErrors:r}),G}}get options(){return this._def.options}}Pe.create=(e,t)=>new Pe(Object.assign({options:e,typeName:rt.ZodUnion},ie(t)));const Me=e=>e instanceof Ze?Me(e.schema):e instanceof Ge?Me(e.innerType()):e instanceof Be?[e.value]:e instanceof $e?e.options:e instanceof ze?Object.keys(e.enum):e instanceof He?Me(e._def.innerType):e instanceof Se?[void 0]:e instanceof Ce?[null]:null;class je extends ne{_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==I.object)return z(t,{code:F.invalid_type,expected:I.object,received:t.parsedType}),G;const i=this.discriminator,n=t.data[i],r=this.optionsMap.get(n);return r?t.common.async?r._parseAsync({data:t.data,path:t.path,parent:t}):r._parseSync({data:t.data,path:t.path,parent:t}):(z(t,{code:F.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[i]}),G)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,i){const n=new Map;for(const i of t){const t=Me(i.shape[e]);if(!t)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(const r of t){if(n.has(r))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(r)}`);n.set(r,i)}}return new je(Object.assign({typeName:rt.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:n},ie(i)))}}function Ne(e,t){const i=L(e),n=L(t);if(e===t)return{valid:!0,data:e};if(i===I.object&&n===I.object){const i=N.objectKeys(t),n=N.objectKeys(e).filter(e=>-1!==i.indexOf(e)),r=Object.assign(Object.assign({},e),t);for(const i of n){const n=Ne(e[i],t[i]);if(!n.valid)return{valid:!1};r[i]=n.data}return{valid:!0,data:r}}if(i===I.array&&n===I.array){if(e.length!==t.length)return{valid:!1};const i=[];for(let n=0;n<e.length;n++){const r=Ne(e[n],t[n]);if(!r.valid)return{valid:!1};i.push(r.data)}return{valid:!0,data:i}}return i===I.date&&n===I.date&&+e===+t?{valid:!0,data:e}:{valid:!1}}class De extends ne{_parse(e){const{status:t,ctx:i}=this._processInputParams(e),n=(e,n)=>{if(H(e)||H(n))return G;const r=Ne(e.value,n.value);return r.valid?((J(e)||J(n))&&t.dirty(),{status:t.value,value:r.data}):(z(i,{code:F.invalid_intersection_types}),G)};return i.common.async?Promise.all([this._def.left._parseAsync({data:i.data,path:i.path,parent:i}),this._def.right._parseAsync({data:i.data,path:i.path,parent:i})]).then(([e,t])=>n(e,t)):n(this._def.left._parseSync({data:i.data,path:i.path,parent:i}),this._def.right._parseSync({data:i.data,path:i.path,parent:i}))}}De.create=(e,t,i)=>new De(Object.assign({left:e,right:t,typeName:rt.ZodIntersection},ie(i)));class Ae extends ne{_parse(e){const{status:t,ctx:i}=this._processInputParams(e);if(i.parsedType!==I.array)return z(i,{code:F.invalid_type,expected:I.array,received:i.parsedType}),G;if(i.data.length<this._def.items.length)return z(i,{code:F.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),G;!this._def.rest&&i.data.length>this._def.items.length&&(z(i,{code:F.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const n=[...i.data].map((e,t)=>{const n=this._def.items[t]||this._def.rest;return n?n._parse(new ee(i,e,i.path,t)):null}).filter(e=>!!e);return i.common.async?Promise.all(n).then(e=>q.mergeArray(t,e)):q.mergeArray(t,n)}get items(){return this._def.items}rest(e){return new Ae(Object.assign(Object.assign({},this._def),{rest:e}))}}Ae.create=(e,t)=>{if(!Array.isArray(e))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Ae(Object.assign({items:e,typeName:rt.ZodTuple,rest:null},ie(t)))};class Ie extends ne{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:i}=this._processInputParams(e);if(i.parsedType!==I.object)return z(i,{code:F.invalid_type,expected:I.object,received:i.parsedType}),G;const n=[],r=this._def.keyType,s=this._def.valueType;for(const e in i.data)n.push({key:r._parse(new ee(i,e,i.path,e)),value:s._parse(new ee(i,i.data[e],i.path,e))});return i.common.async?q.mergeObjectAsync(t,n):q.mergeObjectSync(t,n)}get element(){return this._def.valueType}static create(e,t,i){return new Ie(t instanceof ne?Object.assign({keyType:e,valueType:t,typeName:rt.ZodRecord},ie(i)):Object.assign({keyType:me.create(),valueType:e,typeName:rt.ZodRecord},ie(t)))}}class Le extends ne{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:i}=this._processInputParams(e);if(i.parsedType!==I.map)return z(i,{code:F.invalid_type,expected:I.map,received:i.parsedType}),G;const n=this._def.keyType,r=this._def.valueType,s=[...i.data.entries()].map(([e,t],s)=>({key:n._parse(new ee(i,e,i.path,[s,"key"])),value:r._parse(new ee(i,t,i.path,[s,"value"]))}));if(i.common.async){const e=new Map;return Promise.resolve().then(()=>A(this,void 0,void 0,function*(){for(const i of s){const n=yield i.key,r=yield i.value;if("aborted"===n.status||"aborted"===r.status)return G;"dirty"!==n.status&&"dirty"!==r.status||t.dirty(),e.set(n.value,r.value)}return{status:t.value,value:e}}))}{const e=new Map;for(const i of s){const n=i.key,r=i.value;if("aborted"===n.status||"aborted"===r.status)return G;"dirty"!==n.status&&"dirty"!==r.status||t.dirty(),e.set(n.value,r.value)}return{status:t.value,value:e}}}}Le.create=(e,t,i)=>new Le(Object.assign({valueType:t,keyType:e,typeName:rt.ZodMap},ie(i)));class Fe extends ne{_parse(e){const{status:t,ctx:i}=this._processInputParams(e);if(i.parsedType!==I.set)return z(i,{code:F.invalid_type,expected:I.set,received:i.parsedType}),G;const n=this._def;null!==n.minSize&&i.data.size<n.minSize.value&&(z(i,{code:F.too_small,minimum:n.minSize.value,type:"set",inclusive:!0,exact:!1,message:n.minSize.message}),t.dirty()),null!==n.maxSize&&i.data.size>n.maxSize.value&&(z(i,{code:F.too_big,maximum:n.maxSize.value,type:"set",inclusive:!0,exact:!1,message:n.maxSize.message}),t.dirty());const r=this._def.valueType;function s(e){const i=new Set;for(const n of e){if("aborted"===n.status)return G;"dirty"===n.status&&t.dirty(),i.add(n.value)}return{status:t.value,value:i}}const a=[...i.data.values()].map((e,t)=>r._parse(new ee(i,e,i.path,t)));return i.common.async?Promise.all(a).then(e=>s(e)):s(a)}min(e,t){return new Fe(Object.assign(Object.assign({},this._def),{minSize:{value:e,message:Y.toString(t)}}))}max(e,t){return new Fe(Object.assign(Object.assign({},this._def),{maxSize:{value:e,message:Y.toString(t)}}))}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}Fe.create=(e,t)=>new Fe(Object.assign({valueType:e,minSize:null,maxSize:null,typeName:rt.ZodSet},ie(t)));class Ve extends ne{constructor(){super(...arguments),this.validate=this.implement}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==I.function)return z(t,{code:F.invalid_type,expected:I.function,received:t.parsedType}),G;function i(e,i){return $({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,U(),Z].filter(e=>!!e),issueData:{code:F.invalid_arguments,argumentsError:i}})}function n(e,i){return $({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,U(),Z].filter(e=>!!e),issueData:{code:F.invalid_return_type,returnTypeError:i}})}const r={errorMap:t.common.contextualErrorMap},s=t.data;if(this._def.returns instanceof qe){const e=this;return K(function(...t){return A(this,void 0,void 0,function*(){const a=new V([]),o=yield e._def.args.parseAsync(t,r).catch(e=>{throw a.addIssue(i(t,e)),a}),c=yield Reflect.apply(s,this,o);return yield e._def.returns._def.type.parseAsync(c,r).catch(e=>{throw a.addIssue(n(c,e)),a})})})}{const e=this;return K(function(...t){const a=e._def.args.safeParse(t,r);if(!a.success)throw new V([i(t,a.error)]);const o=Reflect.apply(s,this,a.data),c=e._def.returns.safeParse(o,r);if(!c.success)throw new V([n(o,c.error)]);return c.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new Ve(Object.assign(Object.assign({},this._def),{args:Ae.create(e).rest(Te.create())}))}returns(e){return new Ve(Object.assign(Object.assign({},this._def),{returns:e}))}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,i){return new Ve(Object.assign({args:e||Ae.create([]).rest(Te.create()),returns:t||Te.create(),typeName:rt.ZodFunction},ie(i)))}}class Ze extends ne{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}Ze.create=(e,t)=>new Ze(Object.assign({getter:e,typeName:rt.ZodLazy},ie(t)));class Be extends ne{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return z(t,{received:t.data,code:F.invalid_literal,expected:this._def.value}),G}return{status:"valid",value:e.data}}get value(){return this._def.value}}function Ue(e,t){return new $e(Object.assign({values:e,typeName:rt.ZodEnum},ie(t)))}Be.create=(e,t)=>new Be(Object.assign({value:e,typeName:rt.ZodLiteral},ie(t)));class $e extends ne{_parse(e){if("string"!=typeof e.data){const t=this._getOrReturnCtx(e),i=this._def.values;return z(t,{expected:N.joinValues(i),received:t.parsedType,code:F.invalid_type}),G}if(-1===this._def.values.indexOf(e.data)){const t=this._getOrReturnCtx(e),i=this._def.values;return z(t,{received:t.data,code:F.invalid_enum_value,options:i}),G}return K(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e){return $e.create(e)}exclude(e){return $e.create(this.options.filter(t=>!e.includes(t)))}}$e.create=Ue;class ze extends ne{_parse(e){const t=N.getValidEnumValues(this._def.values),i=this._getOrReturnCtx(e);if(i.parsedType!==I.string&&i.parsedType!==I.number){const e=N.objectValues(t);return z(i,{expected:N.joinValues(e),received:i.parsedType,code:F.invalid_type}),G}if(-1===t.indexOf(e.data)){const e=N.objectValues(t);return z(i,{received:i.data,code:F.invalid_enum_value,options:e}),G}return K(e.data)}get enum(){return this._def.values}}ze.create=(e,t)=>new ze(Object.assign({values:e,typeName:rt.ZodNativeEnum},ie(t)));class qe extends ne{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==I.promise&&!1===t.common.async)return z(t,{code:F.invalid_type,expected:I.promise,received:t.parsedType}),G;const i=t.parsedType===I.promise?t.data:Promise.resolve(t.data);return K(i.then(e=>this._def.type.parseAsync(e,{path:t.path,errorMap:t.common.contextualErrorMap})))}}qe.create=(e,t)=>new qe(Object.assign({type:e,typeName:rt.ZodPromise},ie(t)));class Ge extends ne{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===rt.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:i}=this._processInputParams(e),n=this._def.effect||null,r={addIssue:e=>{z(i,e),e.fatal?t.abort():t.dirty()},get path(){return i.path}};if(r.addIssue=r.addIssue.bind(r),"preprocess"===n.type){const e=n.transform(i.data,r);return i.common.issues.length?{status:"dirty",value:i.data}:i.common.async?Promise.resolve(e).then(e=>this._def.schema._parseAsync({data:e,path:i.path,parent:i})):this._def.schema._parseSync({data:e,path:i.path,parent:i})}if("refinement"===n.type){const e=e=>{const t=n.refinement(e,r);if(i.common.async)return Promise.resolve(t);if(t instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return e};if(!1===i.common.async){const n=this._def.schema._parseSync({data:i.data,path:i.path,parent:i});return"aborted"===n.status?G:("dirty"===n.status&&t.dirty(),e(n.value),{status:t.value,value:n.value})}return this._def.schema._parseAsync({data:i.data,path:i.path,parent:i}).then(i=>"aborted"===i.status?G:("dirty"===i.status&&t.dirty(),e(i.value).then(()=>({status:t.value,value:i.value}))))}if("transform"===n.type){if(!1===i.common.async){const e=this._def.schema._parseSync({data:i.data,path:i.path,parent:i});if(!Q(e))return e;const s=n.transform(e.value,r);if(s instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:s}}return this._def.schema._parseAsync({data:i.data,path:i.path,parent:i}).then(e=>Q(e)?Promise.resolve(n.transform(e.value,r)).then(e=>({status:t.value,value:e})):e)}N.assertNever(n)}}Ge.create=(e,t,i)=>new Ge(Object.assign({schema:e,typeName:rt.ZodEffects,effect:t},ie(i))),Ge.createWithPreprocess=(e,t,i)=>new Ge(Object.assign({schema:t,effect:{type:"preprocess",transform:e},typeName:rt.ZodEffects},ie(i)));class We extends ne{_parse(e){return this._getType(e)===I.undefined?K(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}We.create=(e,t)=>new We(Object.assign({innerType:e,typeName:rt.ZodOptional},ie(t)));class Ke extends ne{_parse(e){return this._getType(e)===I.null?K(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Ke.create=(e,t)=>new Ke(Object.assign({innerType:e,typeName:rt.ZodNullable},ie(t)));class He extends ne{_parse(e){const{ctx:t}=this._processInputParams(e);let i=t.data;return t.parsedType===I.undefined&&(i=this._def.defaultValue()),this._def.innerType._parse({data:i,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}He.create=(e,t)=>new He(Object.assign({innerType:e,typeName:rt.ZodDefault,defaultValue:"function"==typeof t.default?t.default:()=>t.default},ie(t)));class Je extends ne{_parse(e){const{ctx:t}=this._processInputParams(e),i=Object.assign(Object.assign({},t),{common:Object.assign(Object.assign({},t.common),{issues:[]})}),n=this._def.innerType._parse({data:i.data,path:i.path,parent:Object.assign({},i)});return X(n)?n.then(e=>({status:"valid",value:"valid"===e.status?e.value:this._def.catchValue({get error(){return new V(i.common.issues)},input:i.data})})):{status:"valid",value:"valid"===n.status?n.value:this._def.catchValue({get error(){return new V(i.common.issues)},input:i.data})}}removeCatch(){return this._def.innerType}}Je.create=(e,t)=>new Je(Object.assign({innerType:e,typeName:rt.ZodCatch,catchValue:"function"==typeof t.catch?t.catch:()=>t.catch},ie(t)));class Qe extends ne{_parse(e){if(this._getType(e)!==I.nan){const t=this._getOrReturnCtx(e);return z(t,{code:F.invalid_type,expected:I.nan,received:t.parsedType}),G}return{status:"valid",value:e.data}}}Qe.create=e=>new Qe(Object.assign({typeName:rt.ZodNaN},ie(e)));const Xe=Symbol("zod_brand");class Ye extends ne{_parse(e){const{ctx:t}=this._processInputParams(e),i=t.data;return this._def.type._parse({data:i,path:t.path,parent:t})}unwrap(){return this._def.type}}class et extends ne{_parse(e){const{status:t,ctx:i}=this._processInputParams(e);if(i.common.async){return(()=>A(this,void 0,void 0,function*(){const e=yield this._def.in._parseAsync({data:i.data,path:i.path,parent:i});return"aborted"===e.status?G:"dirty"===e.status?(t.dirty(),W(e.value)):this._def.out._parseAsync({data:e.value,path:i.path,parent:i})}))()}{const e=this._def.in._parseSync({data:i.data,path:i.path,parent:i});return"aborted"===e.status?G:"dirty"===e.status?(t.dirty(),{status:"dirty",value:e.value}):this._def.out._parseSync({data:e.value,path:i.path,parent:i})}}static create(e,t){return new et({in:e,out:t,typeName:rt.ZodPipeline})}}class tt extends ne{_parse(e){const t=this._def.innerType._parse(e);return Q(t)&&(t.value=Object.freeze(t.value)),t}}tt.create=(e,t)=>new tt(Object.assign({innerType:e,typeName:rt.ZodReadonly},ie(t)));const it=(e,t={},i)=>e?we.create().superRefine((n,r)=>{var s,a;if(!e(n)){const e="function"==typeof t?t(n):"string"==typeof t?{message:t}:t,o=null===(a=null!==(s=e.fatal)&&void 0!==s?s:i)||void 0===a||a,c="string"==typeof e?{message:e}:e;r.addIssue(Object.assign(Object.assign({code:"custom"},c),{fatal:o}))}}):we.create(),nt={object:Oe.lazycreate};var rt;!function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline",e.ZodReadonly="ZodReadonly"}(rt||(rt={}));const st=me.create,at=ge.create,ot=Qe.create,ct=ve.create,dt=ye.create,lt=_e.create,ut=be.create,pt=Se.create,ht=Ce.create,mt=we.create,ft=Te.create,gt=Re.create,vt=xe.create,yt=ke.create,_t=Oe.create,bt=Oe.strictCreate,St=Pe.create,Ct=je.create,wt=De.create,Tt=Ae.create,Rt=Ie.create,xt=Le.create,kt=Fe.create,Et=Ve.create,Ot=Ze.create,Pt=Be.create,Mt=$e.create,jt=ze.create,Nt=qe.create,Dt=Ge.create,At=We.create,It=Ke.create,Lt=Ge.createWithPreprocess,Ft=et.create,Vt={string:e=>me.create(Object.assign(Object.assign({},e),{coerce:!0})),number:e=>ge.create(Object.assign(Object.assign({},e),{coerce:!0})),boolean:e=>ye.create(Object.assign(Object.assign({},e),{coerce:!0})),bigint:e=>ve.create(Object.assign(Object.assign({},e),{coerce:!0})),date:e=>_e.create(Object.assign(Object.assign({},e),{coerce:!0}))},Zt=G;var Bt=Object.freeze({__proto__:null,defaultErrorMap:Z,setErrorMap:function(e){B=e},getErrorMap:U,makeIssue:$,EMPTY_PATH:[],addIssueToContext:z,ParseStatus:q,INVALID:G,DIRTY:W,OK:K,isAborted:H,isDirty:J,isValid:Q,isAsync:X,get util(){return N},get objectUtil(){return D},ZodParsedType:I,getParsedType:L,ZodType:ne,ZodString:me,ZodNumber:ge,ZodBigInt:ve,ZodBoolean:ye,ZodDate:_e,ZodSymbol:be,ZodUndefined:Se,ZodNull:Ce,ZodAny:we,ZodUnknown:Te,ZodNever:Re,ZodVoid:xe,ZodArray:ke,ZodObject:Oe,ZodUnion:Pe,ZodDiscriminatedUnion:je,ZodIntersection:De,ZodTuple:Ae,ZodRecord:Ie,ZodMap:Le,ZodSet:Fe,ZodFunction:Ve,ZodLazy:Ze,ZodLiteral:Be,ZodEnum:$e,ZodNativeEnum:ze,ZodPromise:qe,ZodEffects:Ge,ZodTransformer:Ge,ZodOptional:We,ZodNullable:Ke,ZodDefault:He,ZodCatch:Je,ZodNaN:Qe,BRAND:Xe,ZodBranded:Ye,ZodPipeline:et,ZodReadonly:tt,custom:it,Schema:ne,ZodSchema:ne,late:nt,get ZodFirstPartyTypeKind(){return rt},coerce:Vt,any:mt,array:yt,bigint:ct,boolean:dt,date:lt,discriminatedUnion:Ct,effect:Dt,enum:Mt,function:Et,instanceof:(e,t={message:`Input not instance of ${e.name}`})=>it(t=>t instanceof e,t),intersection:wt,lazy:Ot,literal:Pt,map:xt,nan:ot,nativeEnum:jt,never:gt,null:ht,nullable:It,number:at,object:_t,oboolean:()=>dt().optional(),onumber:()=>at().optional(),optional:At,ostring:()=>st().optional(),pipeline:Ft,preprocess:Lt,promise:Nt,record:Rt,set:kt,strictObject:bt,string:st,symbol:ut,transformer:Dt,tuple:Tt,undefined:pt,union:St,unknown:ft,void:vt,NEVER:Zt,ZodIssueCode:F,quotelessJson:e=>JSON.stringify(e,null,2).replace(/"([^"]+)":/g,"$1:"),ZodError:V});const{cloneSerializable:Ut}=f,$t={auth:null,streamName:null,serverUrl:"https://bintu-webrtc.nanocosmos.de/p/webrtc",ingestUrl:"rtmp://bintu-stream.nanocosmos.de:1935/live",inputCfg:{mediaStream:null,mediaStreamCfg:null,muted:{audio:!1,video:!1},broadcastCfg:null},previewVideoElId:null,metrics:{accountId:"webrtc-client-app",accountKey:"ncfl6c6it9zu3kk7"},reconnect:{minDelaySec:2,maxDelaySec:15,maxRetries:10}};function zt(){return Ut($t)}const{isEmpty:qt,isObject:Gt,removeTrailingSlash:Wt}=f;const Kt=zt(),Ht=Bt.object({autoGainControl:Bt.any().optional(),echoCancellation:Bt.any().optional(),noiseSuppression:Bt.any().optional(),channelCount:Bt.any().optional()}).optional(),Jt=Bt.object({resolution:Bt.tuple([Bt.number(),Bt.number()]).optional(),maxFramerate:Bt.number().optional(),audioVideoOnly:Bt.union([Bt.literal("audio"),Bt.literal("video")]).optional(),audioConstraints:Ht,audioDeviceId:Bt.string().min(1).optional(),videoDeviceId:Bt.string().min(1).optional()}).nullish().transform(e=>!e||qt(e)?Kt.inputCfg.mediaStreamCfg:e),Qt=Bt.object({transcodeAudioBitrateBps:Bt.number().optional(),maxVideoBitrateBps:Bt.number().optional(),maxAudioBitrateBps:Bt.number().optional(),maxEncodingFramerate:Bt.number().optional()}).nullish().transform(e=>!e||qt(e)?Kt.inputCfg.broadcastCfg:e),Xt=Bt.object({audio:Bt.boolean().optional(),video:Bt.boolean().optional()}).optional(),Yt=Bt.object({token:Bt.string()}).nullish().transform(e=>null!=e?e:Kt.auth),ei=Bt.object({mediaStream:Bt.unknown().refine(e=>e instanceof MediaStream,"mediaStream should be instance of MediaStream").nullish().transform(e=>null!=e?e:Kt.inputCfg.mediaStream),mediaStreamCfg:Jt,muted:Xt,broadcastCfg:Qt}).nullish().transform(e=>null!=e?e:Kt.inputCfg),ti=Bt.object({accountId:Bt.string(),accountKey:Bt.string()}).nullish().transform(e=>null!=e?e:Kt.metrics),ii=Bt.preprocess(e=>Gt(e)&&qt(e)?null:e,Bt.object({minDelaySec:Bt.number().min(1).optional().default(Kt.reconnect.minDelaySec),maxDelaySec:Bt.number().min(1).optional().default(Kt.reconnect.maxDelaySec),maxRetries:Bt.number().min(1).optional().default(Kt.reconnect.maxRetries)}).optional().nullable().transform(e=>e||null).refine(e=>null===e||e.minDelaySec<=e.maxDelaySec,"minDelaySec value should be equal or lower than maxDelaySec value").or(Bt.boolean().transform(e=>!0===e?Kt.reconnect:null))),ni=Bt.object({serverUrl:Bt.string().url().optional().default(Kt.serverUrl).transform(e=>Wt(e)),auth:Yt,streamName:Bt.string().min(1).optional().nullable().default(Kt.streamName),ingestUrl:Bt.string().url().optional().default(Kt.ingestUrl),inputCfg:ei,previewVideoElId:Bt.string().min(1).optional().nullable().default(Kt.previewVideoElId),metrics:ti,reconnect:ii}).strict().refine(e=>!!e.auth||!!e.streamName,"Either auth or streamName should be passed");function ri(e,t,i){const r=i.safeParse(t);if(!r.success)throw m.ValidationError(`Issues path at ${e}`,n.ValidationError,r.error.issues);return r.data}class si{static mergeConstraints(e,t){return e&&t?Object.assign(Object.assign({},e),t):e||t}static getIceCandidateType(e){return e.split(" ")[7]}static removePayloadTypeFromMline(e,t){const i=e.split(" ");for(let e=0;e<i.length;++e)i[e]===t&&i.splice(e,1);return i.join(" ")}static findLine(e,t,i){return si.findLineInRange(e,0,-1,t,i)}static findLineInRange(e,t,i,n,r,s=!0){if(s){const s=-1!==i?i:e.length;for(let i=t;i<s;++i)if(0===e[i].indexOf(n)&&(!r||-1!==e[i].toLowerCase().indexOf(r.toLowerCase())))return i}else{for(let i=-1!==t?t:e.length-1;i>=0;--i)if(0===e[i].indexOf(n)&&(!r||-1!==e[i].toLowerCase().indexOf(r.toLowerCase())))return i}return null}}class ai{static removeCodecByName(e,t){const i=si.findLine(e,"a=rtpmap",t);if(null===i)return e;const n=ai.getCodecPayloadTypeFromLine(e[i]);if(e.splice(i,1),!n)throw new Error(`Could not determine payload-type for codec '${t}' in SDP lines:\n${JSON.stringify(e)}`);const r=si.findLine(e,"m=","video");return null===r||(e[r]=si.removePayloadTypeFromMline(e[r],n)),e}static removeCodecByPayloadType(e,t){const i=si.findLine(e,"a=rtpmap",t.toString());if(null===i)return e;e.splice(i,1);const n=si.findLine(e,"m=","video");return null===n||(e[n]=si.removePayloadTypeFromMline(e[n],t)),e}static getCodecPayloadTypeFromLine(e){const t=e.match(ai.patternCodec);return t&&2===t.length?t[1]:null}static preferCodec(e,t){const i=ai.splitLines(e);if(!i.videoCodecNumbers)return e;if("vp8"===t&&i.vp8LineNumber===i.videoCodecNumbers[0])return e;if("vp9"===t&&i.vp9LineNumber===i.videoCodecNumbers[0])return e;if("h264"===t&&i.h264LineNumber===i.videoCodecNumbers[0])return e;return ai.preferVideoCodec(e,t,i)}static preferVideoCodec(e,t,i,n=!1){let r="";if("vp8"===t){if(!i.vp8LineNumber)return e;r=i.vp8LineNumber}if("vp9"===t){if(!i.vp9LineNumber)return e;r=i.vp9LineNumber}if("h264"===t){if(!i.h264LineNumber)return e;r=i.h264LineNumber}let s=i.videoCodecNumbersOriginal.split("SAVPF")[0]+"SAVPF ",a=[r];n&&(a=[]),i.videoCodecNumbers.forEach(function(e){e!==r&&a.push(e)}),s+=a.join(" ");return e.replace(i.videoCodecNumbersOriginal,s)}static splitLines(e){const t=[];let i="",n="",r="",s="";return e.split("\n").forEach(e=>{0===e.indexOf("m=video")&&e.split("SAVPF")[1].split(" ").forEach(function(n){(n=n.trim())&&n.length&&(null==t||t.push(n),i=e)}),-1===e.indexOf("VP8/90000")||n||(n=e.replace("a=rtpmap:","").split(" ")[0]),-1===e.indexOf("VP9/90000")||r||(r=e.replace("a=rtpmap:","").split(" ")[0]),-1===e.indexOf("H264/90000")||s||(s=e.replace("a=rtpmap:","").split(" ")[0])}),{videoCodecNumbers:t,videoCodecNumbersOriginal:i,vp8LineNumber:n,vp9LineNumber:r,h264LineNumber:s}}static removeVPX(e){const t=ai.splitLines(e);let i;return i=ai.preferVideoCodec(e,"vp9",t,!0),i=ai.preferVideoCodec(i,"vp8",t,!0),i}static disableNACK(e){if(!e||"string"!=typeof e)throw"Invalid arguments.";let t;return t=e.replace("a=rtcp-fb:126 nack\r\n",""),t=t.replace("a=rtcp-fb:126 nack pli\r\n","a=rtcp-fb:126 pli\r\n"),t=t.replace("a=rtcp-fb:97 nack\r\n",""),t=t.replace("a=rtcp-fb:97 nack pli\r\n","a=rtcp-fb:97 pli\r\n"),t}static prioritize(e,t){if(t&&t.getSenders&&t.getSenders().length){if(!e||"string"!=typeof e)throw"Invalid arguments.";t.getSenders().forEach(function(t){const i=t.getParameters();for(let t=0;t<i.codecs.length;t++)if(i.codecs[t].mimeType==e){i.codecs.unshift(...i.codecs.splice(t,1));break}t.setParameters(i)})}}static removeNonG722(e){return e.replace(/m=audio ([0-9]+) RTP\/SAVPF ([0-9 ]*)/g,"m=audio $1 RTP/SAVPF 9")}static findLine(e,t,i){return si.findLineInRange(e,0,-1,t,i)}static findLineInRange(e,t,i,n,r){const s=-1!==i?i:e.length;for(let i=t;i<s;++i)if(0===e[i].indexOf(n)&&(!r||-1!==e[i].toLowerCase().indexOf(r.toLowerCase())))return i;return null}static getCodecPayloadType(e){const t=new RegExp("a=rtpmap:(\\d+) \\w+\\/\\d+"),i=e.match(t);return i&&2===i.length?i[1]:null}static setVideoBitrates(e,t){let i=e,n=Object.assign({},t);n=n||{};const r=n.min,s=n.max,a=i.split("\r\n"),o=si.findLine(a,"a=rtpmap","VP8/90000");let c;if(o&&(c=ai.getCodecPayloadType(a[o])),!c)return i;const d=si.findLine(a,"a=rtpmap","rtx/90000");if(!d)return i;const l=ai.getCodecPayloadType(a[d]),u=si.findLine(a,"a=fmtp:"+l);if(null!==u){let e="\r\n";e+="a=fmtp:"+c+" x-google-min-bitrate="+(r||"228")+"; x-google-max-bitrate="+(s||"228"),a[u]=a[u].concat(e),i=a.join("\r\n")}return i}static setOpusAttributes(e,t){let i=e,n=Object.assign({},t);n=n||{};const r=i.split("\r\n"),s=si.findLine(r,"a=rtpmap","opus/48000");let a;if(s&&(a=ai.getCodecPayloadType(r[s])),!a)return i;const o=si.findLine(r,"a=fmtp:"+a.toString());if(null===o)return i;let c="";return c+="; stereo="+(void 0!==n.stereo?n.stereo:"1"),c+="; sprop-stereo="+(void 0!==n["sprop-stereo"]?n["sprop-stereo"]:"1"),void 0!==n.maxaveragebitrate&&(c+="; maxaveragebitrate="+(n.maxaveragebitrate||1048576)),void 0!==n.maxplaybackrate&&(c+="; maxplaybackrate="+(n.maxplaybackrate||1048576)),void 0!==n.cbr&&(c+="; cbr="+(void 0!==n.cbr?n.cbr:"1")),void 0!==n.useinbandfec&&(c+="; useinbandfec="+n.useinbandfec),void 0!==n.usedtx&&(c+="; usedtx="+n.usedtx),void 0!==n.maxptime&&(c+="\r\na=maxptime:"+n.maxptime),r[o]=r[o].concat(c),i=r.join("\r\n"),i}static preferVP9(e){return ai.preferCodec(e,"vp9")}}ai.patternCodec=new RegExp("a=rtpmap:(\\d+) [a-zA-Z0-9-]+\\/\\d+");var oi=function(e,t,i,n){return new(i||(i=Promise))(function(r,s){function a(e){try{c(n.next(e))}catch(e){s(e)}}function o(e){try{c(n.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(a,o)}c((n=n.apply(e,t||[])).next())})};class ci{static isSupported(e){const t=null===navigator||void 0===navigator?void 0:navigator.mediaDevices;return!(!t||!t[e])}static assertSupported(e){ci.isSupported(e)||m.MediaDevicesError("MediaDevices API method not supported: "+e,n.MDevicesMethodNotSupported)}static getSupportedConstraints(){return ci.assertSupported("getSupportedConstraints"),navigator.mediaDevices.getSupportedConstraints()}static getDevicePermissions(e,t){return oi(this,void 0,void 0,function*(){const i=e.filter(e=>"videoinput"===e.kind||"audioinput"===e.kind).map(e=>{let t;switch(e.kind){case"videoinput":t="camera";break;case"audioinput":t="microphone";break;default:throw m.MediaDevicesError("device.kind must be videoinput or audioinput",n.MDevicesKindNotSupported)}return Object.assign({name:t},e)}),r=[];for(const e of i)yield navigator.permissions.query(e).then(t=>{r.push(Object.assign(Object.assign({},e),{status:t.state}))}).catch(e=>{t&&t(m.MediaDevicesError(e.message,n.MDevicesPermissionQueryFailed))});return r})}static getAvailableMediaDevices(){return oi(this,void 0,void 0,function*(){return ci.assertSupported("enumerateDevices"),yield pi.requestMediaPermissions(),navigator.mediaDevices.enumerateDevices()})}static filterDevices(e,t=["audioinput","videoinput"],i,n){return e.filter(e=>(!i||i===e.groupId)&&((!n||n===e.deviceId)&&t.includes(e.kind)))}}var di=function(e,t,i,n){return new(i||(i=Promise))(function(r,s){function a(e){try{c(n.next(e))}catch(e){s(e)}}function o(e){try{c(n.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(a,o)}c((n=n.apply(e,t||[])).next())})};const{assertSupported:li}=ci,{debug:ui}=P("stream-utils");class pi{static createStream(e={audio:!0,video:!0}){return di(this,void 0,void 0,function*(){li("getUserMedia");try{return yield navigator.mediaDevices.getUserMedia(e)}catch(e){const t=e;throw m.MediaStreamError(`Failed to create media stream: ${t.message}`,n.MStreamNotCreated)}})}static disposeStream(e){e.getTracks().forEach(e=>{e.stop()})}static requestMediaPermissions(){return di(this,void 0,void 0,function*(){const e=yield pi.createStream({audio:!0,video:{width:4096,height:2160}});yield pi.disposeStream(e)})}static hasAudio(e){var t;return!!(null===(t=e.getAudioTracks())||void 0===t?void 0:t.length)}static hasVideo(e){var t;return!!(null===(t=e.getVideoTracks())||void 0===t?void 0:t.length)}static getAudioTrackSettings(e){return pi.hasAudio(e)?e.getAudioTracks()[0].getSettings():null}static getVideoTrackSettings(e){return pi.hasVideo(e)?null==e?void 0:e.getVideoTracks()[0].getSettings():null}static getSyntheticMediaStreamConstraints(e){let t=!1,i=!1;return pi.hasAudio(e)&&(t=e.getAudioTracks()[0].getConstraints()),pi.hasVideo(e)&&(i=e.getVideoTracks()[0].getConstraints()),{audio:t,video:i}}static setAudioTracksTo(e,t){e.getAudioTracks().forEach(e=>{e.enabled!==t&&(e.enabled=t,ui((e.enabled?"enabled":"disabled")+" audio track:",e.id))})}static setVideoTracksTo(e,t){e.getVideoTracks().forEach(e=>{e.enabled!==t&&(e.enabled=t,ui((e.enabled?"enabled":"disabled")+" video track:",e.id))})}static audioEnabled(e){return pi.hasAudio(e)?e.getAudioTracks().some(e=>e.enabled):null}static videoEnabled(e){return pi.hasVideo(e)?e.getVideoTracks().some(e=>e.enabled):null}}const{maxBy:hi,meanBy:mi,minBy:fi,orZero:gi,roundToPrecision:vi}=f;const yi={"candidate-pair":{lastPacketSentTimestamp:{renameTo:"lastPacketSentTimestamp"}}},_i={"remote-inbound-rtp":{roundTripTime:{renameTo:"rtt",multiplier:1e3,getMinMaxAvg:!0,aggregate:!0},jitter:{renameTo:"jitter",multiplier:1e3,getMinMaxAvg:!0,aggregate:!0},packetsLost:{renameTo:"packetsLost",getSerialDiff:!0,getMinMaxAvg:!0,aggregate:!0},fractionLost:{renameTo:"fractionLost"}},"outbound-rtp":{codecId:{renameTo:"codecId",aggregate:!1},packetsSent:{renameTo:"packetsSent",getSerialDiff:!0,getMinMaxAvg:!0,aggregate:!0},bytesSent:{renameTo:"bitrate",multiplier:.008,getSerialDiff:!0,getMinMaxAvg:!0,aggregate:!0}}},bi={"remote-inbound-rtp":{roundTripTime:{renameTo:"rtt",multiplier:1e3,getMinMaxAvg:!0,aggregate:!0},jitter:{renameTo:"jitter",multiplier:1e3,getMinMaxAvg:!0,aggregate:!0},packetsLost:{renameTo:"packetsLost",getSerialDiff:!0,getMinMaxAvg:!0,aggregate:!0},fractionLost:{renameTo:"fractionLost"}},"outbound-rtp":{framesEncoded:{renameTo:"framesEncoded",getSerialDiff:!1,getMinMaxAvg:!1,aggregate:!1},codecId:{renameTo:"codecId",aggregate:!1},encoderImplementation:{renameTo:"encoderImplementation",aggregate:!1},qualityLimitationReason:{renameTo:"qualityLimitationReason",aggregate:!1},qualityLimitationDurations:{renameTo:"qualityLimitationDurations"},qualityLimitationResolutionChanges:{renameTo:"qualityLimitationResolutionChanges"},totalPacketSendDelay:{renameTo:"totalPacketSendDelay",getSerialDiff:!0,getMinMaxAvg:!0,aggregate:!0},packetsSent:{renameTo:"packetsSent",getSerialDiff:!0,getMinMaxAvg:!0,aggregate:!0},bytesSent:{renameTo:"bitrate",multiplier:.008,getSerialDiff:!0,getMinMaxAvg:!0,aggregate:!0},nackCount:{renameTo:"nackCount",getSerialDiff:!0,getMinMaxAvg:!0,aggregate:!0},firCount:{renameTo:"firCount"},pliCount:{renameTo:"pliCount"},qpSum:{renameTo:"qpSum"},framesSent:{renameTo:"framesSent",getSerialDiff:!0,aggregate:!0,getMinMaxAvg:!0},retransmittedPacketsSent:{renameTo:"retransmittedPacketsSent"},retransmittedBytesSent:{renameTo:"retransmittedBytesSent"},fecPacketsSent:{renameTo:"fecPacketsSent"},keyFramesEncoded:{renameTo:"keyFramesEncoded"},frameWidth:{renameTo:"width"},frameHeight:{renameTo:"height"},totalEncodeTime:{renameTo:"totalEncodeTime"}}};var Si=function(e,t,i,n){return new(i||(i=Promise))(function(r,s){function a(e){try{c(n.next(e))}catch(e){s(e)}}function o(e){try{c(n.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(a,o)}c((n=n.apply(e,t||[])).next())})};const{isUndefined:Ci,oneBitQuantize:wi,orZero:Ti,roundToPrecision:Ri}=f,xi=performance;class ki{constructor(e){this._config=e,this._videoStatFilters=bi,this._audioStatfilters=_i,this._connectionFilters=yi,this._selectors=[],this._collectIntervalTimer=null,this._collectedAudioStats={},this._collectedVideoStats={},this._collectedCustomStats={},this._firstReportTimestamp=null,this._lastVideoWidth=null,this._lastVideoHeight=null,this._resolutionChangeCount=0}addSelector(e){this._selectors.push(e)}isRunning(){return null!==this._collectIntervalTimer}start(e){if(this.isRunning())throw m.MetricsError("Stats collection task already running",n.MetricsInitStatsCollectFailed);this._collectIntervalTimer=window.setInterval(()=>Si(this,void 0,void 0,function*(){try{yield this._getStats(),this._firstReportTimestamp||(this._firstReportTimestamp=this._getTimestamp())}catch(t){if(!e)throw t;e(t)}}),this._config.collectPeriodMs)}stop(){this.isRunning()&&(window.clearInterval(this._collectIntervalTimer),this._collectIntervalTimer=null,this._collectedAudioStats={},this._collectedVideoStats={},this._firstReportTimestamp=null)}reset(){this.stop(),this._selectors=[]}pullData(){const e={audio:{},video:{},connection:{}};return this._collectValuesFromCollection(this._collectedAudioStats,e.audio),this._collectValuesFromCollection(this._collectedVideoStats,e.video),this._collectValuesFromCollection(this._collectedCustomStats,e.connection),e}_collectValuesFromCollection(e,t){var i,n,r;for(const s in e){const a=e[s];if(!a)continue;let o=null===(n=null===(i=a.values)||void 0===i?void 0:i.at(-1))||void 0===n?void 0:n.value;null!=o||(o=null===(r=a.lastValue)||void 0===r?void 0:r.value);const{min:c,max:d,avg:l}=a;t[s]={value:o,min:c,max:d,avg:l}}}_getStats(){var e,t;return Si(this,void 0,void 0,function*(){let i;for(const r of this._selectors)if(i=yield r.getStats(),"audio"===(null===(e=r.track)||void 0===e?void 0:e.kind))this._filterReport(i,this._audioStatfilters,this._collectedAudioStats),this._computeCustomAudioStats(i);else{if("video"!==(null===(t=r.track)||void 0===t?void 0:t.kind))throw m.MetricsError('Cannot collect stats, sender.track.kind is neither "audio" nor "video"',n.MetricsInvalidTrackKind);this._filterReport(i,this._videoStatFilters,this._collectedVideoStats),this._computeCustomVideoStats(i)}this._computeCustomStats()})}_filterReport(e,t,i){let n,r,s;e.forEach(e=>{if(n=e.type,s=this._getTimestamp(),t[n])for(const a in t[n]){const o=t[n][a];r={value:e[a],timestamp:s},Ci(r.value)||this._aggregate(r,o,i)}})}_aggregate(e,t,i){var n,r;const s=null!==(n=i[r=t.renameTo])&&void 0!==n?n:i[r]={values:[]};if(t.getSerialDiff?this._getSerialDiff(s,e):s.lastValue=Object.assign({},e),t.multiplier&&(e.value=Ri(e.value*t.multiplier,2)),t.aggregate&&(s.values.push(e),this._trimValuesToTimeFrame(s.values),t.getMinMaxAvg)){const e=function(e,t){var i,n;function r(e){return e.value}let s=gi(null===(i=fi(e,r))||void 0===i?void 0:i.value),a=gi(null===(n=hi(e,r))||void 0===n?void 0:n.value),o=gi(mi(e,r));return s=vi(s,t),a=vi(a,t),o=vi(o,t),{min:s,max:a,avg:o}}(s.values,2);s.min=e.min,s.max=e.max,s.avg=e.avg}}_getTimestamp(){return xi.now()}_getSerialDiff(e,t){if(!e.lastValue)return void(e.lastValue=Object.assign({},t));const i=e.lastValue.value,n=t.value;e.lastValue=Object.assign({},t),t.value=n-i}_getFractionOrZero(e,t){return 0===t||0===e||Ci(e)||Ci(t)?0:e/t}_findInnerReportValue(e,t,i){const n=e.get(t);return n?n[i]:null}_computeCustomAudioStats(e){var t,i,n,r,s,a,o,c;const d=this._getTimestamp(),l=null===(i=null===(t=this._collectedAudioStats.codecId)||void 0===t?void 0:t.lastValue)||void 0===i?void 0:i.value,u=this._findInnerReportValue(e,l,"mimeType");u?this._collectedAudioStats.codec={values:[],lastValue:{timestamp:d,value:u}}:delete this._collectedAudioStats.codec;const p=null===(s=null===(r=null===(n=this._collectedAudioStats.packetsSent)||void 0===n?void 0:n.values)||void 0===r?void 0:r.at(-1))||void 0===s?void 0:s.value,h=null===(c=null===(o=null===(a=this._collectedAudioStats.packetsLost)||void 0===a?void 0:a.values)||void 0===o?void 0:o.at(-1))||void 0===c?void 0:c.value,m={value:100*this._getFractionOrZero(h,p),timestamp:d};this._aggregate(m,{renameTo:"packetsLostPct",aggregate:!0,getMinMaxAvg:!0,getSerialDiff:!1},this._collectedAudioStats)}_computeCustomVideoStats(e){var t,i,n,r,s,a,o,c,d,l,u;const p=this._getTimestamp(),h=null===(i=null===(t=this._collectedVideoStats.codecId)||void 0===t?void 0:t.lastValue)||void 0===i?void 0:i.value,m=this._findInnerReportValue(e,h,"mimeType");m?this._collectedVideoStats.codec={values:[],lastValue:{timestamp:p,value:m}}:delete this._collectedAudioStats.codec;const f=null===(s=null===(r=null===(n=this._collectedVideoStats.packetsSent)||void 0===n?void 0:n.values)||void 0===r?void 0:r.at(-1))||void 0===s?void 0:s.value,g=null===(c=null===(o=null===(a=this._collectedVideoStats.packetsLost)||void 0===a?void 0:a.values)||void 0===o?void 0:o.at(-1))||void 0===c?void 0:c.value,v={value:100*this._getFractionOrZero(g,f),timestamp:p};this._aggregate(v,{renameTo:"packetsLostPct",aggregate:!0,getMinMaxAvg:!0,getSerialDiff:!1},this._collectedVideoStats);const y=(null===(u=null===(l=null===(d=this._collectedVideoStats.totalPacketSendDelay)||void 0===d?void 0:d.values)||void 0===l?void 0:l.at(-1))||void 0===u?void 0:u.value)/f*1e3;this._aggregate({timestamp:p,value:y},{renameTo:"sendDelay",aggregate:!0,getMinMaxAvg:!0,getSerialDiff:!1},this._collectedVideoStats)}_computeCustomStats(){var e,t,i,n,r,s,a,o,c,d,l,u,p,h,m,f,g,v;const y=this._getTimestamp(),_=this._collectedAudioStats.rtt,b=this._collectedVideoStats.rtt,S=Ti(null===(e=null==_?void 0:_.lastValue)||void 0===e?void 0:e.value),C=Ti(null===(t=null==b?void 0:b.lastValue)||void 0===t?void 0:t.value),w=(S+C)/(wi(S)+wi(C));this._aggregate({timestamp:y,value:w},{renameTo:"rtt",multiplier:1e3,aggregate:!0,getMinMaxAvg:!0,getSerialDiff:!1},this._collectedCustomStats);const T=null===(n=null===(i=this._collectedVideoStats.framesEncoded)||void 0===i?void 0:i.lastValue)||void 0===n?void 0:n.value,R=null===(s=null===(r=this._collectedVideoStats.totalEncodeTime)||void 0===r?void 0:r.lastValue)||void 0===s?void 0:s.value;if(T&&R&&this._firstReportTimestamp){const e=100*R/((y-this._firstReportTimestamp)/1e3),t=100-e;this._aggregate({timestamp:y,value:e},{renameTo:"encodeTimePercentage",aggregate:!0,getMinMaxAvg:!0},this._collectedVideoStats),this._aggregate({timestamp:y,value:t},{renameTo:"idleTimePercentage",aggregate:!0,getMinMaxAvg:!0},this._collectedVideoStats),this._aggregate({timestamp:y,value:R},{renameTo:"encodeTime",aggregate:!0,getMinMaxAvg:!0,getSerialDiff:!0},this._collectedVideoStats),this._aggregate({timestamp:y,value:T},{renameTo:"framerate",getSerialDiff:!0,getMinMaxAvg:!0,aggregate:!0},this._collectedVideoStats)}const x=null===(o=null===(a=this._collectedVideoStats.pliCount)||void 0===a?void 0:a.lastValue)||void 0===o?void 0:o.value;x&&this._aggregate({timestamp:y,value:x},{renameTo:"pliFrequency",getSerialDiff:!0,aggregate:!0,getMinMaxAvg:!0},this._collectedVideoStats);const k=Ti(null===(d=null===(c=this._collectedAudioStats.packetsLostPct)||void 0===c?void 0:c.lastValue)||void 0===d?void 0:d.value),E=Ti(null===(u=null===(l=this._collectedVideoStats.packetsLostPct)||void 0===l?void 0:l.lastValue)||void 0===u?void 0:u.value);let O=0;O=k&&E?(k+E)/2:k+E,this._aggregate({timestamp:y,value:O},{renameTo:"packetLoss",getSerialDiff:!1,aggregate:!0,getMinMaxAvg:!0},this._collectedCustomStats);const P=null===(h=null===(p=this._collectedVideoStats.width)||void 0===p?void 0:p.lastValue)||void 0===h?void 0:h.value,M=null===(f=null===(m=this._collectedVideoStats.height)||void 0===m?void 0:m.lastValue)||void 0===f?void 0:f.value;null!==(g=this._lastVideoWidth)&&void 0!==g||(this._lastVideoWidth=P),null!==(v=this._lastVideoHeight)&&void 0!==v||(this._lastVideoHeight=M);(this._lastVideoWidth!=P||this._lastVideoHeight!=M)&&(this._lastVideoHeight=M,this._lastVideoWidth=P,this._resolutionChangeCount++),this._aggregate({timestamp:y,value:this._resolutionChangeCount},{renameTo:"resolutionChangeCount"},this._collectedVideoStats)}_trimValuesToTimeFrame(e){if(!e.length)return;let t=e[e.length-1],i=e[0],n=t.timestamp-i.timestamp;for(;n>this._config.timeFrameMs;)e.shift(),i=e[0],t=e[e.length-1],n=t.timestamp-i.timestamp}}var Ei=function(e,t,i,n){return new(i||(i=Promise))(function(r,s){function a(e){try{c(n.next(e))}catch(e){s(e)}}function o(e){try{c(n.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(a,o)}c((n=n.apply(e,t||[])).next())})};const{isEmpty:Oi}=f,{debug:Pi,log:Mi,info:ji,error:Ni}=P("upstream-connection");class Di{constructor(e){this._inputCfg=e,this._mediaStreamCfg=null,this._broadcastCfg=null,this._mediaStream=null,this._activeStreamConstraints=null,this._peerConnection=null,this._answerSdp=null,this._statsCollector=null,this._statsCollectIntervalTimer=null,this._mediaStreamCfg=this._inputCfg.mediaStreamCfg,this._broadcastCfg=this._inputCfg.broadcastCfg,this._isMuted=this._handleIsMutedInitConfig(this._inputCfg.muted,this._inputCfg.mediaStream),ji("created UpstreamConnection with config:",this._mediaStreamCfg,"_broadcastCfg:",this._broadcastCfg,"_isMuted:",this._isMuted)}get isMuted(){return this._mediaStream?{audio:!pi.audioEnabled(this._mediaStream),video:!pi.videoEnabled(this._mediaStream)}:this._isMuted}get connectionState(){var e;return(null===(e=this._peerConnection)||void 0===e?void 0:e.connectionState)||null}get iceState(){var e;return(null===(e=this._peerConnection)||void 0===e?void 0:e.iceConnectionState)||null}get gatheringState(){var e;return(null===(e=this._peerConnection)||void 0===e?void 0:e.iceGatheringState)||null}get localDescription(){var e;return(null===(e=this._peerConnection)||void 0===e?void 0:e.localDescription)||null}get remoteDescription(){var e;return(null===(e=this._peerConnection)||void 0===e?void 0:e.remoteDescription)||null}onPeerConnectionEvent(e){}onConnectionStateChange(e){}onMediaStreamEvent(e){}getMediaStream(){return this._mediaStream}hasRemoteDescription(){var e;return!!(null===(e=this._peerConnection)||void 0===e?void 0:e.remoteDescription)}getActiveConstraints(){return this._activeStreamConstraints}getAppliedSettings(){if(!this._mediaStream)throw m.MediaStreamError("Cannot obtain media stream settings as upstreamConnection is not setup",n.MStreamNotFound);return{audio:pi.getAudioTrackSettings(this._mediaStream),video:pi.getVideoTrackSettings(this._mediaStream)}}getAudioVideoOnly(){if(!this._mediaStream)throw m.MediaStreamError("Cannot obtain info if the media stream is audioVideoOnly as one does not exist",n.MStreamNotFound);const e=this._mediaStream.getAudioTracks().length,t=this._mediaStream.getVideoTracks().length;return e&&t?null:e?"audio":"video"}createMediaStream(){return Ei(this,void 0,void 0,function*(){if(ji("Configuring input MediaStream"),this._mediaStream)throw m.MediaStreamError("Media stream already exists",n.MStreamAlreadyExists);let e=this._inputCfg.mediaStream,t=null;e?t=pi.getSyntheticMediaStreamConstraints(e):(ji("Creating new MediaStream internally (no user-provided set in config)"),yield pi.requestMediaPermissions(),[e,t]=yield this._createMediaStream(this._mediaStreamCfg)),this._mediaStream=e,this._activeStreamConstraints=t;const i=e=>{this.onMediaStreamEvent(e)};this._mediaStream.onaddtrack=i,this._mediaStream.onremovetrack=i,this._mediaStream.getTracks().forEach(e=>{e.onended=i,e.onmute=i,e.onunmute=i}),ji("Applying initial muted setting to media-stream:",this._isMuted),this.setMuted(this._isMuted)})}createOffer(e={}){return Ei(this,void 0,void 0,function*(){if(this._peerConnection)throw m.BroadcastError("Cannot create an offer as peerconnection already exists",n.BroadcastPCAlreadyExists);if(!this._mediaStream)throw m.MediaStreamError("Cannot create an offer as upstreamConnection is not setup",n.MStreamNotFound);const t=this._peerConnection=new RTCPeerConnection(e),i=e=>{this.onPeerConnectionEvent(e)};t.onconnectionstatechange=e=>{this.onConnectionStateChange(t.connectionState),i(e)},t.oniceconnectionstatechange=i,t.onicecandidate=i,t.onicecandidateerror=i,t.onicegatheringstatechange=i,t.onnegotiationneeded=i,t.onsignalingstatechange=i,t.ontrack=i;const r=this._statsCollector=new ki({collectPeriodMs:1e3,timeFrameMs:1e4});let s,a;this._mediaStream.getTracks().forEach(e=>{let i;Pi("peerconnection: added transceiver for track:",e.id,e.kind);try{i=t.addTransceiver(e,{direction:"sendonly"})}catch(e){const t=e;throw m.BroadcastError(`Failed to add transceiver to pc: ${t.message}`,n.BroadcastPCAddTransceiverFailed)}r.addSelector(i.sender)});try{s=yield t.createOffer()}catch(e){const t=e;throw m.BroadcastError(`Failed to create offer: ${t.message}`,n.BroadcastCreateOfferFailed)}if(!s.sdp)throw m.BroadcastError("Connection offer has empty SDP",n.BroadcastCreateOfferFailed);try{a=new RTCSessionDescription({type:s.type,sdp:ai.preferCodec(s.sdp,"h264")})}catch(e){const t=e;throw m.BroadcastError(`Failed to create new modified SDP: ${t.message}`,n.BroadcastCreateOfferFailed)}try{yield t.setLocalDescription(a)}catch(e){const t=e;throw m.BroadcastError(`Failed to set local description: ${t.message}`,n.BroadcastCreateOfferFailed)}return a})}_handleIsMutedInitConfig(e,t){const i=zt(),n=i.inputCfg.muted.audio,r=i.inputCfg.muted.video;let s=t?!pi.audioEnabled(t):n,a=t?!pi.videoEnabled(t):r;return s=void 0!==(null==e?void 0:e.audio)?e.audio:s,a=void 0!==(null==e?void 0:e.video)?e.video:a,{audio:s,video:a}}onRtcStats(e){}_isStatsCollectorRunning(){return null!==this._statsCollectIntervalTimer}_startStatsCollector(){var e;if(this._isStatsCollectorRunning())throw m.MetricsError("Stats collection task is already running",n.MetricsInitStatsCollectFailed);null===(e=this._statsCollector)||void 0===e||e.start(),this._statsCollectIntervalTimer=window.setInterval(()=>{if(this._statsCollector){const e=this._statsCollector.pullData();this.onRtcStats(e)}},1e3)}_stopStatsCollector(){var e;if(!this._isStatsCollectorRunning())throw m.MetricsError("Stats collection task not running",n.MetricsStopStatsCollectFailed);null===(e=this._statsCollector)||void 0===e||e.reset(),this._statsCollector=null,window.clearInterval(this._statsCollectIntervalTimer),this._statsCollectIntervalTimer=null}setAnswer(e){return Ei(this,void 0,void 0,function*(){if(ji("setAnswer()"),!this._peerConnection)throw m.BroadcastError("Cannot set answer as peerconnection does not exist",n.BroadcastPCNotFound);if(this._answerSdp)throw m.BroadcastError("Cannot set answer as one already exists",n.BroadcastSetAnswerFailed);let t;try{t=this._answerSdp=new RTCSessionDescription({type:"answer",sdp:e})}catch(e){const t=e;throw m.BroadcastError(`Failed to create answer from SDP: ${t.message}`,n.BroadcastSetAnswerFailed)}Pi("calling peer-conn setRemoteDescription:",t);try{yield this._peerConnection.setRemoteDescription(t)}catch(e){const t=e;throw m.BroadcastError(`Failed to set remote description: ${t.message}`,n.BroadcastSetAnswerFailed)}ji("remote SDP (answer) set successfully");const i=yield this._applySendersConstraints();ji("sender constraints applied, result:",i),this._startStatsCollector()})}setMuted(e){if(!this._mediaStream)return;Mi("setMuted:",e);const t=zt();this._isMuted=e=Object.assign({},t.inputCfg.muted,e);const{audio:i,video:n}=this._isMuted;pi.setAudioTracksTo(this._mediaStream,!i),pi.setVideoTracksTo(this._mediaStream,!n)}resetConnection(){var e;if(ji("resetConnection()"),!this._peerConnection)throw m.BroadcastError("Cannot reset the connection as it does not exist",n.BroadcastPCNotFound);(null===(e=this._statsCollector)||void 0===e?void 0:e.isRunning())&&this._stopStatsCollector(),this._answerSdp=null,this._peerConnection.close(),this._peerConnection=null}dispose(e=!1){ji("dispose() - withMediaStream=",e),this._peerConnection&&this.resetConnection(),e&&this._mediaStream&&(Mi("Disposing MediaStream"),pi.disposeStream(this._mediaStream)),this._mediaStream=null}_createMediaStream(e){return Ei(this,void 0,void 0,function*(){if(!e){const e={audio:!0,video:!0};ji("MediaStream creation without MediaStreamCfg, using default constraints:",e);const t=yield pi.createStream(e);return Mi("MediaStream created successfully"),[t,e]}const{maxFramerate:t,resolution:i,audioVideoOnly:n,audioConstraints:r}=e;let s={};if(i){const[e,t]=i;s={width:e,height:t}}const a=null==e?void 0:e.audioDeviceId,o=null==e?void 0:e.videoDeviceId,c={audio:{deviceId:a},video:Object.assign({deviceId:o,frameRate:t},s)};"video"!==n&&r&&(c.audio=Object.assign(c.audio||{},Object.assign({},r))),"video"===n?c.audio=!1:"audio"===n&&(c.video=!1),ji("MediaStream create attempt: config resulting constraints:",c);const d=yield pi.createStream(c);return Mi("MediaStream created successfully"),[d,c]})}_applySendersConstraints(){return Ei(this,void 0,void 0,function*(){const e=this._broadcastCfg,t=this.getAudioVideoOnly();ji("_applySendersConstraints() - audioVideoOnly:",t);const i={maxBitrate:null==e?void 0:e.maxAudioBitrateBps},r={maxFramerate:null==e?void 0:e.maxEncodingFramerate,maxBitrate:null==e?void 0:e.maxVideoBitrateBps},s=[Promise.resolve(null),Promise.resolve(null)];Oi(i)||"video"===t||(Mi("setting audio encoding params:",i),s[0]=this._setSenderEncodingParams("audio",i)),Oi(r)||"audio"===t||(Mi("setting video encoding params:",r),s[1]=this._setSenderEncodingParams("video",r));try{return yield Promise.all(s)}catch(e){const t=e;throw Ni("_applySendersConstraints:",t),m.BroadcastError(`Fatal error setting encoder params: ${t.message}`,n.BroadcastApplyConstraintsFailed)}})}_setSenderEncodingParams(e,t){var i;return Ei(this,void 0,void 0,function*(){if(!this._peerConnection)throw new Error("Cannot set an encoding option as peerconnection does not exist");const n=this._peerConnection.getSenders().filter(t=>{var i;return(null===(i=t.track)||void 0===i?void 0:i.kind)===e});if(!n.length)throw new Error(`Cannot set any encoding params as there are no senders of kind '${e}'`);const r=n[0],s=r.getParameters();(null===(i=s.encodings)||void 0===i?void 0:i.length)||(s.encodings=[{}]),s.encodings[0]=Object.assign({},s.encodings[0],t),Pi("calling RTCRtpSender.setParameters():",s);try{yield r.setParameters(s)}catch(t){return Ni("RTCRtpSender.setParameters error:",t),new Error(`For sender of kind ${e} setParameters(${JSON.stringify(s)}) failed with error: ${t.message}`)}return Mi("Successfully set encoding params for track kind:",e),null})}}var Ai=function(e,t,i,n){return new(i||(i=Promise))(function(r,s){function a(e){try{c(n.next(e))}catch(e){s(e)}}function o(e){try{c(n.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(a,o)}c((n=n.apply(e,t||[])).next())})};function Ii(e,t,i,r={}){return Ai(this,void 0,void 0,function*(){const s=Object.assign({"Content-Type":"text/plain"},r),a={method:t,mode:"cors",cache:"no-cache",credentials:"same-origin",headers:s,body:i};let o;try{o=yield fetch(e,a)}catch(e){const t=e;throw m.ClientRequestError(t.message,n.ClientRequestFailed,{request:a})}const c=function(e){const t={};return e.forEach((e,i)=>{t[i]=e}),t}(o.headers);let d;try{d=yield o.text()}catch(e){const t=e;throw m.ServerError("Failed to read response: "+t.message,n.ServerMalformedResponse)}if(!o.ok){if(o.status>=500&&o.status<=599)throw m.ServerError("Server error: "+o.status,n.ServerRequestFailed,{responseText:d});throw m.ClientRequestError(`Response is not ok: ${o.status}`,n.ClientRequestFailed,{responseText:d})}return{data:d,headers:c}})}var Li=function(e,t,i,n){return new(i||(i=Promise))(function(r,s){function a(e){try{c(n.next(e))}catch(e){s(e)}}function o(e){try{c(n.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(a,o)}c((n=n.apply(e,t||[])).next())})};const{removeLastPathPart:Fi}=f;function Vi(e){let t="";return t+=e.streamName?`stream_name=${e.streamName}`:"",t+=e.ingestUrl?`&stream_url=${e.ingestUrl}`:"",t+=e.audioRateBps?`&audio_bitrate=${e.audioRateBps}`:"",t+=e.connectInfo?`&connect_info=${e.connectInfo}`:"",t}class Zi{static createResource(e,t,i){return Li(this,void 0,void 0,function*(){const r={};!function(e,t){e.token&&(t.Authorization=`Bearer ${e.token}`)}(i,r);const s=`${e}?${Vi(i)}`,a=yield Ii(s,"POST",t,r),o=a.headers.location;if(!o)throw m.ServerError("Response header contains no Location field",n.ServerMalformedResponse);const c=o.split("/").pop();if(!c)throw m.ServerError(`Location field of response header seems malformed (expecting URL/path): ${o}`,n.ServerMalformedResponse);const d=a.data;if(!d)throw m.ServerError("Response body is empty, but expecting SDP data",n.ServerMalformedResponse);return{resourceId:c,location:o,answerSdp:d,resolvedServerUrl:Fi(o)}})}static deleteResource(e,t){return Li(this,void 0,void 0,function*(){return(yield Ii(`${e}/${t}`,"DELETE")).data})}static sendMetadata(e,t,i){return Li(this,void 0,void 0,function*(){return(yield Ii(`${e}/${t}/metadata`,"POST",JSON.stringify(i),{"Content-Type":"application/json"})).data})}static addSink(e,t,i){return Li(this,void 0,void 0,function*(){const n=`${e}/${t}/sink?${Vi(i)}`;return yield Ii(n,"POST")})}static getSinks(e,t){return Li(this,void 0,void 0,function*(){const i=yield Ii(`${e}/${t}/sink`,"GET");return JSON.parse(i.data)})}static deleteSink(e,t,i){return Li(this,void 0,void 0,function*(){return yield Ii(`${e}/${t}/sink/${i}`,"DELETE")})}static getServerStatusInfo(e){return Li(this,void 0,void 0,function*(){const t=yield Ii(`${e}/status.json`,"GET");return JSON.parse(t.data)})}}var Bi=function(e,t,i,n){return new(i||(i=Promise))(function(r,s){function a(e){try{c(n.next(e))}catch(e){s(e)}}function o(e){try{c(n.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(a,o)}c((n=n.apply(e,t||[])).next())})};class Ui{get _authToken(){var e;return(null===(e=this._config.auth)||void 0===e?void 0:e.token)||""}constructor(e){this._config=e,this._resource=null,this._requestPending=!1,this._baseUrl=e.serverUrl}createResource(e,t){return Bi(this,void 0,void 0,function*(){if(this._resource)throw m.ClientRequestError("Cannot create a resource as one already exists",n.ClientResourceAlreadyExists);const{streamName:i,ingestUrl:r}=this._config,s={streamName:null!=i?i:"",ingestUrl:r,token:this._authToken};if(t&&Object.assign(s,t),yield this._assertNoRequestPendingCall(()=>Bi(this,void 0,void 0,function*(){this._resource=yield Zi.createResource(this._baseUrl,e.sdp,s)})),!this._resource)throw m.ServerError("createResource did not set internal member",n.ServerCreateResourceFailed);return this._resource})}getResource(){return this._resource}deleteResource(){return Bi(this,void 0,void 0,function*(){yield this._assertNoRequestPendingCall(()=>Bi(this,void 0,void 0,function*(){if(!this._resource)throw m.ClientRequestError("Cannot delete resource which does not exist",n.ClientResourceNotFound);const{resolvedServerUrl:e,resourceId:t}=this._resource;this._resource=null,yield Zi.deleteResource(e,t)}))})}sendMetadata(e,t){return Bi(this,void 0,void 0,function*(){if(!this._resource)throw m.ClientRequestError("Cannot send metadata as resource does not exist.",n.ClientResourceNotFound);const i={handlerName:e,payload:t},{resolvedServerUrl:r,resourceId:s}=this._resource;return yield Zi.sendMetadata(r,s,i)})}dispose(){return Bi(this,void 0,void 0,function*(){this._resource&&(yield this.deleteResource())})}_assertNoRequestPendingCall(e){return Bi(this,void 0,void 0,function*(){if(this._requestPending)throw m.ClientRequestError("A client request is already pending",n.ClientRequestPending);let t;this._requestPending=!0;try{t=yield e()}catch(e){throw this._requestPending=!1,e}return this._requestPending=!1,t})}}var $i=i(462);const zi=Object.freeze({RECEIVED_WEB_RTC_STATS:"RECEIVED_WEB_RTC_STATS",BROADCAST_STARTED:"BROADCAST_STARTED",BROADCAST_STOPPED:"BROADCAST_STOPPED",SETUP_ERROR:"SETUP_ERROR",PREVIEW_ERROR:"PREVIEW_ERROR",START_BROADCAST_ERROR:"START_BROADCAST_ERROR",STOP_BROADCAST_ERROR:"STOP_BROADCAST_ERROR",GET_MEDIA_STREAM_SETTINGS_ERROR:"GET_MEDIA_STREAM_SETTINGS_ERROR",SET_MUTED_ERROR:"SET_MUTED_ERROR",DISPOSE_ERROR:"DISPOSE_ERROR",SEND_METADATA_ERROR:"SEND_METADATA_ERROR"});var qi=function(e,t,i,n){return new(i||(i=Promise))(function(r,s){function a(e){try{c(n.next(e))}catch(e){s(e)}}function o(e){try{c(n.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(a,o)}c((n=n.apply(e,t||[])).next())})};const{filterObjectByMask:Gi,msToSecs:Wi,roundToPrecision:Ki}=f,{log:Hi,error:Ji}=P("MetricsFunnel");const Qi=performance;class Xi{constructor(e,t,i){this._metricsAccount=e,this._metricsConfig=t,this._webcasterId=i,this._sendPeriodMs=1e4,this._emitIntervalTimer=null,this._sendIntervalTimer=null,this._broadcastStartTime=null,this._metricsResultDataDefaults={clientVersion:"",webcasterId:NaN,broadcastStatus:{peerConnectionState:"",iceConnectionState:"",iceGatheringState:"",startUpTime:NaN,totalTime:NaN,reconnects:NaN},stream:{name:"",url:""},server:{url:"",host:"",resourceId:""},userAgent:null,rtcstats:{video:{bitrate:{value:NaN,min:NaN,max:NaN,avg:NaN},codec:{value:""},framerate:{value:NaN,min:NaN,max:NaN,avg:NaN},height:{value:NaN,min:NaN,max:NaN,avg:NaN},width:{value:NaN,min:NaN,max:NaN,avg:NaN},jitter:{value:NaN,min:NaN,max:NaN,avg:NaN},rtt:{value:NaN,min:NaN,max:NaN,avg:NaN},sendDelay:{value:NaN,min:NaN,max:NaN,avg:NaN}},audio:{bitrate:{value:NaN,min:NaN,max:NaN,avg:NaN},codec:{value:""},jitter:{value:NaN,min:NaN,max:NaN,avg:NaN},rtt:{value:NaN,min:NaN,max:NaN,avg:NaN}},connection:{rtt:{value:NaN,min:NaN,max:NaN,avg:NaN},packetLoss:{value:NaN,min:NaN,max:NaN,avg:NaN}}}},this._metricsEndpoint=this._metricsConfig.sendUrl+this._metricsAccount.application_account_id,this._metrics={},this._setDefaults(),this._emit(this._metrics)}put(e,t){this._metrics[e]=t}putPartial(e,t){const i=this._metrics[e];this._metrics[e]=Object.assign({},i,t)}onMetrics(e){}start(){this._emitIntervalTimer=window.setInterval(()=>{this._updateBroadcastTime(),this._emit(this._metrics)},this._metricsConfig.emitPeriodMs),this._sendIntervalTimer=window.setInterval(()=>{this._updateBroadcastTime(),this._send(this._metrics)},this._sendPeriodMs)}stop(){window.clearInterval(this._emitIntervalTimer),window.clearInterval(this._sendIntervalTimer)}setStartTime(){this._broadcastStartTime=this._getTimestamp()}putBroadcastStartupTime(){const e=this._getTimestamp(),t=Wi(e-(this._broadcastStartTime||e));this.putPartial("broadcastStatus",{startUpTime:Ki(t,2)})}putError(e,t){return qi(this,void 0,void 0,function*(){const i=Object.assign({},this._metrics,{message:e,errorMessage:t.message,errorCode:t.code});this._send(i),this._emit(i)})}sendSignal(e){return qi(this,void 0,void 0,function*(){const t=Object.assign({},this._metrics,{message:e});this._send(t)})}putMediaStreamInfo(e){return qi(this,void 0,void 0,function*(){if(!e)return;const t={},i=pi.audioEnabled(e),n=pi.videoEnabled(e);null!==i&&(t.audioTrack={muted:!i}),null!==n&&(t.videoTrack={muted:!n}),this.put("mediaStream",t)})}_getTimestamp(){return Qi.now()}_updateBroadcastTime(){const e=this._getTimestamp(),t=Wi(e-(this._broadcastStartTime||e));this.putPartial("broadcastStatus",{totalTime:Ki(t,2)})}_setDefaults(){var e,t,i,r,s,a,o,c,d,l,u,p,h,f;let g;try{g=(new $i.UAParser).getResult()}catch(e){const t=e;throw m.MetricsError(`Failed to parse user agent info: ${t.message}`,n.MetricsParseUserAgentFailed)}const v={document:{origin:null===(e=null===document||void 0===document?void 0:document.location)||void 0===e?void 0:e.origin,pathName:null===(t=null===document||void 0===document?void 0:document.location)||void 0===t?void 0:t.pathname,referrer:null===(i=null===document||void 0===document?void 0:document.location)||void 0===i?void 0:i.href,search:null===(r=null===document||void 0===document?void 0:document.location)||void 0===r?void 0:r.search},browser:{name:null===(s=null==g?void 0:g.browser)||void 0===s?void 0:s.name,version:null===(a=null==g?void 0:g.browser)||void 0===a?void 0:a.version,engine:null===(o=null==g?void 0:g.engine)||void 0===o?void 0:o.name,engineVersion:null===(c=null==g?void 0:g.engine)||void 0===c?void 0:c.version},os:{name:null===(d=null==g?void 0:g.os)||void 0===d?void 0:d.name,version:null===(l=null==g?void 0:g.os)||void 0===l?void 0:l.version},cpu:{architecture:null===(u=null==g?void 0:g.cpu)||void 0===u?void 0:u.architecture},device:{model:null===(p=null==g?void 0:g.device)||void 0===p?void 0:p.model,type:null===(h=null==g?void 0:g.device)||void 0===h?void 0:h.type,vendor:null===(f=null==g?void 0:g.device)||void 0===f?void 0:f.vendor}};this._metrics=Object.assign(Object.assign({webcasterId:this._webcasterId},this._metricsAccount),{clientVersion:"6.2.2",message:zi.RECEIVED_WEB_RTC_STATS,userAgent:v})}_filterMetricsByDefaults(e){return Gi(e,this._metricsResultDataDefaults,!0)}_emit(e){const t=this._filterMetricsByDefaults(e);this.onMetrics(t)}_send(e){return qi(this,void 0,void 0,function*(){let t;try{t=JSON.stringify(e)}catch(e){return void Ji("Error stringifying metrics:",e)}try{yield Ii(this._metricsEndpoint,"POST",t)}catch(e){Ji("Error sending metrics request:",e)}})}}var Yi=function(e,t,i,n){return new(i||(i=Promise))(function(r,s){function a(e){try{c(n.next(e))}catch(e){s(e)}}function o(e){try{c(n.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(a,o)}c((n=n.apply(e,t||[])).next())})};const{cloneSerializable:en,isEmpty:tn,isUndefined:nn}=f,{log:rn,info:sn,warn:an,error:on,debug:cn}=P("webcaster");var dn;!function(e){e.Idle="idle",e.Reconnecting="reconnecting",e.Failed="failed"}(dn||(dn={}));class ln{constructor(e){this._previewVidElList=[],this._reconnectionState=null,this._reconnects=0,this._webcasterId=f.getRandInt(1,1e9),sn("Parsing config");try{this._config=function(e){return ri("Config",e,ni)}(e)}catch(e){throw this._handleError("Failed to parse incoming config",e)}sn("Creating new client instance from config:",this._config);const[t,i,n,r,s]=this._init();this._upstreamConnection=t,this._whipClient=i,this._metricsFunnel=n,this._visibilityChangeHandler=r,this._beforeUnloadHandler=s}onReconnectionStateChange(e){}onConnectionStateChange(e){}onStateChange(){}onError(e){}onMetrics(e){}setup(){return Yi(this,void 0,void 0,function*(){sn("Setting up the webcaster instance");try{yield this._upstreamConnection.createMediaStream()}catch(e){throw this._handleError("Failure on setup",e,zi.SETUP_ERROR)}return this._emitOnStateChange(),this._emitOnReconnectionStateChange(dn.Idle),en(this._config)})}startPreview(e){this._assertHaveMediaStream(),sn("Starting preview on video-element with id:",e);const t=e||this._config.previewVideoElId;if(!t)throw this._handleError("Preview video-element id needs to be set in config if not passed as argument",null,zi.PREVIEW_ERROR);const i=document.getElementById(t);if(!i)throw this._handleError(`HTML document does not contain element id: ${t}`,null,zi.PREVIEW_ERROR);this._addPreviewVideoEl(i)}startBroadcast(){var e,t,i,n,r,s;return Yi(this,void 0,void 0,function*(){this._assertHaveMediaStream(),sn("Starting broadcast"),this._metricsFunnel.start(),this._metricsFunnel.setStartTime(),this._handleVisibilityChange();const a=null===(i=null===(t=null===(e=this._config)||void 0===e?void 0:e.inputCfg)||void 0===t?void 0:t.broadcastCfg)||void 0===i?void 0:i.transcodeAudioBitrateBps;try{rn("Creating RTC offer SDP");const e=yield this._upstreamConnection.createOffer();rn("Calling createResource with offer and sink-params");const t={audioRateBps:a},i=yield this._whipClient.createResource(e,t),o=null===(r=null===(n=i.location.split("//"))||void 0===n?void 0:n[1].split("."))||void 0===r?void 0:r[0];this._metricsFunnel.put("server",{url:this._config.serverUrl,host:o,resourceId:i.resourceId}),this._metricsFunnel.put("stream",{name:null!==(s=this._config.streamName)&&void 0!==s?s:"",url:this._config.ingestUrl}),rn("Setting received answer SDP"),yield this._upstreamConnection.setAnswer(i.answerSdp),this._metricsFunnel.putBroadcastStartupTime(),this._metricsFunnel.sendSignal(zi.BROADCAST_STARTED)}catch(e){throw this._metricsFunnel.stop(),this._handleError("Failed starting broadcast",e,zi.START_BROADCAST_ERROR)}this._emitOnStateChange()})}stopBroadcast(){return Yi(this,void 0,void 0,function*(){sn("Stopping the broadcast"),this._assertHaveMediaStream();try{yield this._whipClient.deleteResource()}catch(e){on("Deleting resource only on the client-side",e)}try{this._upstreamConnection.resetConnection(),yield this._metricsFunnel.sendSignal(zi.BROADCAST_STOPPED),this._metricsFunnel.stop()}catch(e){throw this._handleError("Failed stopping broadcast",e,zi.STOP_BROADCAST_ERROR)}this._emitOnStateChange()})}getConfiguredConstraints(){return this._upstreamConnection.getActiveConstraints()}getMediaStreamSettings(){this._assertHaveMediaStream();try{return this._upstreamConnection.getAppliedSettings()}catch(e){throw this._handleError("Failed to obtain media stream settings",e,zi.GET_MEDIA_STREAM_SETTINGS_ERROR)}}getUpstreamStatus(){const{connectionState:e,iceState:t,gatheringState:i,localDescription:n,remoteDescription:r}=this._upstreamConnection;return{connectionState:e,iceState:t,gatheringState:i,localDescription:en(n),remoteDescription:en(r)}}setMuted(e){try{const t=ri("MutedConfig",e,Xt);sn("Setting muted config to: ",t),this._upstreamConnection.setMuted(t)}catch(e){throw this._handleError("Failed to set muted config",e,zi.SET_MUTED_ERROR)}}isMuted(){return this._upstreamConnection.isMuted}dispose(e=!1){return Yi(this,void 0,void 0,function*(){sn("Disposing the Webcaster instance"),this._assertHaveMediaStream(),this._removeWindowEventHandlers(),this._upstreamConnection.hasRemoteDescription()&&(yield this.stopBroadcast());try{yield this._whipClient.dispose(),this._upstreamConnection.dispose(e),this._previewVidElList.forEach(e=>{e.srcObject=null}),this._previewVidElList.length=0,this._reconnectionState=null,this._reconnects=0}catch(e){throw this._handleError("Failed to dispose",e,zi.DISPOSE_ERROR)}})}_startReconnecting(){return Yi(this,void 0,void 0,function*(){if(this._reconnectionState===dn.Reconnecting)return rn("Webcaster is already reconnecting."),!1;sn("Started reconnecting.");const{maxDelaySec:e,minDelaySec:t,maxRetries:i}=this._config.reconnect,n=1e3*e,r=1e3*t;let s=0,a=r;const o=Math.max(i,2),c=f.exponentialBaseOnRange(r,n,o);for(this._emitOnReconnectionStateChange(dn.Reconnecting);s<i;){if(s++,rn(`Attempting to reconnect...Try #${s} with delay: ${a} ms`),yield this._reconnect(a))return rn("Reconnected successfully!"),this._emitOnReconnectionStateChange(dn.Idle),this._metricsFunnel.putPartial("broadcastStatus",{reconnects:++this._reconnects}),!0;a=a<n?Math.min(a*c,n):n}return rn("Max retries reached. Stopping attempts to reconnect."),this._emitOnReconnectionStateChange(dn.Failed),!1})}_reconnect(e){return Yi(this,void 0,void 0,function*(){try{return rn("Cleaning up before reconnect"),yield this.stopBroadcast(),yield f.wait(e),yield this.startBroadcast(),!0}catch(e){return on("Reconnect attempt failed",e),!1}})}recover(e=!1){var t;return Yi(this,void 0,void 0,function*(){if(sn("recover called, disposeMediaStream=",e),(null===(t=this._config.inputCfg)||void 0===t?void 0:t.mediaStream)&&e)throw m.GeneralError("Can not recover a user-provided stream, please call this method without `disposeMediaStream` flag",n.GeneralRecoveryFailed);const i=!!this._upstreamConnection.getMediaStream(),r=this._upstreamConnection.hasRemoteDescription(),s=this._previewVidElList.slice();rn("saved prior state before dispose call - wasSetup:",i,"wasCasting:",r,"previewVidEls:",s);try{if(i&&(yield this.dispose(e)),this._init(),i){rn("attempt recovering setup state");const e=yield this.setup();rn("recovered setup with config:",e),s.forEach(e=>{try{this._addPreviewVideoEl(e)}catch(e){an("recovering startPreview failed with error:",e)}}),r&&(rn("attempt recovering broacast state"),yield this.startBroadcast())}}catch(e){throw on("Recovery failing error:",e),e}})}sendMetadata(e,t){return Yi(this,void 0,void 0,function*(){sn("Sending metadata"),this._assertHaveMediaStream(),this._assertHaveRemoteDescription();try{if(nn(t))throw new Error("Metadata object should be defined");if(tn(t))throw new Error("Metadata object should not be empty");yield this._whipClient.sendMetadata(e,t)}catch(e){throw this._handleError("Failed to send metadata",e,zi.SEND_METADATA_ERROR)}})}_init(){return rn("internal init called"),this._metricsFunnel=new Xi({application_name:"webrtc-client",application_account_id:this._config.metrics.accountId,application_account_key:this._config.metrics.accountKey,application_event_id:""},{emitPeriodMs:1e3,sendUrl:"https://glog1.nanocosmos.de/gelf/"},this._webcasterId),this._metricsFunnel.onMetrics=e=>{this._emitOnMetrics(e)},this._upstreamConnection=new Di(this._config.inputCfg),this._upstreamConnection.onPeerConnectionEvent=()=>{const{connectionState:e,iceState:t,gatheringState:i}=this.getUpstreamStatus();this._metricsFunnel.putPartial("broadcastStatus",{peerConnectionState:null!=e?e:"",iceConnectionState:null!=t?t:"",iceGatheringState:null!=i?i:""}),"failed"!==t&&"failed"!==e||this._handleConnectionFailed(),this._emitOnStateChange()},this._upstreamConnection.onMediaStreamEvent=()=>{this._emitOnStateChange()},this._upstreamConnection.onRtcStats=e=>{this._metricsFunnel.putMediaStreamInfo(this._upstreamConnection.getMediaStream()),this._metricsFunnel.put("rtcstats",e)},this._upstreamConnection.onConnectionStateChange=e=>{this._emitOnConnectionStateChange(e)},this._whipClient=new Ui(this._config),this._removeWindowEventHandlers(),this._beforeUnloadHandler=this._handleOnBeforeUnload.bind(this),window.addEventListener("beforeunload",this._beforeUnloadHandler),this._visibilityChangeHandler=this._handleVisibilityChange.bind(this),window.addEventListener("visibilitychange",this._visibilityChangeHandler),rn("internal init succeeded"),[this._upstreamConnection,this._whipClient,this._metricsFunnel,this._visibilityChangeHandler,this._beforeUnloadHandler]}_removeWindowEventHandlers(){window.removeEventListener("visibilitychange",this._visibilityChangeHandler),window.removeEventListener("beforeunload",this._beforeUnloadHandler)}_handleConnectionFailed(){return Yi(this,void 0,void 0,function*(){if(this._config.reconnect){if(yield this._startReconnecting())return}this._metricsFunnel.stop()})}_handleOnBeforeUnload(){try{this.stopBroadcast()}catch(e){on(e)}}_handleVisibilityChange(){rn("Document visiblity is: "+document.hidden),this._metricsFunnel.put("visibility",document.hidden?"hidden":"visible")}_addPreviewVideoEl(e){const t=this._assertHaveMediaStream();if("VIDEO"!==e.tagName)throw this._handleError("Provided element is not a video tag",null,zi.PREVIEW_ERROR);if(e.srcObject||e.src)throw this._handleError("Preview video-element already has a source set (this may have been called twice with same arguments)",null,zi.PREVIEW_ERROR);this._previewVidElList.push(e),e.srcObject=t,rn("Added preview video-element with id:",e.id)}_emitOnStateChange(){this.onStateChange&&this.onStateChange()}_emitOnError(e){this.onError&&this.onError(e)}_emitOnMetrics(e){this.onMetrics&&this.onMetrics(en(e))}_emitOnConnectionStateChange(e){this.onConnectionStateChange&&this.onConnectionStateChange(e)}_emitOnReconnectionStateChange(e){this._reconnectionState=e,this.onReconnectionStateChange&&this.onReconnectionStateChange(e)}_handleError(e,t,i){let r;return on("_handleError:",e,t),t&&t instanceof s?(t.message=`${e}: ${t.message}`,r=t):r=t&&t instanceof Error?m.GeneralError(`${e}: ${t.message}`,n.General):m.GeneralError(e,n.General),i&&this._metricsFunnel.putError(i,r),this._emitOnError(r),r}_assertHaveMediaStream(){const e=this._upstreamConnection.getMediaStream();if(!e)throw m.GeneralError("Webcaster is not set up (no MediaStream exists yet)",n.GeneralSetupNotCalled);return e}_assertHaveRemoteDescription(){if(!this._upstreamConnection.hasRemoteDescription())throw m.GeneralError("Webcaster has not started broadcast (no remote description exists yet)",n.GeneralBroadcastNotStarted)}}i(132);O({level:b.TRACE,enableDebug:!1},!0);const un="6.2.2",pn="45a69d335a6b542ad07b9f87378d77d93ec9f21c";return r})());