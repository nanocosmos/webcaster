/*! nanoStream Webcaster
Copyright (c) 2023, nanocosmos gmbh
https://www.nanocosmos.de/support

LEGAL NOTICE:
This material is subject to the terms and conditions defined in
separate license conditions found at https://www.nanocosmos.de/terms or in a separate agreement.
All information contained herein is, and remains the property of nanocosmos GmbH and its suppliers if any.
The intellectual and technical concepts contained herein are proprietary to nanocosmos GmbH,
and are protected by trade secret or copyright law. Dissemination of this information or reproduction
of this material is strictly forbidden unless prior written permission is obtained from nanocosmos.
 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.WebcasterApiV6=t():e.WebcasterApiV6=t()}(this,(()=>(()=>{"use strict";var e={286:e=>{const t={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};t.localCName=t.generateIdentifier(),t.splitLines=function(e){return e.trim().split("\n").map((e=>e.trim()))},t.splitSections=function(e){return e.split("\nm=").map(((e,t)=>(t>0?"m="+e:e).trim()+"\r\n"))},t.getDescription=function(e){const n=t.splitSections(e);return n&&n[0]},t.getMediaSections=function(e){const n=t.splitSections(e);return n.shift(),n},t.matchPrefix=function(e,n){return t.splitLines(e).filter((e=>0===e.indexOf(n)))},t.parseCandidate=function(e){let t;t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" ");const n={foundation:t[0],component:{1:"rtp",2:"rtcp"}[t[1]]||t[1],protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]};for(let e=8;e<t.length;e+=2)switch(t[e]){case"raddr":n.relatedAddress=t[e+1];break;case"rport":n.relatedPort=parseInt(t[e+1],10);break;case"tcptype":n.tcpType=t[e+1];break;case"ufrag":n.ufrag=t[e+1],n.usernameFragment=t[e+1];break;default:void 0===n[t[e]]&&(n[t[e]]=t[e+1])}return n},t.writeCandidate=function(e){const t=[];t.push(e.foundation);const n=e.component;"rtp"===n?t.push(1):"rtcp"===n?t.push(2):t.push(n),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);const i=e.type;return t.push("typ"),t.push(i),"host"!==i&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},t.parseIceOptions=function(e){return e.substr(14).split(" ")},t.parseRtpMap=function(e){let t=e.substr(9).split(" ");const n={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),n.name=t[0],n.clockRate=parseInt(t[1],10),n.channels=3===t.length?parseInt(t[2],10):1,n.numChannels=n.channels,n},t.writeRtpMap=function(e){let t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);const n=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==n?"/"+n:"")+"\r\n"},t.parseExtmap=function(e){const t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1]}},t.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},t.parseFmtp=function(e){const t={};let n;const i=e.substr(e.indexOf(" ")+1).split(";");for(let e=0;e<i.length;e++)n=i[e].trim().split("="),t[n[0].trim()]=n[1];return t},t.writeFmtp=function(e){let t="",n=e.payloadType;if(void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){const i=[];Object.keys(e.parameters).forEach((t=>{void 0!==e.parameters[t]?i.push(t+"="+e.parameters[t]):i.push(t)})),t+="a=fmtp:"+n+" "+i.join(";")+"\r\n"}return t},t.parseRtcpFb=function(e){const t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},t.writeRtcpFb=function(e){let t="",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach((e=>{t+="a=rtcp-fb:"+n+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"})),t},t.parseSsrcMedia=function(e){const t=e.indexOf(" "),n={ssrc:parseInt(e.substr(7,t-7),10)},i=e.indexOf(":",t);return i>-1?(n.attribute=e.substr(t+1,i-t-1),n.value=e.substr(i+1)):n.attribute=e.substr(t+1),n},t.parseSsrcGroup=function(e){const t=e.substr(13).split(" ");return{semantics:t.shift(),ssrcs:t.map((e=>parseInt(e,10)))}},t.getMid=function(e){const n=t.matchPrefix(e,"a=mid:")[0];if(n)return n.substr(6)},t.parseFingerprint=function(e){const t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1].toUpperCase()}},t.getDtlsParameters=function(e,n){return{role:"auto",fingerprints:t.matchPrefix(e+n,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(e,t){let n="a=setup:"+t+"\r\n";return e.fingerprints.forEach((e=>{n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"})),n},t.parseCryptoLine=function(e){const t=e.substr(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},t.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"==typeof e.keyParams?t.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},t.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;const t=e.substr(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},t.getCryptoParameters=function(e,n){return t.matchPrefix(e+n,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(e,n){const i=t.matchPrefix(e+n,"a=ice-ufrag:")[0],r=t.matchPrefix(e+n,"a=ice-pwd:")[0];return i&&r?{usernameFragment:i.substr(12),password:r.substr(10)}:null},t.writeIceParameters=function(e){let t="a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n";return e.iceLite&&(t+="a=ice-lite\r\n"),t},t.parseRtpParameters=function(e){const n={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},i=t.splitLines(e)[0].split(" ");for(let r=3;r<i.length;r++){const s=i[r],a=t.matchPrefix(e,"a=rtpmap:"+s+" ")[0];if(a){const i=t.parseRtpMap(a),r=t.matchPrefix(e,"a=fmtp:"+s+" ");switch(i.parameters=r.length?t.parseFmtp(r[0]):{},i.rtcpFeedback=t.matchPrefix(e,"a=rtcp-fb:"+s+" ").map(t.parseRtcpFb),n.codecs.push(i),i.name.toUpperCase()){case"RED":case"ULPFEC":n.fecMechanisms.push(i.name.toUpperCase())}}}return t.matchPrefix(e,"a=extmap:").forEach((e=>{n.headerExtensions.push(t.parseExtmap(e))})),n},t.writeRtpDescription=function(e,n){let i="";i+="m="+e+" ",i+=n.codecs.length>0?"9":"0",i+=" UDP/TLS/RTP/SAVPF ",i+=n.codecs.map((e=>void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType)).join(" ")+"\r\n",i+="c=IN IP4 0.0.0.0\r\n",i+="a=rtcp:9 IN IP4 0.0.0.0\r\n",n.codecs.forEach((e=>{i+=t.writeRtpMap(e),i+=t.writeFmtp(e),i+=t.writeRtcpFb(e)}));let r=0;return n.codecs.forEach((e=>{e.maxptime>r&&(r=e.maxptime)})),r>0&&(i+="a=maxptime:"+r+"\r\n"),n.headerExtensions&&n.headerExtensions.forEach((e=>{i+=t.writeExtmap(e)})),i},t.parseRtpEncodingParameters=function(e){const n=[],i=t.parseRtpParameters(e),r=-1!==i.fecMechanisms.indexOf("RED"),s=-1!==i.fecMechanisms.indexOf("ULPFEC"),a=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"cname"===e.attribute)),o=a.length>0&&a[0].ssrc;let c;const d=t.matchPrefix(e,"a=ssrc-group:FID").map((e=>e.substr(17).split(" ").map((e=>parseInt(e,10)))));d.length>0&&d[0].length>1&&d[0][0]===o&&(c=d[0][1]),i.codecs.forEach((e=>{if("RTX"===e.name.toUpperCase()&&e.parameters.apt){let t={ssrc:o,codecPayloadType:parseInt(e.parameters.apt,10)};o&&c&&(t.rtx={ssrc:c}),n.push(t),r&&(t=JSON.parse(JSON.stringify(t)),t.fec={ssrc:o,mechanism:s?"red+ulpfec":"red"},n.push(t))}})),0===n.length&&o&&n.push({ssrc:o});let l=t.matchPrefix(e,"b=");return l.length&&(l=0===l[0].indexOf("b=TIAS:")?parseInt(l[0].substr(7),10):0===l[0].indexOf("b=AS:")?1e3*parseInt(l[0].substr(5),10)*.95-16e3:void 0,n.forEach((e=>{e.maxBitrate=l}))),n},t.parseRtcpParameters=function(e){const n={},i=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"cname"===e.attribute))[0];i&&(n.cname=i.value,n.ssrc=i.ssrc);const r=t.matchPrefix(e,"a=rtcp-rsize");n.reducedSize=r.length>0,n.compound=0===r.length;const s=t.matchPrefix(e,"a=rtcp-mux");return n.mux=s.length>0,n},t.writeRtcpParameters=function(e){let t="";return e.reducedSize&&(t+="a=rtcp-rsize\r\n"),e.mux&&(t+="a=rtcp-mux\r\n"),void 0!==e.ssrc&&e.cname&&(t+="a=ssrc:"+e.ssrc+" cname:"+e.cname+"\r\n"),t},t.parseMsid=function(e){let n;const i=t.matchPrefix(e,"a=msid:");if(1===i.length)return n=i[0].substr(7).split(" "),{stream:n[0],track:n[1]};const r=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"msid"===e.attribute));return r.length>0?(n=r[0].value.split(" "),{stream:n[0],track:n[1]}):void 0},t.parseSctpDescription=function(e){const n=t.parseMLine(e),i=t.matchPrefix(e,"a=max-message-size:");let r;i.length>0&&(r=parseInt(i[0].substr(19),10)),isNaN(r)&&(r=65536);const s=t.matchPrefix(e,"a=sctp-port:");if(s.length>0)return{port:parseInt(s[0].substr(12),10),protocol:n.fmt,maxMessageSize:r};const a=t.matchPrefix(e,"a=sctpmap:");if(a.length>0){const e=a[0].substr(10).split(" ");return{port:parseInt(e[0],10),protocol:e[1],maxMessageSize:r}}},t.writeSctpDescription=function(e,t){let n=[];return n="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&n.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),n.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,21)},t.writeSessionBoilerplate=function(e,n,i){let r;const s=void 0!==n?n:2;r=e||t.generateSessionId();return"v=0\r\no="+(i||"thisisadapterortc")+" "+r+" "+s+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},t.getDirection=function(e,n){const i=t.splitLines(e);for(let e=0;e<i.length;e++)switch(i[e]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return i[e].substr(2)}return n?t.getDirection(n):"sendrecv"},t.getKind=function(e){return t.splitLines(e)[0].split(" ")[0].substr(2)},t.isRejected=function(e){return"0"===e.split(" ",2)[1]},t.parseMLine=function(e){const n=t.splitLines(e)[0].substr(2).split(" ");return{kind:n[0],port:parseInt(n[1],10),protocol:n[2],fmt:n.slice(3).join(" ")}},t.parseOLine=function(e){const n=t.matchPrefix(e,"o=")[0].substr(2).split(" ");return{username:n[0],sessionId:n[1],sessionVersion:parseInt(n[2],10),netType:n[3],addressType:n[4],address:n[5]}},t.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;const n=t.splitLines(e);for(let e=0;e<n.length;e++)if(n[e].length<2||"="!==n[e].charAt(1))return!1;return!0},e.exports=t},428:function(e,t,n){var i;!function(r,s){var a="function",o="undefined",c="object",d="string",l="major",u="model",p="name",h="type",m="vendor",f="version",g="architecture",v="console",y="mobile",_="tablet",b="smarttv",S="wearable",C="embedded",w="Amazon",T="Apple",x="ASUS",k="BlackBerry",R="Firefox",O="Google",P="Huawei",E="LG",j="Microsoft",N="Motorola",M="Opera",D="Samsung",I="Sharp",A="Sony",L="Xiaomi",V="Zebra",Z="Facebook",F="Chromium OS",U="Mac OS",B=function(e){for(var t={},n=0;n<e.length;n++)t[e[n].toUpperCase()]=e[n];return t},$=function(e,t){return typeof e===d&&-1!==z(t).indexOf(z(e))},z=function(e){return e.toLowerCase()},q=function(e,t){if(typeof e===d)return e=e.replace(/^\s\s*/,""),typeof t===o?e:e.substring(0,350)},G=function(e,t){for(var n,i,r,o,d,l,u=0;u<t.length&&!d;){var p=t[u],h=t[u+1];for(n=i=0;n<p.length&&!d&&p[n];)if(d=p[n++].exec(e))for(r=0;r<h.length;r++)l=d[++i],typeof(o=h[r])===c&&o.length>0?2===o.length?typeof o[1]==a?this[o[0]]=o[1].call(this,l):this[o[0]]=o[1]:3===o.length?typeof o[1]!==a||o[1].exec&&o[1].test?this[o[0]]=l?l.replace(o[1],o[2]):s:this[o[0]]=l?o[1].call(this,l,o[2]):s:4===o.length&&(this[o[0]]=l?o[3].call(this,l.replace(o[1],o[2])):s):this[o]=l||s;u+=2}},W=function(e,t){for(var n in t)if(typeof t[n]===c&&t[n].length>0){for(var i=0;i<t[n].length;i++)if($(t[n][i],e))return"?"===n?s:n}else if($(t[n],e))return"?"===n?s:n;return e},K={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},J={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[f,[p,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[f,[p,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[p,f],[/opios[\/ ]+([\w\.]+)/i],[f,[p,"Opera Mini"]],[/\bopr\/([\w\.]+)/i],[f,[p,M]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(heytap|ovi)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[p,f],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[f,[p,"UCBrowser"]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[f,[p,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[f,[p,"WeChat"]],[/konqueror\/([\w\.]+)/i],[f,[p,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[f,[p,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[f,[p,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[p,/(.+)/,"$1 Secure Browser"],f],[/\bfocus\/([\w\.]+)/i],[f,[p,"Firefox Focus"]],[/\bopt\/([\w\.]+)/i],[f,[p,"Opera Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[f,[p,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[f,[p,"Dolphin"]],[/coast\/([\w\.]+)/i],[f,[p,"Opera Coast"]],[/miuibrowser\/([\w\.]+)/i],[f,[p,"MIUI Browser"]],[/fxios\/([-\w\.]+)/i],[f,[p,R]],[/\bqihu|(qi?ho?o?|360)browser/i],[[p,"360 Browser"]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[p,/(.+)/,"$1 Browser"],f],[/(comodo_dragon)\/([\w\.]+)/i],[[p,/_/g," "],f],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[p,f],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[p],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[p,Z],f],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[p,f],[/\bgsa\/([\w\.]+) .*safari\//i],[f,[p,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[f,[p,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[f,[p,"Chrome Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[p,"Chrome WebView"],f],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[f,[p,"Android Browser"]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[p,f],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[f,[p,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[f,p],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[p,[f,W,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[p,f],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[p,"Netscape"],f],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[f,[p,"Firefox Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[p,f],[/(cobalt)\/([\w\.]+)/i],[p,[f,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[g,"amd64"]],[/(ia32(?=;))/i],[[g,z]],[/((?:i[346]|x)86)[;\)]/i],[[g,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[g,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[g,"armhf"]],[/windows (ce|mobile); ppc;/i],[[g,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[g,/ower/,"",z]],[/(sun4\w)[;\)]/i],[[g,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[g,z]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[u,[m,D],[h,_]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[u,[m,D],[h,y]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[u,[m,T],[h,y]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[u,[m,T],[h,_]],[/(macintosh);/i],[u,[m,T]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[u,[m,I],[h,y]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[u,[m,P],[h,_]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[u,[m,P],[h,y]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[u,/_/g," "],[m,L],[h,y]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[u,/_/g," "],[m,L],[h,_]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[u,[m,"OPPO"],[h,y]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[u,[m,"Vivo"],[h,y]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[u,[m,"Realme"],[h,y]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[u,[m,N],[h,y]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[u,[m,N],[h,_]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[u,[m,E],[h,_]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[u,[m,E],[h,y]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[u,[m,"Lenovo"],[h,_]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[u,/_/g," "],[m,"Nokia"],[h,y]],[/(pixel c)\b/i],[u,[m,O],[h,_]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[u,[m,O],[h,y]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[u,[m,A],[h,y]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[u,"Xperia Tablet"],[m,A],[h,_]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[u,[m,"OnePlus"],[h,y]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo[c-r]{2})( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[u,[m,w],[h,_]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[u,/(.+)/g,"Fire Phone $1"],[m,w],[h,y]],[/(playbook);[-\w\),; ]+(rim)/i],[u,m,[h,_]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[u,[m,k],[h,y]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[u,[m,x],[h,_]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[u,[m,x],[h,y]],[/(nexus 9)/i],[u,[m,"HTC"],[h,_]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[m,[u,/_/g," "],[h,y]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[u,[m,"Acer"],[h,_]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[u,[m,"Meizu"],[h,y]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron|infinix|tecno)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[m,u,[h,y]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[m,u,[h,_]],[/(surface duo)/i],[u,[m,j],[h,_]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[u,[m,"Fairphone"],[h,y]],[/(u304aa)/i],[u,[m,"AT&T"],[h,y]],[/\bsie-(\w*)/i],[u,[m,"Siemens"],[h,y]],[/\b(rct\w+) b/i],[u,[m,"RCA"],[h,_]],[/\b(venue[\d ]{2,7}) b/i],[u,[m,"Dell"],[h,_]],[/\b(q(?:mv|ta)\w+) b/i],[u,[m,"Verizon"],[h,_]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[u,[m,"Barnes & Noble"],[h,_]],[/\b(tm\d{3}\w+) b/i],[u,[m,"NuVision"],[h,_]],[/\b(k88) b/i],[u,[m,"ZTE"],[h,_]],[/\b(nx\d{3}j) b/i],[u,[m,"ZTE"],[h,y]],[/\b(gen\d{3}) b.+49h/i],[u,[m,"Swiss"],[h,y]],[/\b(zur\d{3}) b/i],[u,[m,"Swiss"],[h,_]],[/\b((zeki)?tb.*\b) b/i],[u,[m,"Zeki"],[h,_]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[m,"Dragon Touch"],u,[h,_]],[/\b(ns-?\w{0,9}) b/i],[u,[m,"Insignia"],[h,_]],[/\b((nxa|next)-?\w{0,9}) b/i],[u,[m,"NextBook"],[h,_]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[m,"Voice"],u,[h,y]],[/\b(lvtel\-)?(v1[12]) b/i],[[m,"LvTel"],u,[h,y]],[/\b(ph-1) /i],[u,[m,"Essential"],[h,y]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[u,[m,"Envizen"],[h,_]],[/\b(trio[-\w\. ]+) b/i],[u,[m,"MachSpeed"],[h,_]],[/\btu_(1491) b/i],[u,[m,"Rotor"],[h,_]],[/(shield[\w ]+) b/i],[u,[m,"Nvidia"],[h,_]],[/(sprint) (\w+)/i],[m,u,[h,y]],[/(kin\.[onetw]{3})/i],[[u,/\./g," "],[m,j],[h,y]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[u,[m,V],[h,_]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[u,[m,V],[h,y]],[/smart-tv.+(samsung)/i],[m,[h,b]],[/hbbtv.+maple;(\d+)/i],[[u,/^/,"SmartTV"],[m,D],[h,b]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[m,E],[h,b]],[/(apple) ?tv/i],[m,[u,"Apple TV"],[h,b]],[/crkey/i],[[u,"Chromecast"],[m,O],[h,b]],[/droid.+aft(\w+)( bui|\))/i],[u,[m,w],[h,b]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[u,[m,I],[h,b]],[/(bravia[\w ]+)( bui|\))/i],[u,[m,A],[h,b]],[/(mitv-\w{5}) bui/i],[u,[m,L],[h,b]],[/Hbbtv.*(technisat) (.*);/i],[m,u,[h,b]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[m,q],[u,q],[h,b]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[h,b]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[m,u,[h,v]],[/droid.+; (shield) bui/i],[u,[m,"Nvidia"],[h,v]],[/(playstation [345portablevi]+)/i],[u,[m,A],[h,v]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[u,[m,j],[h,v]],[/((pebble))app/i],[m,u,[h,S]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[u,[m,T],[h,S]],[/droid.+; (glass) \d/i],[u,[m,O],[h,S]],[/droid.+; (wt63?0{2,3})\)/i],[u,[m,V],[h,S]],[/(quest( 2| pro)?)/i],[u,[m,Z],[h,S]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[m,[h,C]],[/(aeobc)\b/i],[u,[m,w],[h,C]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[u,[h,y]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[u,[h,_]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[h,_]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[h,y]],[/(android[-\w\. ]{0,9});.+buil/i],[u,[m,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[f,[p,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[f,[p,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[p,f],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[f,p]],os:[[/microsoft (windows) (vista|xp)/i],[p,f],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[p,[f,W,K]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[p,"Windows"],[f,W,K]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[f,/_/g,"."],[p,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[p,U],[f,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[f,p],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[p,f],[/\(bb(10);/i],[f,[p,k]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[f,[p,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[f,[p,"Firefox OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[f,[p,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[f,[p,"watchOS"]],[/crkey\/([\d\.]+)/i],[f,[p,"Chromecast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[p,F],f],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[p,f],[/(sunos) ?([\w\.\d]*)/i],[[p,"Solaris"],f],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[p,f]]},H=function(e,t){if(typeof e===c&&(t=e,e=s),!(this instanceof H))return new H(e,t).getResult();var n=typeof r!==o&&r.navigator?r.navigator:s,i=e||(n&&n.userAgent?n.userAgent:""),l=n&&n.userAgentData?n.userAgentData:s,u=t?function(e,t){var n={};for(var i in e)t[i]&&t[i].length%2==0?n[i]=t[i].concat(e[i]):n[i]=e[i];return n}(J,t):J,p=n&&n.userAgent==i;return this.getBrowser=function(){var e,t={};return t.name=s,t.version=s,G.call(t,i,u.browser),t.major=typeof(e=t.version)===d?e.replace(/[^\d\.]/g,"").split(".")[0]:s,p&&n&&n.brave&&typeof n.brave.isBrave==a&&(t.name="Brave"),t},this.getCPU=function(){var e={};return e.architecture=s,G.call(e,i,u.cpu),e},this.getDevice=function(){var e={};return e.vendor=s,e.model=s,e.type=s,G.call(e,i,u.device),p&&!e.type&&l&&l.mobile&&(e.type=y),p&&"Macintosh"==e.model&&n&&typeof n.standalone!==o&&n.maxTouchPoints&&n.maxTouchPoints>2&&(e.model="iPad",e.type=_),e},this.getEngine=function(){var e={};return e.name=s,e.version=s,G.call(e,i,u.engine),e},this.getOS=function(){var e={};return e.name=s,e.version=s,G.call(e,i,u.os),p&&!e.name&&l&&"Unknown"!=l.platform&&(e.name=l.platform.replace(/chrome os/i,F).replace(/macos/i,U)),e},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return i},this.setUA=function(e){return i=typeof e===d&&e.length>350?q(e,350):e,this},this.setUA(i),this};H.VERSION="0.7.36",H.BROWSER=B([p,f,l]),H.CPU=B([g]),H.DEVICE=B([u,m,h,v,y,b,_,S,C]),H.ENGINE=H.OS=B([p,f]),typeof t!==o?(e.exports&&(t=e.exports=H),t.UAParser=H):n.amdO?(i=function(){return H}.call(t,n,t,e))===s||(e.exports=i):typeof r!==o&&(r.UAParser=H);var X=typeof r!==o&&(r.jQuery||r.Zepto);if(X&&!X.ua){var Y=new H;X.ua=Y.getResult(),X.ua.get=function(){return Y.getUA()},X.ua.set=function(e){Y.setUA(e);var t=Y.getResult();for(var n in t)X.ua[n]=t[n]}}}("object"==typeof window?window:this)},404:(e,t,n)=>{n.r(t),n.d(t,{default:()=>ce});var i={};n.r(i),n.d(i,{fixNegotiationNeeded:()=>E,shimAddTrackRemoveTrack:()=>O,shimAddTrackRemoveTrackWithNative:()=>R,shimGetDisplayMedia:()=>S,shimGetSendersWithDtmf:()=>T,shimGetStats:()=>x,shimGetUserMedia:()=>b,shimMediaStream:()=>C,shimOnTrack:()=>w,shimPeerConnection:()=>P,shimSenderReceiverGetStats:()=>k});var r={};n.r(r),n.d(r,{shimAddTransceiver:()=>Z,shimCreateAnswer:()=>B,shimCreateOffer:()=>U,shimGetDisplayMedia:()=>N,shimGetParameters:()=>F,shimGetUserMedia:()=>j,shimOnTrack:()=>M,shimPeerConnection:()=>D,shimRTCDataChannel:()=>V,shimReceiverGetStats:()=>A,shimRemoveStream:()=>L,shimSenderGetStats:()=>I});var s={};n.r(s),n.d(s,{shimAudioContext:()=>X,shimCallbacksAPI:()=>q,shimConstraints:()=>W,shimCreateOfferLegacy:()=>H,shimGetUserMedia:()=>G,shimLocalStreamsAPI:()=>$,shimRTCIceServerUrls:()=>K,shimRemoteStreamsAPI:()=>z,shimTrackEventTransceiver:()=>J});var a={};n.r(a),n.d(a,{removeExtmapAllowMixed:()=>re,shimAddIceCandidateNullOrEmpty:()=>se,shimConnectionState:()=>ie,shimMaxMessageSize:()=>te,shimParameterlessSetLocalDescription:()=>ae,shimRTCIceCandidate:()=>ee,shimSendThrowTypeError:()=>ne});let o=!0,c=!0;function d(e,t,n){const i=e.match(t);return i&&i.length>=n&&parseInt(i[n],10)}function l(e,t,n){if(!e.RTCPeerConnection)return;const i=e.RTCPeerConnection.prototype,r=i.addEventListener;i.addEventListener=function(e,i){if(e!==t)return r.apply(this,arguments);const s=e=>{const t=n(e);t&&(i.handleEvent?i.handleEvent(t):i(t))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(i,s),r.apply(this,[e,s])};const s=i.removeEventListener;i.removeEventListener=function(e,n){if(e!==t||!this._eventMap||!this._eventMap[t])return s.apply(this,arguments);if(!this._eventMap[t].has(n))return s.apply(this,arguments);const i=this._eventMap[t].get(n);return this._eventMap[t].delete(n),0===this._eventMap[t].size&&delete this._eventMap[t],0===Object.keys(this._eventMap).length&&delete this._eventMap,s.apply(this,[e,i])},Object.defineProperty(i,"on"+t,{get(){return this["_on"+t]},set(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}function u(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(o=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function p(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(c=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function h(){if("object"==typeof window){if(o)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}}function m(e,t){c&&console.warn(e+" is deprecated, please use "+t+" instead.")}function f(e){return"[object Object]"===Object.prototype.toString.call(e)}function g(e){return f(e)?Object.keys(e).reduce((function(t,n){const i=f(e[n]),r=i?g(e[n]):e[n],s=i&&!Object.keys(r).length;return void 0===r||s?t:Object.assign(t,{[n]:r})}),{}):e}function v(e,t,n){t&&!n.has(t.id)&&(n.set(t.id,t),Object.keys(t).forEach((i=>{i.endsWith("Id")?v(e,e.get(t[i]),n):i.endsWith("Ids")&&t[i].forEach((t=>{v(e,e.get(t),n)}))})))}function y(e,t,n){const i=n?"outbound-rtp":"inbound-rtp",r=new Map;if(null===t)return r;const s=[];return e.forEach((e=>{"track"===e.type&&e.trackIdentifier===t.id&&s.push(e)})),s.forEach((t=>{e.forEach((n=>{n.type===i&&n.trackId===t.id&&v(e,n,r)}))})),r}const _=h;function b(e,t){const n=e&&e.navigator;if(!n.mediaDevices)return;const i=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;const t={};return Object.keys(e).forEach((n=>{if("require"===n||"advanced"===n||"mediaSource"===n)return;const i="object"==typeof e[n]?e[n]:{ideal:e[n]};void 0!==i.exact&&"number"==typeof i.exact&&(i.min=i.max=i.exact);const r=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==i.ideal){t.optional=t.optional||[];let e={};"number"==typeof i.ideal?(e[r("min",n)]=i.ideal,t.optional.push(e),e={},e[r("max",n)]=i.ideal,t.optional.push(e)):(e[r("",n)]=i.ideal,t.optional.push(e))}void 0!==i.exact&&"number"!=typeof i.exact?(t.mandatory=t.mandatory||{},t.mandatory[r("",n)]=i.exact):["min","max"].forEach((e=>{void 0!==i[e]&&(t.mandatory=t.mandatory||{},t.mandatory[r(e,n)]=i[e])}))})),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},r=function(e,r){if(t.version>=61)return r(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"==typeof e.audio){const t=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])};t((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),t(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=i(e.audio)}if(e&&"object"==typeof e.video){let s=e.video.facingMode;s=s&&("object"==typeof s?s:{ideal:s});const a=t.version<66;if(s&&("user"===s.exact||"environment"===s.exact||"user"===s.ideal||"environment"===s.ideal)&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||a)){let t;if(delete e.video.facingMode,"environment"===s.exact||"environment"===s.ideal?t=["back","rear"]:"user"!==s.exact&&"user"!==s.ideal||(t=["front"]),t)return n.mediaDevices.enumerateDevices().then((n=>{let a=(n=n.filter((e=>"videoinput"===e.kind))).find((e=>t.some((t=>e.label.toLowerCase().includes(t)))));return!a&&n.length&&t.includes("back")&&(a=n[n.length-1]),a&&(e.video.deviceId=s.exact?{exact:a.deviceId}:{ideal:a.deviceId}),e.video=i(e.video),_("chrome: "+JSON.stringify(e)),r(e)}))}e.video=i(e.video)}return _("chrome: "+JSON.stringify(e)),r(e)},s=function(e){return t.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(n.getUserMedia=function(e,t,i){r(e,(e=>{n.webkitGetUserMedia(e,t,(e=>{i&&i(s(e))}))}))}.bind(n),n.mediaDevices.getUserMedia){const e=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(t){return r(t,(t=>e(t).then((e=>{if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length)throw e.getTracks().forEach((e=>{e.stop()})),new DOMException("","NotFoundError");return e}),(e=>Promise.reject(s(e))))))}}}function S(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&("function"==typeof t?e.navigator.mediaDevices.getDisplayMedia=function(n){return t(n).then((t=>{const i=n.video&&n.video.width,r=n.video&&n.video.height,s=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:s||3}},i&&(n.video.mandatory.maxWidth=i),r&&(n.video.mandatory.maxHeight=r),e.navigator.mediaDevices.getUserMedia(n)}))}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}function C(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function w(e){if("object"==typeof e&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=t=>{t.stream.addEventListener("addtrack",(n=>{let i;i=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((e=>e.track&&e.track.id===n.track.id)):{track:n.track};const r=new Event("track");r.track=n.track,r.receiver=i,r.transceiver={receiver:i},r.streams=[t.stream],this.dispatchEvent(r)})),t.stream.getTracks().forEach((n=>{let i;i=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((e=>e.track&&e.track.id===n.id)):{track:n};const r=new Event("track");r.track=n,r.receiver=i,r.transceiver={receiver:i},r.streams=[t.stream],this.dispatchEvent(r)}))},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else l(e,"track",(e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e)))}function T(e){if("object"==typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,i){let r=n.apply(this,arguments);return r||(r=t(this,e),this._senders.push(r)),r};const i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){i.apply(this,arguments);const t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._senders=this._senders||[],n.apply(this,[e]),e.getTracks().forEach((e=>{this._senders.push(t(this,e))}))};const i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._senders=this._senders||[],i.apply(this,[e]),e.getTracks().forEach((e=>{const t=this._senders.find((t=>t.track===e));t&&this._senders.splice(this._senders.indexOf(t),1)}))}}else if("object"==typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function x(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,n,i]=arguments;if(arguments.length>0&&"function"==typeof e)return t.apply(this,arguments);if(0===t.length&&(0===arguments.length||"function"!=typeof e))return t.apply(this,[]);const r=function(e){const t={};return e.result().forEach((e=>{const n={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach((t=>{n[t]=e.stat(t)})),t[n.id]=n})),t},s=function(e){return new Map(Object.keys(e).map((t=>[t,e[t]])))};if(arguments.length>=2){const i=function(e){n(s(r(e)))};return t.apply(this,[i,e])}return new Promise(((e,n)=>{t.apply(this,[function(t){e(s(r(t)))},n])})).then(n,i)}}function k(e){if(!("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){const e=this;return this._pc.getStats().then((t=>y(t,e.track,!0)))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e}),l(e,"track",(e=>(e.receiver._pc=e.srcElement,e))),e.RTCRtpReceiver.prototype.getStats=function(){const e=this;return this._pc.getStats().then((t=>y(t,e.track,!1)))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const e=arguments[0];let t,n,i;return this.getSenders().forEach((n=>{n.track===e&&(t?i=!0:t=n)})),this.getReceivers().forEach((t=>(t.track===e&&(n?i=!0:n=t),t.track===e))),i||t&&n?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):t?t.getStats():n?n.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function R(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map((e=>this._shimmedLocalStreams[e][0]))};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){if(!n)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const i=t.apply(this,arguments);return this._shimmedLocalStreams[n.id]?-1===this._shimmedLocalStreams[n.id].indexOf(i)&&this._shimmedLocalStreams[n.id].push(i):this._shimmedLocalStreams[n.id]=[n,i],i};const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach((e=>{if(this.getSenders().find((t=>t.track===e)))throw new DOMException("Track already exists.","InvalidAccessError")}));const t=this.getSenders();n.apply(this,arguments);const i=this.getSenders().filter((e=>-1===t.indexOf(e)));this._shimmedLocalStreams[e.id]=[e].concat(i)};const i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],i.apply(this,arguments)};const r=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach((t=>{const n=this._shimmedLocalStreams[t].indexOf(e);-1!==n&&this._shimmedLocalStreams[t].splice(n,1),1===this._shimmedLocalStreams[t].length&&delete this._shimmedLocalStreams[t]})),r.apply(this,arguments)}}function O(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return R(e);const n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const e=n.apply(this);return this._reverseStreams=this._reverseStreams||{},e.map((e=>this._reverseStreams[e.id]))};const i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach((e=>{if(this.getSenders().find((t=>t.track===e)))throw new DOMException("Track already exists.","InvalidAccessError")})),!this._reverseStreams[t.id]){const n=new e.MediaStream(t.getTracks());this._streams[t.id]=n,this._reverseStreams[n.id]=t,t=n}i.apply(this,[t])};const r=e.RTCPeerConnection.prototype.removeStream;function s(e,t){let n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((t=>{const i=e._reverseStreams[t],r=e._streams[i.id];n=n.replace(new RegExp(r.id,"g"),i.id)})),new RTCSessionDescription({type:t.type,sdp:n})}function a(e,t){let n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((t=>{const i=e._reverseStreams[t],r=e._streams[i.id];n=n.replace(new RegExp(i.id,"g"),r.id)})),new RTCSessionDescription({type:t.type,sdp:n})}e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},r.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,n){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const i=[].slice.call(arguments,1);if(1!==i.length||!i[0].getTracks().find((e=>e===t)))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");const r=this.getSenders().find((e=>e.track===t));if(r)throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const s=this._streams[n.id];if(s)s.addTrack(t),Promise.resolve().then((()=>{this.dispatchEvent(new Event("negotiationneeded"))}));else{const i=new e.MediaStream([t]);this._streams[n.id]=i,this._reverseStreams[i.id]=n,this.addStream(i)}return this.getSenders().find((e=>e.track===t))},["createOffer","createAnswer"].forEach((function(t){const n=e.RTCPeerConnection.prototype[t],i={[t](){const e=arguments;return arguments.length&&"function"==typeof arguments[0]?n.apply(this,[t=>{const n=s(this,t);e[0].apply(null,[n])},t=>{e[1]&&e[1].apply(null,t)},arguments[2]]):n.apply(this,arguments).then((e=>s(this,e)))}};e.RTCPeerConnection.prototype[t]=i[t]}));const o=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=a(this,arguments[0]),o.apply(this,arguments)):o.apply(this,arguments)};const c=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const e=c.get.apply(this);return""===e.type?e:s(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(e._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let t;this._streams=this._streams||{},Object.keys(this._streams).forEach((n=>{this._streams[n].getTracks().find((t=>e.track===t))&&(t=this._streams[n])})),t&&(1===t.getTracks().length?this.removeStream(this._reverseStreams[t.id]):t.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}function P(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){const n=e.RTCPeerConnection.prototype[t],i={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=i[t]}))}function E(e,t){l(e,"negotiationneeded",(e=>{const n=e.target;if(!(t.version<72||n.getConfiguration&&"plan-b"===n.getConfiguration().sdpSemantics)||"stable"===n.signalingState)return e}))}function j(e,t){const n=e&&e.navigator,i=e&&e.MediaStreamTrack;if(n.getUserMedia=function(e,t,i){m("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(e).then(t,i)},!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const e=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])},t=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(n){return"object"==typeof n&&"object"==typeof n.audio&&(n=JSON.parse(JSON.stringify(n)),e(n.audio,"autoGainControl","mozAutoGainControl"),e(n.audio,"noiseSuppression","mozNoiseSuppression")),t(n)},i&&i.prototype.getSettings){const t=i.prototype.getSettings;i.prototype.getSettings=function(){const n=t.apply(this,arguments);return e(n,"mozAutoGainControl","autoGainControl"),e(n,"mozNoiseSuppression","noiseSuppression"),n}}if(i&&i.prototype.applyConstraints){const t=i.prototype.applyConstraints;i.prototype.applyConstraints=function(n){return"audio"===this.kind&&"object"==typeof n&&(n=JSON.parse(JSON.stringify(n)),e(n,"autoGainControl","mozAutoGainControl"),e(n,"noiseSuppression","mozNoiseSuppression")),t.apply(this,[n])}}}}function N(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){const e=new DOMException("getDisplayMedia without video constraints is undefined");return e.name="NotFoundError",e.code=8,Promise.reject(e)}return!0===n.video?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)})}function M(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function D(e,t){if("object"!=typeof e||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){const n=e.RTCPeerConnection.prototype[t],i={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=i[t]}));const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,r,s]=arguments;return i.apply(this,[e||null]).then((e=>{if(t.version<53&&!r)try{e.forEach((e=>{e.type=n[e.type]||e.type}))}catch(t){if("TypeError"!==t.name)throw t;e.forEach(((t,i)=>{e.set(i,Object.assign({},t,{type:n[t.type]||t.type}))}))}return e})).then(r,s)}}function I(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function A(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e}),l(e,"track",(e=>(e.receiver._pc=e.srcElement,e))),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function L(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(e){m("removeStream","removeTrack"),this.getSenders().forEach((t=>{t.track&&e.getTracks().includes(t.track)&&this.removeTrack(t)}))})}function V(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function Z(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];const e=arguments[1],n=e&&"sendEncodings"in e;n&&e.sendEncodings.forEach((e=>{if("rid"in e){if(!/^[a-z0-9]{0,16}$/i.test(e.rid))throw new TypeError("Invalid RID value provided.")}if("scaleResolutionDownBy"in e&&!(parseFloat(e.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(parseFloat(e.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")}));const i=t.apply(this,arguments);if(n){const{sender:t}=i,n=t.getParameters();(!("encodings"in n)||1===n.encodings.length&&0===Object.keys(n.encodings[0]).length)&&(n.encodings=e.sendEncodings,t.sendEncodings=e.sendEncodings,this.setParametersPromises.push(t.setParameters(n).then((()=>{delete t.sendEncodings})).catch((()=>{delete t.sendEncodings}))))}return i})}function F(e){if("object"!=typeof e||!e.RTCRtpSender)return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const e=t.apply(this,arguments);return"encodings"in e||(e.encodings=[].concat(this.sendEncodings||[{}])),e})}function U(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((()=>t.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):t.apply(this,arguments)}}function B(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((()=>t.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):t.apply(this,arguments)}}function $(e){if("object"==typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getAudioTracks().forEach((n=>t.call(this,n,e))),e.getVideoTracks().forEach((n=>t.call(this,n,e)))},e.RTCPeerConnection.prototype.addTrack=function(e,...n){return n&&n.forEach((e=>{this._localStreams?this._localStreams.includes(e)||this._localStreams.push(e):this._localStreams=[e]})),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);const t=this._localStreams.indexOf(e);if(-1===t)return;this._localStreams.splice(t,1);const n=e.getTracks();this.getSenders().forEach((e=>{n.includes(e.track)&&this.removeTrack(e)}))})}}function z(e){if("object"==typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=e=>{e.streams.forEach((e=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(e))return;this._remoteStreams.push(e);const t=new Event("addstream");t.stream=e,this.dispatchEvent(t)}))})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach((t=>{if(e._remoteStreams||(e._remoteStreams=[]),e._remoteStreams.indexOf(t)>=0)return;e._remoteStreams.push(t);const n=new Event("addstream");n.stream=t,e.dispatchEvent(n)}))}),t.apply(e,arguments)}}}function q(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,n=t.createOffer,i=t.createAnswer,r=t.setLocalDescription,s=t.setRemoteDescription,a=t.addIceCandidate;t.createOffer=function(e,t){const i=arguments.length>=2?arguments[2]:arguments[0],r=n.apply(this,[i]);return t?(r.then(e,t),Promise.resolve()):r},t.createAnswer=function(e,t){const n=arguments.length>=2?arguments[2]:arguments[0],r=i.apply(this,[n]);return t?(r.then(e,t),Promise.resolve()):r};let o=function(e,t,n){const i=r.apply(this,[e]);return n?(i.then(t,n),Promise.resolve()):i};t.setLocalDescription=o,o=function(e,t,n){const i=s.apply(this,[e]);return n?(i.then(t,n),Promise.resolve()):i},t.setRemoteDescription=o,o=function(e,t,n){const i=a.apply(this,[e]);return n?(i.then(t,n),Promise.resolve()):i},t.addIceCandidate=o}function G(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const e=t.mediaDevices,n=e.getUserMedia.bind(e);t.mediaDevices.getUserMedia=e=>n(W(e))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,n,i){t.mediaDevices.getUserMedia(e).then(n,i)}.bind(t))}function W(e){return e&&void 0!==e.video?Object.assign({},e,{video:g(e.video)}):e}function K(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,n){if(e&&e.iceServers){const t=[];for(let n=0;n<e.iceServers.length;n++){let i=e.iceServers[n];!i.hasOwnProperty("urls")&&i.hasOwnProperty("url")?(m("RTCIceServer.url","RTCIceServer.urls"),i=JSON.parse(JSON.stringify(i)),i.urls=i.url,delete i.url,t.push(i)):t.push(e.iceServers[n])}e.iceServers=t}return new t(e,n)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function J(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function H(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);const t=this.getTransceivers().find((e=>"audio"===e.receiver.track.kind));!1===e.offerToReceiveAudio&&t?"sendrecv"===t.direction?t.setDirection?t.setDirection("sendonly"):t.direction="sendonly":"recvonly"===t.direction&&(t.setDirection?t.setDirection("inactive"):t.direction="inactive"):!0!==e.offerToReceiveAudio||t||this.addTransceiver("audio",{direction:"recvonly"}),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);const n=this.getTransceivers().find((e=>"video"===e.receiver.track.kind));!1===e.offerToReceiveVideo&&n?"sendrecv"===n.direction?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":"recvonly"===n.direction&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):!0!==e.offerToReceiveVideo||n||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function X(e){"object"!=typeof e||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var Y=n(286),Q=n.n(Y);function ee(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"==typeof e&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){const n=new t(e),i=Q().parseCandidate(e.candidate),r=Object.assign(n,i);return r.toJSON=function(){return{candidate:r.candidate,sdpMid:r.sdpMid,sdpMLineIndex:r.sdpMLineIndex,usernameFragment:r.usernameFragment}},r}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,l(e,"icecandidate",(t=>(t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t)))}function te(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return void 0===this._sctp?null:this._sctp}});const n=function(e){if(!e||!e.sdp)return!1;const t=Q().splitSections(e.sdp);return t.shift(),t.some((e=>{const t=Q().parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")}))},i=function(e){const t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;const n=parseInt(t[1],10);return n!=n?-1:n},r=function(e){let n=65536;return"firefox"===t.browser&&(n=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),n},s=function(e,n){let i=65536;"firefox"===t.browser&&57===t.version&&(i=65535);const r=Q().matchPrefix(e.sdp,"a=max-message-size:");return r.length>0?i=parseInt(r[0].substr(19),10):"firefox"===t.browser&&-1!==n&&(i=2147483637),i},a=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===t.browser&&t.version>=76){const{sdpSemantics:e}=this.getConfiguration();"plan-b"===e&&Object.defineProperty(this,"sctp",{get(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const e=i(arguments[0]),t=r(e),n=s(arguments[0],e);let a;a=0===t&&0===n?Number.POSITIVE_INFINITY:0===t||0===n?Math.max(t,n):Math.min(t,n);const o={};Object.defineProperty(o,"maxMessageSize",{get:()=>a}),this._sctp=o}return a.apply(this,arguments)}}function ne(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(e,t){const n=e.send;e.send=function(){const i=arguments[0],r=i.length||i.size||i.byteLength;if("open"===e.readyState&&t.sctp&&r>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return n.apply(e,arguments)}}const n=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const e=n.apply(this,arguments);return t(e,this),e},l(e,"datachannel",(e=>(t(e.channel,e.target),e)))}function ie(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach((e=>{const n=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=e=>{const t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;const n=new Event("connectionstatechange",e);t.dispatchEvent(n)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),n.apply(this,arguments)}}))}function re(e,t){if(!e.RTCPeerConnection)return;if("chrome"===t.browser&&t.version>=71)return;if("safari"===t.browser&&t.version>=605)return;const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(t){if(t&&t.sdp&&-1!==t.sdp.indexOf("\na=extmap-allow-mixed")){const n=t.sdp.split("\n").filter((e=>"a=extmap-allow-mixed"!==e.trim())).join("\n");e.RTCSessionDescription&&t instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:t.type,sdp:n}):t.sdp=n}return n.apply(this,arguments)}}function se(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.addIceCandidate;n&&0!==n.length&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===t.browser&&t.version<78||"firefox"===t.browser&&t.version<68||"safari"===t.browser)&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function ae(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.setLocalDescription;n&&0!==n.length&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let e=arguments[0]||{};if("object"!=typeof e||e.type&&e.sdp)return n.apply(this,arguments);if(e={type:e.type,sdp:e.sdp},!e.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":e.type="offer";break;default:e.type="answer"}if(e.sdp||"offer"!==e.type&&"answer"!==e.type)return n.apply(this,[e]);const t="offer"===e.type?this.createOffer:this.createAnswer;return t.apply(this).then((e=>n.apply(this,[e])))})}const oe=function({window:e}={},t={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const n=h,o=function(e){const t={browser:null,version:null};if(void 0===e||!e.navigator)return t.browser="Not a browser.",t;const{navigator:n}=e;if(n.mozGetUserMedia)t.browser="firefox",t.version=d(n.userAgent,/Firefox\/(\d+)\./,1);else if(n.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection&&!e.RTCIceGatherer)t.browser="chrome",t.version=d(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!e.RTCPeerConnection||!n.userAgent.match(/AppleWebKit\/(\d+)\./))return t.browser="Not a supported browser.",t;t.browser="safari",t.version=d(n.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}return t}(e),c={browserDetails:o,commonShim:a,extractVersion:d,disableLog:u,disableWarnings:p,sdp:Y};switch(o.browser){case"chrome":if(!i||!P||!t.shimChrome)return n("Chrome shim is not included in this adapter release."),c;if(null===o.version)return n("Chrome shim can not determine version, not shimming."),c;n("adapter.js shimming chrome."),c.browserShim=i,se(e,o),ae(e),b(e,o),C(e),P(e,o),w(e),O(e,o),T(e),x(e),k(e),E(e,o),ee(e),ie(e),te(e,o),ne(e),re(e,o);break;case"firefox":if(!r||!D||!t.shimFirefox)return n("Firefox shim is not included in this adapter release."),c;n("adapter.js shimming firefox."),c.browserShim=r,se(e,o),ae(e),j(e,o),D(e,o),M(e),L(e),I(e),A(e),V(e),Z(e),F(e),U(e),B(e),ee(e),ie(e),te(e,o),ne(e);break;case"safari":if(!s||!t.shimSafari)return n("Safari shim is not included in this adapter release."),c;n("adapter.js shimming safari."),c.browserShim=s,se(e,o),ae(e),K(e),H(e),q(e),$(e),z(e),J(e),G(e),X(e),ee(e),te(e,o),ne(e),re(e,o);break;default:n("Unsupported browser!")}return c}({window:"undefined"==typeof window?void 0:window}),ce=oe}},t={};function n(i){var r=t[i];if(void 0!==r)return r.exports;var s=t[i]={exports:{}};return e[i].call(s.exports,s,s.exports,n),s.exports}n.amdO={},n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var i={};return(()=>{n.r(i),n.d(i,{DeviceUtils:()=>Kt,HelperUtils:()=>e,LogLevel:()=>o,SHA:()=>Qn,StreamUtils:()=>Xt,VERSION:()=>Yn,Webcaster:()=>Xn,getLogDumpData:()=>v,getLogger:()=>g,overrideLoggerDefaults:()=>f,overrideOnLogCallback:()=>y});class e{static isBoolean(e){return"boolean"==typeof e}static isUndefined(e){return void 0===e}static isDefined(t){return!e.isUndefined(t)}static isNumber(e){return"number"==typeof e}static isObject(e){return"object"==typeof e}static isString(e){return"string"==typeof e}static orNull(e){return e||null}static orZero(e){return e||0}static orInfinity(e,t=!1){return e||(t?-1/0:1/0)}static oneBitQuantize(e){return 0===e?0:1}static roundToPrecision(e,t=0){const n=Math.pow(10,t);return Math.round(e*n)/n}static kbps(e){return 1e3*e}static mbps(e){return 1e6*e}static cloneSerializable(e){return JSON.parse(JSON.stringify(e))}static isEmpty(e){return 0===Object.keys(e).length}static prettyPrintJson(e){return JSON.stringify(e,null,4)}static msToSecs(e){return e/1e3}static minBy(e,t){const n=Math.min(...e.map(t));return e.find((e=>t(e)===n))}static maxBy(e,t){const n=Math.max(...e.map(t));return e.find((e=>t(e)===n))}static meanBy(e,t){return e.reduce(((e,n)=>e+t(n)),0)/e.length}static assignInitTypedProps(t,n,i){if(t&&n)for(const r in t)typeof n[r]==typeof t[r]&&(e.isObject(t[r])?i&&null===t[r]?t[r]=n[r]:e.assignInitTypedProps(t[r],n[r],i):t[r]=n[r])}static filterObjectByMask(t,n,i){const r=Object.assign({},n);return e.assignInitTypedProps(r,t,i),r}static removeLastPathPart(e){try{const t=new URL(e).toString();return t.slice(0,t.lastIndexOf("/"))}catch(e){throw new Error(`Failed to parse URL: ${e.message}`)}}static removeTrailingSlash(e){let t=e;return e.endsWith("/")&&(t=e.substring(0,e.length-1)),t}static exponentialBaseOnRange(e,t,n){if(e<=0||t<=0)throw new Error("sideA and sideB must be greater than 0.");if(n<=1)throw new Error("Steps must be greater than 1.");if(e>=t)throw new Error("sideA must be less than sideB.");return Math.pow(t/e,1/(n-1))}}e.noop=()=>{},e.wait=e=>new Promise(((t,n)=>setTimeout(t,e)));const{noop:t,isNumber:r,isString:s,isUndefined:a}=e;var o;!function(e){e[e.TRACE=6]="TRACE",e[e.DEBUG=5]="DEBUG",e[e.LOG=4]="LOG",e[e.INFO=3]="INFO",e[e.WARN=2]="WARN",e[e.ERROR=1]="ERROR",e[e.OFF=0]="OFF"}(o||(o={}));const c="nanostream-webcaster",d=o.OFF,l={level:d,domain:c,prefix:"",withLevel:!0,enableDebug:!1};let u=t;const p=[],h=new class{constructor(){this._logLineStore=[],this.trace=this._storeMsg.bind(this,o.TRACE),this.debug=this._storeMsg.bind(this,o.DEBUG),this.log=this._storeMsg.bind(this,o.LOG),this.info=this._storeMsg.bind(this,o.INFO),this.warn=this._storeMsg.bind(this,o.WARN),this.error=this._storeMsg.bind(this,o.ERROR)}_storeMsg(e,...t){this._logLineStore.push([e,Date.now(),t.join(" ")]),this._applyLimits()}_applyLimits(){const e=this._logLineStore.length-1e4;e>0&&this._logLineStore.splice(0,e);const t=Date.now();for(;t-this._logLineStore[0][1]>=36e5;)this._logLineStore.shift()}getStoredData(){return this._logLineStore}};function m(e,n){const i=function(e){const t=o[e.toUpperCase()];return r(t)?t:o.OFF}(e);if(function(e,t){return!!r(e.level)&&t<=e.level}(n,i)){const r=function(e,t){const{domain:n,prefix:i,withLevel:r}=e;if(!i)throw new Error("LoggerConfig can not have empty prefix");return`${n} <${i}>${r?` [${o[t]}]`:""} |`}(n,i),s=function(e,n){return console[e]?console[e].bind(console,n):t}(e,r);if(n.enableDebug)return s;const a=[t=>h[e](r,...t),t=>u(e,r,...t)];return(...e)=>a.forEach((t=>t(e)))}return t}function f(e,t=!1){if(e.prefix)throw new Error("Logger defaults can not carry a set `prefix` parameter");Object.assign(l,e),t&&localStorage.setItem("logger:"+l.domain,JSON.stringify(l))}function g(e){let t;var n;if(s(e)?(n=e,t=Object.assign(Object.assign({},l),{prefix:n})):t=e,!Number.isInteger(t.level)||t.level<0)throw new Error("LogLevel has to be integer >= 0 but have: "+t.level);const i={trace:m("trace",t),debug:m("debug",t),log:m("log",t),info:m("info",t),warn:m("warn",t),error:m("error",t)};return p.push([t,i]),i}function v(){return h.getStoredData()}function y(e){if(a(e))throw new Error("Callback is undefined");if("function"!=typeof e)throw new Error("Callback is not a function");u=e,p.forEach((([e,t])=>{for(const n in t){const i=n;t[i]=m(i,e)}}))}!function(){const e=localStorage.getItem("logger:"+c);e&&f(JSON.parse(e))}();var _,b,S=function(e,t,n,i){return new(n||(n=Promise))((function(r,s){function a(e){try{c(i.next(e))}catch(e){s(e)}}function o(e){try{c(i.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}c((i=i.apply(e,t||[])).next())}))};!function(e){e.assertEqual=e=>e,e.assertIs=function(e){},e.assertNever=function(e){throw new Error},e.arrayToEnum=e=>{const t={};for(const n of e)t[n]=n;return t},e.getValidEnumValues=t=>{const n=e.objectKeys(t).filter((e=>"number"!=typeof t[t[e]])),i={};for(const e of n)i[e]=t[e];return e.objectValues(i)},e.objectValues=t=>e.objectKeys(t).map((function(e){return t[e]})),e.objectKeys="function"==typeof Object.keys?e=>Object.keys(e):e=>{const t=[];for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(n);return t},e.find=(e,t)=>{for(const n of e)if(t(n))return n},e.isInteger="function"==typeof Number.isInteger?e=>Number.isInteger(e):e=>"number"==typeof e&&isFinite(e)&&Math.floor(e)===e,e.joinValues=function(e,t=" | "){return e.map((e=>"string"==typeof e?`'${e}'`:e)).join(t)},e.jsonStringifyReplacer=(e,t)=>"bigint"==typeof t?t.toString():t}(_||(_={})),function(e){e.mergeShapes=(e,t)=>Object.assign(Object.assign({},e),t)}(b||(b={}));const C=_.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),w=e=>{switch(typeof e){case"undefined":return C.undefined;case"string":return C.string;case"number":return isNaN(e)?C.nan:C.number;case"boolean":return C.boolean;case"function":return C.function;case"bigint":return C.bigint;case"symbol":return C.symbol;case"object":return Array.isArray(e)?C.array:null===e?C.null:e.then&&"function"==typeof e.then&&e.catch&&"function"==typeof e.catch?C.promise:"undefined"!=typeof Map&&e instanceof Map?C.map:"undefined"!=typeof Set&&e instanceof Set?C.set:"undefined"!=typeof Date&&e instanceof Date?C.date:C.object;default:return C.unknown}},T=_.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class x extends Error{constructor(e){super(),this.issues=[],this.addIssue=e=>{this.issues=[...this.issues,e]},this.addIssues=(e=[])=>{this.issues=[...this.issues,...e]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}get errors(){return this.issues}format(e){const t=e||function(e){return e.message},n={_errors:[]},i=e=>{for(const r of e.issues)if("invalid_union"===r.code)r.unionErrors.map(i);else if("invalid_return_type"===r.code)i(r.returnTypeError);else if("invalid_arguments"===r.code)i(r.argumentsError);else if(0===r.path.length)n._errors.push(t(r));else{let e=n,i=0;for(;i<r.path.length;){const n=r.path[i];i===r.path.length-1?(e[n]=e[n]||{_errors:[]},e[n]._errors.push(t(r))):e[n]=e[n]||{_errors:[]},e=e[n],i++}}};return i(this),n}toString(){return this.message}get message(){return JSON.stringify(this.issues,_.jsonStringifyReplacer,2)}get isEmpty(){return 0===this.issues.length}flatten(e=(e=>e.message)){const t={},n=[];for(const i of this.issues)i.path.length>0?(t[i.path[0]]=t[i.path[0]]||[],t[i.path[0]].push(e(i))):n.push(e(i));return{formErrors:n,fieldErrors:t}}get formErrors(){return this.flatten()}}x.create=e=>new x(e);const k=(e,t)=>{let n;switch(e.code){case T.invalid_type:n=e.received===C.undefined?"Required":`Expected ${e.expected}, received ${e.received}`;break;case T.invalid_literal:n=`Invalid literal value, expected ${JSON.stringify(e.expected,_.jsonStringifyReplacer)}`;break;case T.unrecognized_keys:n=`Unrecognized key(s) in object: ${_.joinValues(e.keys,", ")}`;break;case T.invalid_union:n="Invalid input";break;case T.invalid_union_discriminator:n=`Invalid discriminator value. Expected ${_.joinValues(e.options)}`;break;case T.invalid_enum_value:n=`Invalid enum value. Expected ${_.joinValues(e.options)}, received '${e.received}'`;break;case T.invalid_arguments:n="Invalid function arguments";break;case T.invalid_return_type:n="Invalid function return type";break;case T.invalid_date:n="Invalid date";break;case T.invalid_string:"object"==typeof e.validation?"includes"in e.validation?(n=`Invalid input: must include "${e.validation.includes}"`,"number"==typeof e.validation.position&&(n=`${n} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?n=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?n=`Invalid input: must end with "${e.validation.endsWith}"`:_.assertNever(e.validation):n="regex"!==e.validation?`Invalid ${e.validation}`:"Invalid";break;case T.too_small:n="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:"date"===e.type?`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:"Invalid input";break;case T.too_big:n="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"bigint"===e.type?`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"date"===e.type?`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:"Invalid input";break;case T.custom:n="Invalid input";break;case T.invalid_intersection_types:n="Intersection results could not be merged";break;case T.not_multiple_of:n=`Number must be a multiple of ${e.multipleOf}`;break;case T.not_finite:n="Number must be finite";break;default:n=t.defaultError,_.assertNever(e)}return{message:n}};let R=k;function O(){return R}const P=e=>{const{data:t,path:n,errorMaps:i,issueData:r}=e,s=[...n,...r.path||[]],a=Object.assign(Object.assign({},r),{path:s});let o="";const c=i.filter((e=>!!e)).slice().reverse();for(const e of c)o=e(a,{data:t,defaultError:o}).message;return Object.assign(Object.assign({},r),{path:s,message:r.message||o})};function E(e,t){const n=P({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,O(),k].filter((e=>!!e))});e.common.issues.push(n)}class j{constructor(){this.value="valid"}dirty(){"valid"===this.value&&(this.value="dirty")}abort(){"aborted"!==this.value&&(this.value="aborted")}static mergeArray(e,t){const n=[];for(const i of t){if("aborted"===i.status)return N;"dirty"===i.status&&e.dirty(),n.push(i.value)}return{status:e.value,value:n}}static mergeObjectAsync(e,t){return S(this,void 0,void 0,(function*(){const n=[];for(const e of t)n.push({key:yield e.key,value:yield e.value});return j.mergeObjectSync(e,n)}))}static mergeObjectSync(e,t){const n={};for(const i of t){const{key:t,value:r}=i;if("aborted"===t.status)return N;if("aborted"===r.status)return N;"dirty"===t.status&&e.dirty(),"dirty"===r.status&&e.dirty(),"__proto__"===t.value||void 0===r.value&&!i.alwaysSet||(n[t.value]=r.value)}return{status:e.value,value:n}}}const N=Object.freeze({status:"aborted"}),M=e=>({status:"dirty",value:e}),D=e=>({status:"valid",value:e}),I=e=>"aborted"===e.status,A=e=>"dirty"===e.status,L=e=>"valid"===e.status,V=e=>"undefined"!=typeof Promise&&e instanceof Promise;var Z;!function(e){e.errToObj=e=>"string"==typeof e?{message:e}:e||{},e.toString=e=>"string"==typeof e?e:null==e?void 0:e.message}(Z||(Z={}));class F{constructor(e,t,n,i){this._cachedPath=[],this.parent=e,this.data=t,this._path=n,this._key=i}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const U=(e,t)=>{if(L(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new x(e.common.issues);return this._error=t,this._error}}};function B(e){if(!e)return{};const{errorMap:t,invalid_type_error:n,required_error:i,description:r}=e;if(t&&(n||i))throw new Error('Can\'t use "invalid_type_error" or "required_error" in conjunction with custom error map.');if(t)return{errorMap:t,description:r};return{errorMap:(e,t)=>"invalid_type"!==e.code?{message:t.defaultError}:void 0===t.data?{message:null!=i?i:t.defaultError}:{message:null!=n?n:t.defaultError},description:r}}class ${constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this)}get description(){return this._def.description}_getType(e){return w(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:w(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new j,ctx:{common:e.parent.common,data:e.data,parsedType:w(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(V(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const n=this.safeParse(e,t);if(n.success)return n.data;throw n.error}safeParse(e,t){var n;const i={common:{issues:[],async:null!==(n=null==t?void 0:t.async)&&void 0!==n&&n,contextualErrorMap:null==t?void 0:t.errorMap},path:(null==t?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:w(e)},r=this._parseSync({data:e,path:i.path,parent:i});return U(i,r)}parseAsync(e,t){return S(this,void 0,void 0,(function*(){const n=yield this.safeParseAsync(e,t);if(n.success)return n.data;throw n.error}))}safeParseAsync(e,t){return S(this,void 0,void 0,(function*(){const n={common:{issues:[],contextualErrorMap:null==t?void 0:t.errorMap,async:!0},path:(null==t?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:w(e)},i=this._parse({data:e,path:n.path,parent:n}),r=yield V(i)?i:Promise.resolve(i);return U(n,r)}))}refine(e,t){return this._refinement(((n,i)=>{const r=e(n),s=()=>i.addIssue(Object.assign({code:T.custom},(e=>"string"==typeof t||void 0===t?{message:t}:"function"==typeof t?t(e):t)(n)));return"undefined"!=typeof Promise&&r instanceof Promise?r.then((e=>!!e||(s(),!1))):!!r||(s(),!1)}))}refinement(e,t){return this._refinement(((n,i)=>!!e(n)||(i.addIssue("function"==typeof t?t(n,i):t),!1)))}_refinement(e){return new Ee({schema:this,typeName:Be.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}optional(){return je.create(this,this._def)}nullable(){return Ne.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return ue.create(this,this._def)}promise(){return Pe.create(this,this._def)}or(e){return me.create([this,e],this._def)}and(e){return ye.create(this,e,this._def)}transform(e){return new Ee(Object.assign(Object.assign({},B(this._def)),{schema:this,typeName:Be.ZodEffects,effect:{type:"transform",transform:e}}))}default(e){const t="function"==typeof e?e:()=>e;return new Me(Object.assign(Object.assign({},B(this._def)),{innerType:this,defaultValue:t,typeName:Be.ZodDefault}))}brand(){return new Le(Object.assign({typeName:Be.ZodBranded,type:this},B(this._def)))}catch(e){const t="function"==typeof e?e:()=>e;return new De(Object.assign(Object.assign({},B(this._def)),{innerType:this,catchValue:t,typeName:Be.ZodCatch}))}describe(e){return new(0,this.constructor)(Object.assign(Object.assign({},this._def),{description:e}))}pipe(e){return Ve.create(this,e)}readonly(){return Ze.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const z=/^c[^\s-]{8,}$/i,q=/^[a-z][a-z0-9]*$/,G=/^[0-9A-HJKMNP-TV-Z]{26}$/,W=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,K=/^(?!\.)(?!.*\.\.)([A-Z0-9_+-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i;let J;const H=/^(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))$/,X=/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/;class Y extends ${_parse(e){this._def.coerce&&(e.data=String(e.data));if(this._getType(e)!==C.string){const t=this._getOrReturnCtx(e);return E(t,{code:T.invalid_type,expected:C.string,received:t.parsedType}),N}const t=new j;let n;for(const a of this._def.checks)if("min"===a.kind)e.data.length<a.value&&(n=this._getOrReturnCtx(e,n),E(n,{code:T.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),t.dirty());else if("max"===a.kind)e.data.length>a.value&&(n=this._getOrReturnCtx(e,n),E(n,{code:T.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),t.dirty());else if("length"===a.kind){const i=e.data.length>a.value,r=e.data.length<a.value;(i||r)&&(n=this._getOrReturnCtx(e,n),i?E(n,{code:T.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}):r&&E(n,{code:T.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}),t.dirty())}else if("email"===a.kind)K.test(e.data)||(n=this._getOrReturnCtx(e,n),E(n,{validation:"email",code:T.invalid_string,message:a.message}),t.dirty());else if("emoji"===a.kind)J||(J=new RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),J.test(e.data)||(n=this._getOrReturnCtx(e,n),E(n,{validation:"emoji",code:T.invalid_string,message:a.message}),t.dirty());else if("uuid"===a.kind)W.test(e.data)||(n=this._getOrReturnCtx(e,n),E(n,{validation:"uuid",code:T.invalid_string,message:a.message}),t.dirty());else if("cuid"===a.kind)z.test(e.data)||(n=this._getOrReturnCtx(e,n),E(n,{validation:"cuid",code:T.invalid_string,message:a.message}),t.dirty());else if("cuid2"===a.kind)q.test(e.data)||(n=this._getOrReturnCtx(e,n),E(n,{validation:"cuid2",code:T.invalid_string,message:a.message}),t.dirty());else if("ulid"===a.kind)G.test(e.data)||(n=this._getOrReturnCtx(e,n),E(n,{validation:"ulid",code:T.invalid_string,message:a.message}),t.dirty());else if("url"===a.kind)try{new URL(e.data)}catch(i){n=this._getOrReturnCtx(e,n),E(n,{validation:"url",code:T.invalid_string,message:a.message}),t.dirty()}else if("regex"===a.kind){a.regex.lastIndex=0;a.regex.test(e.data)||(n=this._getOrReturnCtx(e,n),E(n,{validation:"regex",code:T.invalid_string,message:a.message}),t.dirty())}else if("trim"===a.kind)e.data=e.data.trim();else if("includes"===a.kind)e.data.includes(a.value,a.position)||(n=this._getOrReturnCtx(e,n),E(n,{code:T.invalid_string,validation:{includes:a.value,position:a.position},message:a.message}),t.dirty());else if("toLowerCase"===a.kind)e.data=e.data.toLowerCase();else if("toUpperCase"===a.kind)e.data=e.data.toUpperCase();else if("startsWith"===a.kind)e.data.startsWith(a.value)||(n=this._getOrReturnCtx(e,n),E(n,{code:T.invalid_string,validation:{startsWith:a.value},message:a.message}),t.dirty());else if("endsWith"===a.kind)e.data.endsWith(a.value)||(n=this._getOrReturnCtx(e,n),E(n,{code:T.invalid_string,validation:{endsWith:a.value},message:a.message}),t.dirty());else if("datetime"===a.kind){((s=a).precision?s.offset?new RegExp(`^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{${s.precision}}(([+-]\\d{2}(:?\\d{2})?)|Z)$`):new RegExp(`^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{${s.precision}}Z$`):0===s.precision?s.offset?new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(([+-]\\d{2}(:?\\d{2})?)|Z)$"):new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}Z$"):s.offset?new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?(([+-]\\d{2}(:?\\d{2})?)|Z)$"):new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?Z$")).test(e.data)||(n=this._getOrReturnCtx(e,n),E(n,{code:T.invalid_string,validation:"datetime",message:a.message}),t.dirty())}else"ip"===a.kind?(i=e.data,("v4"!==(r=a.version)&&r||!H.test(i))&&("v6"!==r&&r||!X.test(i))&&(n=this._getOrReturnCtx(e,n),E(n,{validation:"ip",code:T.invalid_string,message:a.message}),t.dirty())):_.assertNever(a);var i,r,s;return{status:t.value,value:e.data}}_regex(e,t,n){return this.refinement((t=>e.test(t)),Object.assign({validation:t,code:T.invalid_string},Z.errToObj(n)))}_addCheck(e){return new Y(Object.assign(Object.assign({},this._def),{checks:[...this._def.checks,e]}))}email(e){return this._addCheck(Object.assign({kind:"email"},Z.errToObj(e)))}url(e){return this._addCheck(Object.assign({kind:"url"},Z.errToObj(e)))}emoji(e){return this._addCheck(Object.assign({kind:"emoji"},Z.errToObj(e)))}uuid(e){return this._addCheck(Object.assign({kind:"uuid"},Z.errToObj(e)))}cuid(e){return this._addCheck(Object.assign({kind:"cuid"},Z.errToObj(e)))}cuid2(e){return this._addCheck(Object.assign({kind:"cuid2"},Z.errToObj(e)))}ulid(e){return this._addCheck(Object.assign({kind:"ulid"},Z.errToObj(e)))}ip(e){return this._addCheck(Object.assign({kind:"ip"},Z.errToObj(e)))}datetime(e){var t;return"string"==typeof e?this._addCheck({kind:"datetime",precision:null,offset:!1,message:e}):this._addCheck(Object.assign({kind:"datetime",precision:void 0===(null==e?void 0:e.precision)?null:null==e?void 0:e.precision,offset:null!==(t=null==e?void 0:e.offset)&&void 0!==t&&t},Z.errToObj(null==e?void 0:e.message)))}regex(e,t){return this._addCheck(Object.assign({kind:"regex",regex:e},Z.errToObj(t)))}includes(e,t){return this._addCheck(Object.assign({kind:"includes",value:e,position:null==t?void 0:t.position},Z.errToObj(null==t?void 0:t.message)))}startsWith(e,t){return this._addCheck(Object.assign({kind:"startsWith",value:e},Z.errToObj(t)))}endsWith(e,t){return this._addCheck(Object.assign({kind:"endsWith",value:e},Z.errToObj(t)))}min(e,t){return this._addCheck(Object.assign({kind:"min",value:e},Z.errToObj(t)))}max(e,t){return this._addCheck(Object.assign({kind:"max",value:e},Z.errToObj(t)))}length(e,t){return this._addCheck(Object.assign({kind:"length",value:e},Z.errToObj(t)))}nonempty(e){return this.min(1,Z.errToObj(e))}trim(){return new Y(Object.assign(Object.assign({},this._def),{checks:[...this._def.checks,{kind:"trim"}]}))}toLowerCase(){return new Y(Object.assign(Object.assign({},this._def),{checks:[...this._def.checks,{kind:"toLowerCase"}]}))}toUpperCase(){return new Y(Object.assign(Object.assign({},this._def),{checks:[...this._def.checks,{kind:"toUpperCase"}]}))}get isDatetime(){return!!this._def.checks.find((e=>"datetime"===e.kind))}get isEmail(){return!!this._def.checks.find((e=>"email"===e.kind))}get isURL(){return!!this._def.checks.find((e=>"url"===e.kind))}get isEmoji(){return!!this._def.checks.find((e=>"emoji"===e.kind))}get isUUID(){return!!this._def.checks.find((e=>"uuid"===e.kind))}get isCUID(){return!!this._def.checks.find((e=>"cuid"===e.kind))}get isCUID2(){return!!this._def.checks.find((e=>"cuid2"===e.kind))}get isULID(){return!!this._def.checks.find((e=>"ulid"===e.kind))}get isIP(){return!!this._def.checks.find((e=>"ip"===e.kind))}get minLength(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}function Q(e,t){const n=(e.toString().split(".")[1]||"").length,i=(t.toString().split(".")[1]||"").length,r=n>i?n:i;return parseInt(e.toFixed(r).replace(".",""))%parseInt(t.toFixed(r).replace(".",""))/Math.pow(10,r)}Y.create=e=>{var t;return new Y(Object.assign({checks:[],typeName:Be.ZodString,coerce:null!==(t=null==e?void 0:e.coerce)&&void 0!==t&&t},B(e)))};class ee extends ${constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){this._def.coerce&&(e.data=Number(e.data));if(this._getType(e)!==C.number){const t=this._getOrReturnCtx(e);return E(t,{code:T.invalid_type,expected:C.number,received:t.parsedType}),N}let t;const n=new j;for(const i of this._def.checks)if("int"===i.kind)_.isInteger(e.data)||(t=this._getOrReturnCtx(e,t),E(t,{code:T.invalid_type,expected:"integer",received:"float",message:i.message}),n.dirty());else if("min"===i.kind){(i.inclusive?e.data<i.value:e.data<=i.value)&&(t=this._getOrReturnCtx(e,t),E(t,{code:T.too_small,minimum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),n.dirty())}else if("max"===i.kind){(i.inclusive?e.data>i.value:e.data>=i.value)&&(t=this._getOrReturnCtx(e,t),E(t,{code:T.too_big,maximum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),n.dirty())}else"multipleOf"===i.kind?0!==Q(e.data,i.value)&&(t=this._getOrReturnCtx(e,t),E(t,{code:T.not_multiple_of,multipleOf:i.value,message:i.message}),n.dirty()):"finite"===i.kind?Number.isFinite(e.data)||(t=this._getOrReturnCtx(e,t),E(t,{code:T.not_finite,message:i.message}),n.dirty()):_.assertNever(i);return{status:n.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,Z.toString(t))}gt(e,t){return this.setLimit("min",e,!1,Z.toString(t))}lte(e,t){return this.setLimit("max",e,!0,Z.toString(t))}lt(e,t){return this.setLimit("max",e,!1,Z.toString(t))}setLimit(e,t,n,i){return new ee(Object.assign(Object.assign({},this._def),{checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:Z.toString(i)}]}))}_addCheck(e){return new ee(Object.assign(Object.assign({},this._def),{checks:[...this._def.checks,e]}))}int(e){return this._addCheck({kind:"int",message:Z.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:Z.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:Z.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:Z.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:Z.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:Z.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:Z.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:Z.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:Z.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find((e=>"int"===e.kind||"multipleOf"===e.kind&&_.isInteger(e.value)))}get isFinite(){let e=null,t=null;for(const n of this._def.checks){if("finite"===n.kind||"int"===n.kind||"multipleOf"===n.kind)return!0;"min"===n.kind?(null===t||n.value>t)&&(t=n.value):"max"===n.kind&&(null===e||n.value<e)&&(e=n.value)}return Number.isFinite(t)&&Number.isFinite(e)}}ee.create=e=>new ee(Object.assign({checks:[],typeName:Be.ZodNumber,coerce:(null==e?void 0:e.coerce)||!1},B(e)));class te extends ${constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){this._def.coerce&&(e.data=BigInt(e.data));if(this._getType(e)!==C.bigint){const t=this._getOrReturnCtx(e);return E(t,{code:T.invalid_type,expected:C.bigint,received:t.parsedType}),N}let t;const n=new j;for(const i of this._def.checks)if("min"===i.kind){(i.inclusive?e.data<i.value:e.data<=i.value)&&(t=this._getOrReturnCtx(e,t),E(t,{code:T.too_small,type:"bigint",minimum:i.value,inclusive:i.inclusive,message:i.message}),n.dirty())}else if("max"===i.kind){(i.inclusive?e.data>i.value:e.data>=i.value)&&(t=this._getOrReturnCtx(e,t),E(t,{code:T.too_big,type:"bigint",maximum:i.value,inclusive:i.inclusive,message:i.message}),n.dirty())}else"multipleOf"===i.kind?e.data%i.value!==BigInt(0)&&(t=this._getOrReturnCtx(e,t),E(t,{code:T.not_multiple_of,multipleOf:i.value,message:i.message}),n.dirty()):_.assertNever(i);return{status:n.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,Z.toString(t))}gt(e,t){return this.setLimit("min",e,!1,Z.toString(t))}lte(e,t){return this.setLimit("max",e,!0,Z.toString(t))}lt(e,t){return this.setLimit("max",e,!1,Z.toString(t))}setLimit(e,t,n,i){return new te(Object.assign(Object.assign({},this._def),{checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:Z.toString(i)}]}))}_addCheck(e){return new te(Object.assign(Object.assign({},this._def),{checks:[...this._def.checks,e]}))}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:Z.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:Z.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:Z.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:Z.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:Z.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}te.create=e=>{var t;return new te(Object.assign({checks:[],typeName:Be.ZodBigInt,coerce:null!==(t=null==e?void 0:e.coerce)&&void 0!==t&&t},B(e)))};class ne extends ${_parse(e){this._def.coerce&&(e.data=Boolean(e.data));if(this._getType(e)!==C.boolean){const t=this._getOrReturnCtx(e);return E(t,{code:T.invalid_type,expected:C.boolean,received:t.parsedType}),N}return D(e.data)}}ne.create=e=>new ne(Object.assign({typeName:Be.ZodBoolean,coerce:(null==e?void 0:e.coerce)||!1},B(e)));class ie extends ${_parse(e){this._def.coerce&&(e.data=new Date(e.data));if(this._getType(e)!==C.date){const t=this._getOrReturnCtx(e);return E(t,{code:T.invalid_type,expected:C.date,received:t.parsedType}),N}if(isNaN(e.data.getTime())){return E(this._getOrReturnCtx(e),{code:T.invalid_date}),N}const t=new j;let n;for(const i of this._def.checks)"min"===i.kind?e.data.getTime()<i.value&&(n=this._getOrReturnCtx(e,n),E(n,{code:T.too_small,message:i.message,inclusive:!0,exact:!1,minimum:i.value,type:"date"}),t.dirty()):"max"===i.kind?e.data.getTime()>i.value&&(n=this._getOrReturnCtx(e,n),E(n,{code:T.too_big,message:i.message,inclusive:!0,exact:!1,maximum:i.value,type:"date"}),t.dirty()):_.assertNever(i);return{status:t.value,value:new Date(e.data.getTime())}}_addCheck(e){return new ie(Object.assign(Object.assign({},this._def),{checks:[...this._def.checks,e]}))}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:Z.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:Z.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return null!=e?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return null!=e?new Date(e):null}}ie.create=e=>new ie(Object.assign({checks:[],coerce:(null==e?void 0:e.coerce)||!1,typeName:Be.ZodDate},B(e)));class re extends ${_parse(e){if(this._getType(e)!==C.symbol){const t=this._getOrReturnCtx(e);return E(t,{code:T.invalid_type,expected:C.symbol,received:t.parsedType}),N}return D(e.data)}}re.create=e=>new re(Object.assign({typeName:Be.ZodSymbol},B(e)));class se extends ${_parse(e){if(this._getType(e)!==C.undefined){const t=this._getOrReturnCtx(e);return E(t,{code:T.invalid_type,expected:C.undefined,received:t.parsedType}),N}return D(e.data)}}se.create=e=>new se(Object.assign({typeName:Be.ZodUndefined},B(e)));class ae extends ${_parse(e){if(this._getType(e)!==C.null){const t=this._getOrReturnCtx(e);return E(t,{code:T.invalid_type,expected:C.null,received:t.parsedType}),N}return D(e.data)}}ae.create=e=>new ae(Object.assign({typeName:Be.ZodNull},B(e)));class oe extends ${constructor(){super(...arguments),this._any=!0}_parse(e){return D(e.data)}}oe.create=e=>new oe(Object.assign({typeName:Be.ZodAny},B(e)));class ce extends ${constructor(){super(...arguments),this._unknown=!0}_parse(e){return D(e.data)}}ce.create=e=>new ce(Object.assign({typeName:Be.ZodUnknown},B(e)));class de extends ${_parse(e){const t=this._getOrReturnCtx(e);return E(t,{code:T.invalid_type,expected:C.never,received:t.parsedType}),N}}de.create=e=>new de(Object.assign({typeName:Be.ZodNever},B(e)));class le extends ${_parse(e){if(this._getType(e)!==C.undefined){const t=this._getOrReturnCtx(e);return E(t,{code:T.invalid_type,expected:C.void,received:t.parsedType}),N}return D(e.data)}}le.create=e=>new le(Object.assign({typeName:Be.ZodVoid},B(e)));class ue extends ${_parse(e){const{ctx:t,status:n}=this._processInputParams(e),i=this._def;if(t.parsedType!==C.array)return E(t,{code:T.invalid_type,expected:C.array,received:t.parsedType}),N;if(null!==i.exactLength){const e=t.data.length>i.exactLength.value,r=t.data.length<i.exactLength.value;(e||r)&&(E(t,{code:e?T.too_big:T.too_small,minimum:r?i.exactLength.value:void 0,maximum:e?i.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:i.exactLength.message}),n.dirty())}if(null!==i.minLength&&t.data.length<i.minLength.value&&(E(t,{code:T.too_small,minimum:i.minLength.value,type:"array",inclusive:!0,exact:!1,message:i.minLength.message}),n.dirty()),null!==i.maxLength&&t.data.length>i.maxLength.value&&(E(t,{code:T.too_big,maximum:i.maxLength.value,type:"array",inclusive:!0,exact:!1,message:i.maxLength.message}),n.dirty()),t.common.async)return Promise.all([...t.data].map(((e,n)=>i.type._parseAsync(new F(t,e,t.path,n))))).then((e=>j.mergeArray(n,e)));const r=[...t.data].map(((e,n)=>i.type._parseSync(new F(t,e,t.path,n))));return j.mergeArray(n,r)}get element(){return this._def.type}min(e,t){return new ue(Object.assign(Object.assign({},this._def),{minLength:{value:e,message:Z.toString(t)}}))}max(e,t){return new ue(Object.assign(Object.assign({},this._def),{maxLength:{value:e,message:Z.toString(t)}}))}length(e,t){return new ue(Object.assign(Object.assign({},this._def),{exactLength:{value:e,message:Z.toString(t)}}))}nonempty(e){return this.min(1,e)}}function pe(e){if(e instanceof he){const t={};for(const n in e.shape){const i=e.shape[n];t[n]=je.create(pe(i))}return new he(Object.assign(Object.assign({},e._def),{shape:()=>t}))}return e instanceof ue?new ue(Object.assign(Object.assign({},e._def),{type:pe(e.element)})):e instanceof je?je.create(pe(e.unwrap())):e instanceof Ne?Ne.create(pe(e.unwrap())):e instanceof _e?_e.create(e.items.map((e=>pe(e)))):e}ue.create=(e,t)=>new ue(Object.assign({type:e,minLength:null,maxLength:null,exactLength:null,typeName:Be.ZodArray},B(t)));class he extends ${constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(null!==this._cached)return this._cached;const e=this._def.shape(),t=_.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){if(this._getType(e)!==C.object){const t=this._getOrReturnCtx(e);return E(t,{code:T.invalid_type,expected:C.object,received:t.parsedType}),N}const{status:t,ctx:n}=this._processInputParams(e),{shape:i,keys:r}=this._getCached(),s=[];if(!(this._def.catchall instanceof de&&"strip"===this._def.unknownKeys))for(const e in n.data)r.includes(e)||s.push(e);const a=[];for(const e of r){const t=i[e],r=n.data[e];a.push({key:{status:"valid",value:e},value:t._parse(new F(n,r,n.path,e)),alwaysSet:e in n.data})}if(this._def.catchall instanceof de){const e=this._def.unknownKeys;if("passthrough"===e)for(const e of s)a.push({key:{status:"valid",value:e},value:{status:"valid",value:n.data[e]}});else if("strict"===e)s.length>0&&(E(n,{code:T.unrecognized_keys,keys:s}),t.dirty());else if("strip"!==e)throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const e=this._def.catchall;for(const t of s){const i=n.data[t];a.push({key:{status:"valid",value:t},value:e._parse(new F(n,i,n.path,t)),alwaysSet:t in n.data})}}return n.common.async?Promise.resolve().then((()=>S(this,void 0,void 0,(function*(){const e=[];for(const t of a){const n=yield t.key;e.push({key:n,value:yield t.value,alwaysSet:t.alwaysSet})}return e})))).then((e=>j.mergeObjectSync(t,e))):j.mergeObjectSync(t,a)}get shape(){return this._def.shape()}strict(e){return Z.errToObj,new he(Object.assign(Object.assign(Object.assign({},this._def),{unknownKeys:"strict"}),void 0!==e?{errorMap:(t,n)=>{var i,r,s,a;const o=null!==(s=null===(r=(i=this._def).errorMap)||void 0===r?void 0:r.call(i,t,n).message)&&void 0!==s?s:n.defaultError;return"unrecognized_keys"===t.code?{message:null!==(a=Z.errToObj(e).message)&&void 0!==a?a:o}:{message:o}}}:{}))}strip(){return new he(Object.assign(Object.assign({},this._def),{unknownKeys:"strip"}))}passthrough(){return new he(Object.assign(Object.assign({},this._def),{unknownKeys:"passthrough"}))}extend(e){return new he(Object.assign(Object.assign({},this._def),{shape:()=>Object.assign(Object.assign({},this._def.shape()),e)}))}merge(e){return new he({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>Object.assign(Object.assign({},this._def.shape()),e._def.shape()),typeName:Be.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new he(Object.assign(Object.assign({},this._def),{catchall:e}))}pick(e){const t={};return _.objectKeys(e).forEach((n=>{e[n]&&this.shape[n]&&(t[n]=this.shape[n])})),new he(Object.assign(Object.assign({},this._def),{shape:()=>t}))}omit(e){const t={};return _.objectKeys(this.shape).forEach((n=>{e[n]||(t[n]=this.shape[n])})),new he(Object.assign(Object.assign({},this._def),{shape:()=>t}))}deepPartial(){return pe(this)}partial(e){const t={};return _.objectKeys(this.shape).forEach((n=>{const i=this.shape[n];e&&!e[n]?t[n]=i:t[n]=i.optional()})),new he(Object.assign(Object.assign({},this._def),{shape:()=>t}))}required(e){const t={};return _.objectKeys(this.shape).forEach((n=>{if(e&&!e[n])t[n]=this.shape[n];else{let e=this.shape[n];for(;e instanceof je;)e=e._def.innerType;t[n]=e}})),new he(Object.assign(Object.assign({},this._def),{shape:()=>t}))}keyof(){return ke(_.objectKeys(this.shape))}}he.create=(e,t)=>new he(Object.assign({shape:()=>e,unknownKeys:"strip",catchall:de.create(),typeName:Be.ZodObject},B(t))),he.strictCreate=(e,t)=>new he(Object.assign({shape:()=>e,unknownKeys:"strict",catchall:de.create(),typeName:Be.ZodObject},B(t))),he.lazycreate=(e,t)=>new he(Object.assign({shape:e,unknownKeys:"strip",catchall:de.create(),typeName:Be.ZodObject},B(t)));class me extends ${_parse(e){const{ctx:t}=this._processInputParams(e),n=this._def.options;if(t.common.async)return Promise.all(n.map((e=>S(this,void 0,void 0,(function*(){const n=Object.assign(Object.assign({},t),{common:Object.assign(Object.assign({},t.common),{issues:[]}),parent:null});return{result:yield e._parseAsync({data:t.data,path:t.path,parent:n}),ctx:n}}))))).then((function(e){for(const t of e)if("valid"===t.result.status)return t.result;for(const n of e)if("dirty"===n.result.status)return t.common.issues.push(...n.ctx.common.issues),n.result;const n=e.map((e=>new x(e.ctx.common.issues)));return E(t,{code:T.invalid_union,unionErrors:n}),N}));{let e;const i=[];for(const r of n){const n=Object.assign(Object.assign({},t),{common:Object.assign(Object.assign({},t.common),{issues:[]}),parent:null}),s=r._parseSync({data:t.data,path:t.path,parent:n});if("valid"===s.status)return s;"dirty"!==s.status||e||(e={result:s,ctx:n}),n.common.issues.length&&i.push(n.common.issues)}if(e)return t.common.issues.push(...e.ctx.common.issues),e.result;const r=i.map((e=>new x(e)));return E(t,{code:T.invalid_union,unionErrors:r}),N}}get options(){return this._def.options}}me.create=(e,t)=>new me(Object.assign({options:e,typeName:Be.ZodUnion},B(t)));const fe=e=>e instanceof Te?fe(e.schema):e instanceof Ee?fe(e.innerType()):e instanceof xe?[e.value]:e instanceof Re?e.options:e instanceof Oe?Object.keys(e.enum):e instanceof Me?fe(e._def.innerType):e instanceof se?[void 0]:e instanceof ae?[null]:null;class ge extends ${_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==C.object)return E(t,{code:T.invalid_type,expected:C.object,received:t.parsedType}),N;const n=this.discriminator,i=t.data[n],r=this.optionsMap.get(i);return r?t.common.async?r._parseAsync({data:t.data,path:t.path,parent:t}):r._parseSync({data:t.data,path:t.path,parent:t}):(E(t,{code:T.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[n]}),N)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,n){const i=new Map;for(const n of t){const t=fe(n.shape[e]);if(!t)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(const r of t){if(i.has(r))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(r)}`);i.set(r,n)}}return new ge(Object.assign({typeName:Be.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:i},B(n)))}}function ve(e,t){const n=w(e),i=w(t);if(e===t)return{valid:!0,data:e};if(n===C.object&&i===C.object){const n=_.objectKeys(t),i=_.objectKeys(e).filter((e=>-1!==n.indexOf(e))),r=Object.assign(Object.assign({},e),t);for(const n of i){const i=ve(e[n],t[n]);if(!i.valid)return{valid:!1};r[n]=i.data}return{valid:!0,data:r}}if(n===C.array&&i===C.array){if(e.length!==t.length)return{valid:!1};const n=[];for(let i=0;i<e.length;i++){const r=ve(e[i],t[i]);if(!r.valid)return{valid:!1};n.push(r.data)}return{valid:!0,data:n}}return n===C.date&&i===C.date&&+e==+t?{valid:!0,data:e}:{valid:!1}}class ye extends ${_parse(e){const{status:t,ctx:n}=this._processInputParams(e),i=(e,i)=>{if(I(e)||I(i))return N;const r=ve(e.value,i.value);return r.valid?((A(e)||A(i))&&t.dirty(),{status:t.value,value:r.data}):(E(n,{code:T.invalid_intersection_types}),N)};return n.common.async?Promise.all([this._def.left._parseAsync({data:n.data,path:n.path,parent:n}),this._def.right._parseAsync({data:n.data,path:n.path,parent:n})]).then((([e,t])=>i(e,t))):i(this._def.left._parseSync({data:n.data,path:n.path,parent:n}),this._def.right._parseSync({data:n.data,path:n.path,parent:n}))}}ye.create=(e,t,n)=>new ye(Object.assign({left:e,right:t,typeName:Be.ZodIntersection},B(n)));class _e extends ${_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==C.array)return E(n,{code:T.invalid_type,expected:C.array,received:n.parsedType}),N;if(n.data.length<this._def.items.length)return E(n,{code:T.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),N;!this._def.rest&&n.data.length>this._def.items.length&&(E(n,{code:T.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const i=[...n.data].map(((e,t)=>{const i=this._def.items[t]||this._def.rest;return i?i._parse(new F(n,e,n.path,t)):null})).filter((e=>!!e));return n.common.async?Promise.all(i).then((e=>j.mergeArray(t,e))):j.mergeArray(t,i)}get items(){return this._def.items}rest(e){return new _e(Object.assign(Object.assign({},this._def),{rest:e}))}}_e.create=(e,t)=>{if(!Array.isArray(e))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new _e(Object.assign({items:e,typeName:Be.ZodTuple,rest:null},B(t)))};class be extends ${get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==C.object)return E(n,{code:T.invalid_type,expected:C.object,received:n.parsedType}),N;const i=[],r=this._def.keyType,s=this._def.valueType;for(const e in n.data)i.push({key:r._parse(new F(n,e,n.path,e)),value:s._parse(new F(n,n.data[e],n.path,e))});return n.common.async?j.mergeObjectAsync(t,i):j.mergeObjectSync(t,i)}get element(){return this._def.valueType}static create(e,t,n){return new be(t instanceof $?Object.assign({keyType:e,valueType:t,typeName:Be.ZodRecord},B(n)):Object.assign({keyType:Y.create(),valueType:e,typeName:Be.ZodRecord},B(t)))}}class Se extends ${get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==C.map)return E(n,{code:T.invalid_type,expected:C.map,received:n.parsedType}),N;const i=this._def.keyType,r=this._def.valueType,s=[...n.data.entries()].map((([e,t],s)=>({key:i._parse(new F(n,e,n.path,[s,"key"])),value:r._parse(new F(n,t,n.path,[s,"value"]))})));if(n.common.async){const e=new Map;return Promise.resolve().then((()=>S(this,void 0,void 0,(function*(){for(const n of s){const i=yield n.key,r=yield n.value;if("aborted"===i.status||"aborted"===r.status)return N;"dirty"!==i.status&&"dirty"!==r.status||t.dirty(),e.set(i.value,r.value)}return{status:t.value,value:e}}))))}{const e=new Map;for(const n of s){const i=n.key,r=n.value;if("aborted"===i.status||"aborted"===r.status)return N;"dirty"!==i.status&&"dirty"!==r.status||t.dirty(),e.set(i.value,r.value)}return{status:t.value,value:e}}}}Se.create=(e,t,n)=>new Se(Object.assign({valueType:t,keyType:e,typeName:Be.ZodMap},B(n)));class Ce extends ${_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==C.set)return E(n,{code:T.invalid_type,expected:C.set,received:n.parsedType}),N;const i=this._def;null!==i.minSize&&n.data.size<i.minSize.value&&(E(n,{code:T.too_small,minimum:i.minSize.value,type:"set",inclusive:!0,exact:!1,message:i.minSize.message}),t.dirty()),null!==i.maxSize&&n.data.size>i.maxSize.value&&(E(n,{code:T.too_big,maximum:i.maxSize.value,type:"set",inclusive:!0,exact:!1,message:i.maxSize.message}),t.dirty());const r=this._def.valueType;function s(e){const n=new Set;for(const i of e){if("aborted"===i.status)return N;"dirty"===i.status&&t.dirty(),n.add(i.value)}return{status:t.value,value:n}}const a=[...n.data.values()].map(((e,t)=>r._parse(new F(n,e,n.path,t))));return n.common.async?Promise.all(a).then((e=>s(e))):s(a)}min(e,t){return new Ce(Object.assign(Object.assign({},this._def),{minSize:{value:e,message:Z.toString(t)}}))}max(e,t){return new Ce(Object.assign(Object.assign({},this._def),{maxSize:{value:e,message:Z.toString(t)}}))}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}Ce.create=(e,t)=>new Ce(Object.assign({valueType:e,minSize:null,maxSize:null,typeName:Be.ZodSet},B(t)));class we extends ${constructor(){super(...arguments),this.validate=this.implement}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==C.function)return E(t,{code:T.invalid_type,expected:C.function,received:t.parsedType}),N;function n(e,n){return P({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,O(),k].filter((e=>!!e)),issueData:{code:T.invalid_arguments,argumentsError:n}})}function i(e,n){return P({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,O(),k].filter((e=>!!e)),issueData:{code:T.invalid_return_type,returnTypeError:n}})}const r={errorMap:t.common.contextualErrorMap},s=t.data;if(this._def.returns instanceof Pe){const e=this;return D((function(...t){return S(this,void 0,void 0,(function*(){const a=new x([]),o=yield e._def.args.parseAsync(t,r).catch((e=>{throw a.addIssue(n(t,e)),a})),c=yield Reflect.apply(s,this,o);return yield e._def.returns._def.type.parseAsync(c,r).catch((e=>{throw a.addIssue(i(c,e)),a}))}))}))}{const e=this;return D((function(...t){const a=e._def.args.safeParse(t,r);if(!a.success)throw new x([n(t,a.error)]);const o=Reflect.apply(s,this,a.data),c=e._def.returns.safeParse(o,r);if(!c.success)throw new x([i(o,c.error)]);return c.data}))}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new we(Object.assign(Object.assign({},this._def),{args:_e.create(e).rest(ce.create())}))}returns(e){return new we(Object.assign(Object.assign({},this._def),{returns:e}))}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,n){return new we(Object.assign({args:e||_e.create([]).rest(ce.create()),returns:t||ce.create(),typeName:Be.ZodFunction},B(n)))}}class Te extends ${get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}Te.create=(e,t)=>new Te(Object.assign({getter:e,typeName:Be.ZodLazy},B(t)));class xe extends ${_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return E(t,{received:t.data,code:T.invalid_literal,expected:this._def.value}),N}return{status:"valid",value:e.data}}get value(){return this._def.value}}function ke(e,t){return new Re(Object.assign({values:e,typeName:Be.ZodEnum},B(t)))}xe.create=(e,t)=>new xe(Object.assign({value:e,typeName:Be.ZodLiteral},B(t)));class Re extends ${_parse(e){if("string"!=typeof e.data){const t=this._getOrReturnCtx(e),n=this._def.values;return E(t,{expected:_.joinValues(n),received:t.parsedType,code:T.invalid_type}),N}if(-1===this._def.values.indexOf(e.data)){const t=this._getOrReturnCtx(e),n=this._def.values;return E(t,{received:t.data,code:T.invalid_enum_value,options:n}),N}return D(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e){return Re.create(e)}exclude(e){return Re.create(this.options.filter((t=>!e.includes(t))))}}Re.create=ke;class Oe extends ${_parse(e){const t=_.getValidEnumValues(this._def.values),n=this._getOrReturnCtx(e);if(n.parsedType!==C.string&&n.parsedType!==C.number){const e=_.objectValues(t);return E(n,{expected:_.joinValues(e),received:n.parsedType,code:T.invalid_type}),N}if(-1===t.indexOf(e.data)){const e=_.objectValues(t);return E(n,{received:n.data,code:T.invalid_enum_value,options:e}),N}return D(e.data)}get enum(){return this._def.values}}Oe.create=(e,t)=>new Oe(Object.assign({values:e,typeName:Be.ZodNativeEnum},B(t)));class Pe extends ${unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==C.promise&&!1===t.common.async)return E(t,{code:T.invalid_type,expected:C.promise,received:t.parsedType}),N;const n=t.parsedType===C.promise?t.data:Promise.resolve(t.data);return D(n.then((e=>this._def.type.parseAsync(e,{path:t.path,errorMap:t.common.contextualErrorMap}))))}}Pe.create=(e,t)=>new Pe(Object.assign({type:e,typeName:Be.ZodPromise},B(t)));class Ee extends ${innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===Be.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:n}=this._processInputParams(e),i=this._def.effect||null,r={addIssue:e=>{E(n,e),e.fatal?t.abort():t.dirty()},get path(){return n.path}};if(r.addIssue=r.addIssue.bind(r),"preprocess"===i.type){const e=i.transform(n.data,r);return n.common.issues.length?{status:"dirty",value:n.data}:n.common.async?Promise.resolve(e).then((e=>this._def.schema._parseAsync({data:e,path:n.path,parent:n}))):this._def.schema._parseSync({data:e,path:n.path,parent:n})}if("refinement"===i.type){const e=e=>{const t=i.refinement(e,r);if(n.common.async)return Promise.resolve(t);if(t instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return e};if(!1===n.common.async){const i=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});return"aborted"===i.status?N:("dirty"===i.status&&t.dirty(),e(i.value),{status:t.value,value:i.value})}return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then((n=>"aborted"===n.status?N:("dirty"===n.status&&t.dirty(),e(n.value).then((()=>({status:t.value,value:n.value}))))))}if("transform"===i.type){if(!1===n.common.async){const e=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});if(!L(e))return e;const s=i.transform(e.value,r);if(s instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:s}}return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then((e=>L(e)?Promise.resolve(i.transform(e.value,r)).then((e=>({status:t.value,value:e}))):e))}_.assertNever(i)}}Ee.create=(e,t,n)=>new Ee(Object.assign({schema:e,typeName:Be.ZodEffects,effect:t},B(n))),Ee.createWithPreprocess=(e,t,n)=>new Ee(Object.assign({schema:t,effect:{type:"preprocess",transform:e},typeName:Be.ZodEffects},B(n)));class je extends ${_parse(e){return this._getType(e)===C.undefined?D(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}je.create=(e,t)=>new je(Object.assign({innerType:e,typeName:Be.ZodOptional},B(t)));class Ne extends ${_parse(e){return this._getType(e)===C.null?D(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Ne.create=(e,t)=>new Ne(Object.assign({innerType:e,typeName:Be.ZodNullable},B(t)));class Me extends ${_parse(e){const{ctx:t}=this._processInputParams(e);let n=t.data;return t.parsedType===C.undefined&&(n=this._def.defaultValue()),this._def.innerType._parse({data:n,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}Me.create=(e,t)=>new Me(Object.assign({innerType:e,typeName:Be.ZodDefault,defaultValue:"function"==typeof t.default?t.default:()=>t.default},B(t)));class De extends ${_parse(e){const{ctx:t}=this._processInputParams(e),n=Object.assign(Object.assign({},t),{common:Object.assign(Object.assign({},t.common),{issues:[]})}),i=this._def.innerType._parse({data:n.data,path:n.path,parent:Object.assign({},n)});return V(i)?i.then((e=>({status:"valid",value:"valid"===e.status?e.value:this._def.catchValue({get error(){return new x(n.common.issues)},input:n.data})}))):{status:"valid",value:"valid"===i.status?i.value:this._def.catchValue({get error(){return new x(n.common.issues)},input:n.data})}}removeCatch(){return this._def.innerType}}De.create=(e,t)=>new De(Object.assign({innerType:e,typeName:Be.ZodCatch,catchValue:"function"==typeof t.catch?t.catch:()=>t.catch},B(t)));class Ie extends ${_parse(e){if(this._getType(e)!==C.nan){const t=this._getOrReturnCtx(e);return E(t,{code:T.invalid_type,expected:C.nan,received:t.parsedType}),N}return{status:"valid",value:e.data}}}Ie.create=e=>new Ie(Object.assign({typeName:Be.ZodNaN},B(e)));const Ae=Symbol("zod_brand");class Le extends ${_parse(e){const{ctx:t}=this._processInputParams(e),n=t.data;return this._def.type._parse({data:n,path:t.path,parent:t})}unwrap(){return this._def.type}}class Ve extends ${_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.common.async){return(()=>S(this,void 0,void 0,(function*(){const e=yield this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return"aborted"===e.status?N:"dirty"===e.status?(t.dirty(),M(e.value)):this._def.out._parseAsync({data:e.value,path:n.path,parent:n})})))()}{const e=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return"aborted"===e.status?N:"dirty"===e.status?(t.dirty(),{status:"dirty",value:e.value}):this._def.out._parseSync({data:e.value,path:n.path,parent:n})}}static create(e,t){return new Ve({in:e,out:t,typeName:Be.ZodPipeline})}}class Ze extends ${_parse(e){const t=this._def.innerType._parse(e);return L(t)&&(t.value=Object.freeze(t.value)),t}}Ze.create=(e,t)=>new Ze(Object.assign({innerType:e,typeName:Be.ZodReadonly},B(t)));const Fe=(e,t={},n)=>e?oe.create().superRefine(((i,r)=>{var s,a;if(!e(i)){const e="function"==typeof t?t(i):"string"==typeof t?{message:t}:t,o=null===(a=null!==(s=e.fatal)&&void 0!==s?s:n)||void 0===a||a,c="string"==typeof e?{message:e}:e;r.addIssue(Object.assign(Object.assign({code:"custom"},c),{fatal:o}))}})):oe.create(),Ue={object:he.lazycreate};var Be;!function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline",e.ZodReadonly="ZodReadonly"}(Be||(Be={}));const $e=Y.create,ze=ee.create,qe=Ie.create,Ge=te.create,We=ne.create,Ke=ie.create,Je=re.create,He=se.create,Xe=ae.create,Ye=oe.create,Qe=ce.create,et=de.create,tt=le.create,nt=ue.create,it=he.create,rt=he.strictCreate,st=me.create,at=ge.create,ot=ye.create,ct=_e.create,dt=be.create,lt=Se.create,ut=Ce.create,pt=we.create,ht=Te.create,mt=xe.create,ft=Re.create,gt=Oe.create,vt=Pe.create,yt=Ee.create,_t=je.create,bt=Ne.create,St=Ee.createWithPreprocess,Ct=Ve.create,wt={string:e=>Y.create(Object.assign(Object.assign({},e),{coerce:!0})),number:e=>ee.create(Object.assign(Object.assign({},e),{coerce:!0})),boolean:e=>ne.create(Object.assign(Object.assign({},e),{coerce:!0})),bigint:e=>te.create(Object.assign(Object.assign({},e),{coerce:!0})),date:e=>ie.create(Object.assign(Object.assign({},e),{coerce:!0}))},Tt=N;var xt=Object.freeze({__proto__:null,defaultErrorMap:k,setErrorMap:function(e){R=e},getErrorMap:O,makeIssue:P,EMPTY_PATH:[],addIssueToContext:E,ParseStatus:j,INVALID:N,DIRTY:M,OK:D,isAborted:I,isDirty:A,isValid:L,isAsync:V,get util(){return _},get objectUtil(){return b},ZodParsedType:C,getParsedType:w,ZodType:$,ZodString:Y,ZodNumber:ee,ZodBigInt:te,ZodBoolean:ne,ZodDate:ie,ZodSymbol:re,ZodUndefined:se,ZodNull:ae,ZodAny:oe,ZodUnknown:ce,ZodNever:de,ZodVoid:le,ZodArray:ue,ZodObject:he,ZodUnion:me,ZodDiscriminatedUnion:ge,ZodIntersection:ye,ZodTuple:_e,ZodRecord:be,ZodMap:Se,ZodSet:Ce,ZodFunction:we,ZodLazy:Te,ZodLiteral:xe,ZodEnum:Re,ZodNativeEnum:Oe,ZodPromise:Pe,ZodEffects:Ee,ZodTransformer:Ee,ZodOptional:je,ZodNullable:Ne,ZodDefault:Me,ZodCatch:De,ZodNaN:Ie,BRAND:Ae,ZodBranded:Le,ZodPipeline:Ve,ZodReadonly:Ze,custom:Fe,Schema:$,ZodSchema:$,late:Ue,get ZodFirstPartyTypeKind(){return Be},coerce:wt,any:Ye,array:nt,bigint:Ge,boolean:We,date:Ke,discriminatedUnion:at,effect:yt,enum:ft,function:pt,instanceof:(e,t={message:`Input not instance of ${e.name}`})=>Fe((t=>t instanceof e),t),intersection:ot,lazy:ht,literal:mt,map:lt,nan:qe,nativeEnum:gt,never:et,null:Xe,nullable:bt,number:ze,object:it,oboolean:()=>We().optional(),onumber:()=>ze().optional(),optional:_t,ostring:()=>$e().optional(),pipeline:Ct,preprocess:St,promise:vt,record:dt,set:ut,strictObject:rt,string:$e,symbol:Je,transformer:yt,tuple:ct,undefined:He,union:st,unknown:Qe,void:tt,NEVER:Tt,ZodIssueCode:T,quotelessJson:e=>JSON.stringify(e,null,2).replace(/"([^"]+)":/g,"$1:"),ZodError:x});class kt extends Error{get issues(){return this._issues.map((e=>({message:e.message,path:e.path})))}constructor(e,t,n){super(`${e}: ${Rt(t)}`),this._issues=t,this._innerError=n,this.name="ConfigValidationError",this._code=7e3}toString(){return`${super.toString()}: ${Rt(this._issues)}`}}function Rt(e){return e.map((e=>`'${e.message} at "config.${function(e){let t="";for(const n of e)t+=`${n}.`;return t.substring(0,t.length-1)}(e.path)}"'`)).join(", ")}const{cloneSerializable:Ot}=e,Pt={auth:null,streamName:null,serverUrl:"https://bintu-webrtc.nanocosmos.de/p/webrtc",ingestUrl:"rtmp://bintu-stream.nanocosmos.de:1935/live",inputCfg:{mediaStream:null,mediaStreamCfg:null,muted:{audio:!1,video:!1},broadcastCfg:null},previewVideoElId:null,metrics:{accountId:"webrtc-client-app",accountKey:"ncfl6c6it9zu3kk7"},reconnect:{minDelaySec:2,maxDelaySec:15,maxRetries:10}};function Et(){return Ot(Pt)}const{isEmpty:jt,isObject:Nt,removeTrailingSlash:Mt}=e;const Dt=Et(),It=xt.object({autoGainControl:xt.any().optional(),echoCancellation:xt.any().optional(),noiseSuppression:xt.any().optional(),channelCount:xt.any().optional()}).optional(),At=xt.object({resolution:xt.tuple([xt.number(),xt.number()]).optional(),maxFramerate:xt.number().optional(),audioVideoOnly:xt.union([xt.literal("audio"),xt.literal("video")]).optional(),audioConstraints:It,audioDeviceId:xt.string().min(1).optional(),videoDeviceId:xt.string().min(1).optional()}).nullish().transform((e=>!e||jt(e)?Dt.inputCfg.mediaStreamCfg:e)),Lt=xt.object({transcodeAudioBitrateBps:xt.number().optional(),maxVideoBitrateBps:xt.number().optional(),maxAudioBitrateBps:xt.number().optional(),maxEncodingFramerate:xt.number().optional()}).nullish().transform((e=>!e||jt(e)?Dt.inputCfg.broadcastCfg:e)),Vt=xt.object({audio:xt.boolean().optional(),video:xt.boolean().optional()}).optional(),Zt=xt.object({token:xt.string()}).nullish().transform((e=>null!=e?e:Dt.auth)),Ft=xt.object({mediaStream:xt.unknown().refine((e=>e instanceof MediaStream),"mediaStream should be instance of MediaStream").nullish().transform((e=>null!=e?e:Dt.inputCfg.mediaStream)),mediaStreamCfg:At,muted:Vt,broadcastCfg:Lt}).nullish().transform((e=>null!=e?e:Dt.inputCfg)),Ut=xt.object({accountId:xt.string(),accountKey:xt.string()}).nullish().transform((e=>null!=e?e:Dt.metrics)),Bt=xt.preprocess((e=>Nt(e)&&jt(e)?null:e),xt.object({minDelaySec:xt.number().min(1).optional().default(Dt.reconnect.minDelaySec),maxDelaySec:xt.number().min(1).optional().default(Dt.reconnect.maxDelaySec),maxRetries:xt.number().min(1).optional().default(Dt.reconnect.maxRetries)}).optional().nullable().transform((e=>e||null)).refine((e=>null===e||e.minDelaySec<=e.maxDelaySec),"minDelaySec value should be equal or lower than maxDelaySec value").or(xt.boolean().transform((e=>!0===e?Dt.reconnect:null)))),$t=xt.object({serverUrl:xt.string().url().optional().default(Dt.serverUrl).transform((e=>Mt(e))),auth:Zt,streamName:xt.string().min(1).optional().nullable().default(Dt.streamName),ingestUrl:xt.string().url().optional().default(Dt.ingestUrl),inputCfg:Ft,previewVideoElId:xt.string().min(1).optional().nullable().default(Dt.previewVideoElId),metrics:Ut,reconnect:Bt}).strict().refine((e=>!!e.auth||!!e.streamName),"Either auth or streamName should be passed");function zt(e,t){const n=t.safeParse(e);if(!n.success)throw new kt("Config parsing error",n.error.issues);return n.data}class qt extends Error{constructor(e,t,n,i={}){super(n),this.name=e,this.code=t,this.metadata=i}toJSON(){return{name:this.name,code:this.code,message:this.message,metadata:this.metadata}}}class Gt{static StreamError(e,t){return new qt("StreamError",2e3,e,t)}static GeneralError(e,t){return new qt("GeneralError",4e3,e,t)}static ServerRequestError(e,t){return new qt("ServerRequestError",10001,e,t)}}var Wt=function(e,t,n,i){return new(n||(n=Promise))((function(r,s){function a(e){try{c(i.next(e))}catch(e){s(e)}}function o(e){try{c(i.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}c((i=i.apply(e,t||[])).next())}))};class Kt{static isSupported(e){const t=null===navigator||void 0===navigator?void 0:navigator.mediaDevices;return!(!t||!t[e])}static assertSupported(e){if(!Kt.isSupported(e))throw new Error("MediaDevices API method not supported: "+e)}static getSupportedConstraints(){return Kt.assertSupported("getSupportedConstraints"),navigator.mediaDevices.getSupportedConstraints()}static getDevicePermissions(e,t){return Wt(this,void 0,void 0,(function*(){const n=e.filter((e=>"videoinput"===e.kind||"audioinput"===e.kind)).map((e=>{let t;switch(e.kind){case"videoinput":t="camera";break;case"audioinput":t="microphone";break;default:throw new Error("device.kind must be videoinput or audioinput")}return Object.assign({name:t},e)})),i=[];for(const e of n)yield navigator.permissions.query(e).then((t=>{i.push(Object.assign(Object.assign({},e),{status:t.state}))})).catch((e=>{t&&t(e)}));return i}))}static getAvailableMediaDevices(){return Kt.assertSupported("enumerateDevices"),navigator.mediaDevices.enumerateDevices()}static filterDevices(e,t=["audioinput","videoinput"],n,i){return e.filter((e=>(!n||n===e.groupId)&&((!i||i===e.deviceId)&&t.includes(e.kind))))}}var Jt=function(e,t,n,i){return new(n||(n=Promise))((function(r,s){function a(e){try{c(i.next(e))}catch(e){s(e)}}function o(e){try{c(i.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}c((i=i.apply(e,t||[])).next())}))};const{assertSupported:Ht}=Kt;class Xt{static createStream(e={audio:!0,video:!0}){return Jt(this,void 0,void 0,(function*(){return Ht("getUserMedia"),yield navigator.mediaDevices.getUserMedia(e)}))}static disposeStream(e){e.getTracks().forEach((e=>{e.stop()}))}static hasAudio(e){var t;return!!(null===(t=e.getAudioTracks())||void 0===t?void 0:t.length)}static hasVideo(e){var t;return!!(null===(t=e.getVideoTracks())||void 0===t?void 0:t.length)}static getAudioTrackSettings(e){return Xt.hasAudio(e)?e.getAudioTracks()[0].getSettings():null}static getVideoTrackSettings(e){return Xt.hasVideo(e)?null==e?void 0:e.getVideoTracks()[0].getSettings():null}static getSyntheticMediaStreamConstraints(e){let t=!1,n=!1;return Xt.hasAudio(e)&&(t=e.getAudioTracks()[0].getConstraints()),Xt.hasVideo(e)&&(n=e.getVideoTracks()[0].getConstraints()),{audio:t,video:n}}}class Yt{static mergeConstraints(e,t){return e&&t?Object.assign(Object.assign({},e),t):e||t}static getIceCandidateType(e){return e.split(" ")[7]}static removePayloadTypeFromMline(e,t){const n=e.split(" ");for(let e=0;e<n.length;++e)n[e]===t&&n.splice(e,1);return n.join(" ")}static findLine(e,t,n){return Yt.findLineInRange(e,0,-1,t,n)}static findLineInRange(e,t,n,i,r,s=!0){if(s){const s=-1!==n?n:e.length;for(let n=t;n<s;++n)if(0===e[n].indexOf(i)&&(!r||-1!==e[n].toLowerCase().indexOf(r.toLowerCase())))return n}else{for(let n=-1!==t?t:e.length-1;n>=0;--n)if(0===e[n].indexOf(i)&&(!r||-1!==e[n].toLowerCase().indexOf(r.toLowerCase())))return n}return null}}class Qt{static removeCodecByName(e,t){const n=Yt.findLine(e,"a=rtpmap",t);if(null===n)return e;const i=Qt.getCodecPayloadTypeFromLine(e[n]);if(e.splice(n,1),!i)throw new Error(`Could not determine payload-type for codec '${t}' in SDP lines:\n${JSON.stringify(e)}`);const r=Yt.findLine(e,"m=","video");return null===r||(e[r]=Yt.removePayloadTypeFromMline(e[r],i)),e}static removeCodecByPayloadType(e,t){const n=Yt.findLine(e,"a=rtpmap",t.toString());if(null===n)return e;e.splice(n,1);const i=Yt.findLine(e,"m=","video");return null===i||(e[i]=Yt.removePayloadTypeFromMline(e[i],t)),e}static getCodecPayloadTypeFromLine(e){const t=e.match(Qt.patternCodec);return t&&2===t.length?t[1]:null}static preferCodec(e,t){const n=Qt.splitLines(e);if(!n.videoCodecNumbers)return e;if("vp8"===t&&n.vp8LineNumber===n.videoCodecNumbers[0])return e;if("vp9"===t&&n.vp9LineNumber===n.videoCodecNumbers[0])return e;if("h264"===t&&n.h264LineNumber===n.videoCodecNumbers[0])return e;return Qt.preferVideoCodec(e,t,n)}static preferVideoCodec(e,t,n,i=!1){let r="";if("vp8"===t){if(!n.vp8LineNumber)return e;r=n.vp8LineNumber}if("vp9"===t){if(!n.vp9LineNumber)return e;r=n.vp9LineNumber}if("h264"===t){if(!n.h264LineNumber)return e;r=n.h264LineNumber}let s=n.videoCodecNumbersOriginal.split("SAVPF")[0]+"SAVPF ",a=[r];i&&(a=[]),n.videoCodecNumbers.forEach((function(e){e!==r&&a.push(e)})),s+=a.join(" ");return e.replace(n.videoCodecNumbersOriginal,s)}static splitLines(e){const t=[];let n="",i="",r="",s="";return e.split("\n").forEach((e=>{0===e.indexOf("m=video")&&e.split("SAVPF")[1].split(" ").forEach((function(i){(i=i.trim())&&i.length&&(null==t||t.push(i),n=e)})),-1===e.indexOf("VP8/90000")||i||(i=e.replace("a=rtpmap:","").split(" ")[0]),-1===e.indexOf("VP9/90000")||r||(r=e.replace("a=rtpmap:","").split(" ")[0]),-1===e.indexOf("H264/90000")||s||(s=e.replace("a=rtpmap:","").split(" ")[0])})),{videoCodecNumbers:t,videoCodecNumbersOriginal:n,vp8LineNumber:i,vp9LineNumber:r,h264LineNumber:s}}static removeVPX(e){const t=Qt.splitLines(e);let n;return n=Qt.preferVideoCodec(e,"vp9",t,!0),n=Qt.preferVideoCodec(n,"vp8",t,!0),n}static disableNACK(e){if(!e||"string"!=typeof e)throw"Invalid arguments.";let t;return t=e.replace("a=rtcp-fb:126 nack\r\n",""),t=t.replace("a=rtcp-fb:126 nack pli\r\n","a=rtcp-fb:126 pli\r\n"),t=t.replace("a=rtcp-fb:97 nack\r\n",""),t=t.replace("a=rtcp-fb:97 nack pli\r\n","a=rtcp-fb:97 pli\r\n"),t}static prioritize(e,t){if(t&&t.getSenders&&t.getSenders().length){if(!e||"string"!=typeof e)throw"Invalid arguments.";t.getSenders().forEach((function(t){const n=t.getParameters();for(let t=0;t<n.codecs.length;t++)if(n.codecs[t].mimeType==e){n.codecs.unshift(...n.codecs.splice(t,1));break}t.setParameters(n)}))}}static removeNonG722(e){return e.replace(/m=audio ([0-9]+) RTP\/SAVPF ([0-9 ]*)/g,"m=audio $1 RTP/SAVPF 9")}static findLine(e,t,n){return Yt.findLineInRange(e,0,-1,t,n)}static findLineInRange(e,t,n,i,r){const s=-1!==n?n:e.length;for(let n=t;n<s;++n)if(0===e[n].indexOf(i)&&(!r||-1!==e[n].toLowerCase().indexOf(r.toLowerCase())))return n;return null}static getCodecPayloadType(e){const t=new RegExp("a=rtpmap:(\\d+) \\w+\\/\\d+"),n=e.match(t);return n&&2===n.length?n[1]:null}static setVideoBitrates(e,t){let n=e,i=Object.assign({},t);i=i||{};const r=i.min,s=i.max,a=n.split("\r\n"),o=Yt.findLine(a,"a=rtpmap","VP8/90000");let c;if(o&&(c=Qt.getCodecPayloadType(a[o])),!c)return n;const d=Yt.findLine(a,"a=rtpmap","rtx/90000");if(!d)return n;const l=Qt.getCodecPayloadType(a[d]),u=Yt.findLine(a,"a=fmtp:"+l);if(null!==u){let e="\r\n";e+="a=fmtp:"+c+" x-google-min-bitrate="+(r||"228")+"; x-google-max-bitrate="+(s||"228"),a[u]=a[u].concat(e),n=a.join("\r\n")}return n}static setOpusAttributes(e,t){let n=e,i=Object.assign({},t);i=i||{};const r=n.split("\r\n"),s=Yt.findLine(r,"a=rtpmap","opus/48000");let a;if(s&&(a=Qt.getCodecPayloadType(r[s])),!a)return n;const o=Yt.findLine(r,"a=fmtp:"+a.toString());if(null===o)return n;let c="";return c+="; stereo="+(void 0!==i.stereo?i.stereo:"1"),c+="; sprop-stereo="+(void 0!==i["sprop-stereo"]?i["sprop-stereo"]:"1"),void 0!==i.maxaveragebitrate&&(c+="; maxaveragebitrate="+(i.maxaveragebitrate||1048576)),void 0!==i.maxplaybackrate&&(c+="; maxplaybackrate="+(i.maxplaybackrate||1048576)),void 0!==i.cbr&&(c+="; cbr="+(void 0!==i.cbr?i.cbr:"1")),void 0!==i.useinbandfec&&(c+="; useinbandfec="+i.useinbandfec),void 0!==i.usedtx&&(c+="; usedtx="+i.usedtx),void 0!==i.maxptime&&(c+="\r\na=maxptime:"+i.maxptime),r[o]=r[o].concat(c),n=r.join("\r\n"),n}static preferVP9(e){return Qt.preferCodec(e,"vp9")}}Qt.patternCodec=new RegExp("a=rtpmap:(\\d+) [a-zA-Z0-9-]+\\/\\d+");const{maxBy:en,meanBy:tn,minBy:nn,orZero:rn,roundToPrecision:sn}=e;const an={"candidate-pair":{lastPacketSentTimestamp:{renameTo:"lastPacketSentTimestamp"}}},on={"remote-inbound-rtp":{roundTripTime:{renameTo:"rtt",multiplier:1e3,getMinMaxAvg:!0,aggregate:!0},jitter:{renameTo:"jitter",multiplier:1e3,getMinMaxAvg:!0,aggregate:!0},packetsLost:{renameTo:"packetsLost",getSerialDiff:!0,getMinMaxAvg:!0,aggregate:!0},fractionLost:{renameTo:"fractionLost"}},"outbound-rtp":{codecId:{renameTo:"codecId",aggregate:!1},packetsSent:{renameTo:"packetsSent",getSerialDiff:!0,getMinMaxAvg:!0,aggregate:!0},bytesSent:{renameTo:"bitrate",multiplier:.008,getSerialDiff:!0,getMinMaxAvg:!0,aggregate:!0}}},cn={"remote-inbound-rtp":{roundTripTime:{renameTo:"rtt",multiplier:1e3,getMinMaxAvg:!0,aggregate:!0},jitter:{renameTo:"jitter",multiplier:1e3,getMinMaxAvg:!0,aggregate:!0},packetsLost:{renameTo:"packetsLost",getSerialDiff:!0,getMinMaxAvg:!0,aggregate:!0},fractionLost:{renameTo:"fractionLost"}},"outbound-rtp":{framesEncoded:{renameTo:"framesEncoded",getSerialDiff:!1,getMinMaxAvg:!1,aggregate:!1},codecId:{renameTo:"codecId",aggregate:!1},encoderImplementation:{renameTo:"encoderImplementation",aggregate:!1},qualityLimitationReason:{renameTo:"qualityLimitationReason",aggregate:!1},qualityLimitationDurations:{renameTo:"qualityLimitationDurations"},qualityLimitationResolutionChanges:{renameTo:"qualityLimitationResolutionChanges"},totalPacketSendDelay:{renameTo:"totalPacketSendDelay",getSerialDiff:!0,getMinMaxAvg:!0,aggregate:!0},packetsSent:{renameTo:"packetsSent",getSerialDiff:!0,getMinMaxAvg:!0,aggregate:!0},bytesSent:{renameTo:"bitrate",multiplier:.008,getSerialDiff:!0,getMinMaxAvg:!0,aggregate:!0},nackCount:{renameTo:"nackCount",getSerialDiff:!0,getMinMaxAvg:!0,aggregate:!0},firCount:{renameTo:"firCount"},pliCount:{renameTo:"pliCount"},qpSum:{renameTo:"qpSum"},framesSent:{renameTo:"framesSent",getSerialDiff:!0,aggregate:!0,getMinMaxAvg:!0},retransmittedPacketsSent:{renameTo:"retransmittedPacketsSent"},retransmittedBytesSent:{renameTo:"retransmittedBytesSent"},fecPacketsSent:{renameTo:"fecPacketsSent"},keyFramesEncoded:{renameTo:"keyFramesEncoded"},frameWidth:{renameTo:"width"},frameHeight:{renameTo:"height"},totalEncodeTime:{renameTo:"totalEncodeTime"}}};var dn=function(e,t,n,i){return new(n||(n=Promise))((function(r,s){function a(e){try{c(i.next(e))}catch(e){s(e)}}function o(e){try{c(i.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}c((i=i.apply(e,t||[])).next())}))};const{isUndefined:ln,oneBitQuantize:un,orZero:pn,roundToPrecision:hn}=e,mn=performance;class fn{constructor(e){this._config=e,this._videoStatFilters=cn,this._audioStatfilters=on,this._connectionFilters=an,this._selectors=[],this._collectIntervalTimer=null,this._collectedAudioStats={},this._collectedVideoStats={},this._collectedCustomStats={},this._firstReportTimestamp=null,this._lastVideoWidth=null,this._lastVideoHeight=null}addSelector(e){this._selectors.push(e)}isRunning(){return null!==this._collectIntervalTimer}start(e){if(this.isRunning())throw new Error("Stats collection task already running");this._collectIntervalTimer=window.setInterval((()=>dn(this,void 0,void 0,(function*(){try{yield this._getStats(),this._firstReportTimestamp||(this._firstReportTimestamp=this._getTimestamp())}catch(t){if(!e)throw t;e(t)}}))),this._config.collectPeriodMs)}stop(){this.isRunning()&&(window.clearInterval(this._collectIntervalTimer),this._collectIntervalTimer=null,this._collectedAudioStats={},this._collectedVideoStats={},this._firstReportTimestamp=null)}reset(){this.stop(),this._selectors=[]}pullData(){const e={audio:{},video:{},connection:{}};return this._collectValuesFromCollection(this._collectedAudioStats,e.audio),this._collectValuesFromCollection(this._collectedVideoStats,e.video),this._collectValuesFromCollection(this._collectedCustomStats,e.connection),e}_collectValuesFromCollection(e,t){var n,i,r;for(const s in e){const a=e[s];if(!a)continue;let o=null===(i=null===(n=a.values)||void 0===n?void 0:n.at(-1))||void 0===i?void 0:i.value;null!=o||(o=null===(r=a.lastValue)||void 0===r?void 0:r.value);const{min:c,max:d,avg:l}=a;t[s]={value:o,min:c,max:d,avg:l}}}_getStats(){var e,t;return dn(this,void 0,void 0,(function*(){let n;for(const i of this._selectors)if(n=yield i.getStats(),"audio"===(null===(e=i.track)||void 0===e?void 0:e.kind))this._filterReport(n,this._audioStatfilters,this._collectedAudioStats),this._computeCustomAudioStats(n);else{if("video"!==(null===(t=i.track)||void 0===t?void 0:t.kind))throw new Error('sender.track.kind is neither "audio" nor "video"');this._filterReport(n,this._videoStatFilters,this._collectedVideoStats),this._computeCustomVideoStats(n)}this._computeCustomStats()}))}_filterReport(e,t,n){let i,r,s;e.forEach((e=>{if(i=e.type,s=this._getTimestamp(),t[i])for(const a in t[i]){const o=t[i][a];r={value:e[a],timestamp:s},ln(r.value)||this._aggregate(r,o,n)}}))}_aggregate(e,t,n){var i,r;const s=null!==(i=n[r=t.renameTo])&&void 0!==i?i:n[r]={values:[]};if(t.getSerialDiff?this._getSerialDiff(s,e):s.lastValue=Object.assign({},e),t.multiplier&&(e.value=hn(e.value*t.multiplier,2)),t.aggregate&&(s.values.push(e),this._trimValuesToTimeFrame(s.values),t.getMinMaxAvg)){const e=function(e,t){var n,i;function r(e){return e.value}let s=rn(null===(n=nn(e,r))||void 0===n?void 0:n.value),a=rn(null===(i=en(e,r))||void 0===i?void 0:i.value),o=rn(tn(e,r));return s=sn(s,t),a=sn(a,t),o=sn(o,t),{min:s,max:a,avg:o}}(s.values,2);s.min=e.min,s.max=e.max,s.avg=e.avg}}_getTimestamp(){return mn.now()}_getSerialDiff(e,t){if(!e.lastValue)return void(e.lastValue=Object.assign({},t));const n=e.lastValue.value,i=t.value;e.lastValue=Object.assign({},t),t.value=i-n}_getFractionOrZero(e,t){return 0===t||0===e||ln(e)||ln(t)?0:e/t}_findInnerReportValue(e,t,n){const i=e.get(t);return i?i[n]:null}_computeCustomAudioStats(e){var t,n,i,r,s,a,o,c;const d=this._getTimestamp(),l=null===(n=null===(t=this._collectedAudioStats.codecId)||void 0===t?void 0:t.lastValue)||void 0===n?void 0:n.value,u=this._findInnerReportValue(e,l,"mimeType");u?this._collectedAudioStats.codec={values:[],lastValue:{timestamp:d,value:u}}:delete this._collectedAudioStats.codec;const p=null===(s=null===(r=null===(i=this._collectedAudioStats.packetsSent)||void 0===i?void 0:i.values)||void 0===r?void 0:r.at(-1))||void 0===s?void 0:s.value,h=null===(c=null===(o=null===(a=this._collectedAudioStats.packetsLost)||void 0===a?void 0:a.values)||void 0===o?void 0:o.at(-1))||void 0===c?void 0:c.value,m={value:100*this._getFractionOrZero(h,p),timestamp:d};this._aggregate(m,{renameTo:"packetsLostPct",aggregate:!0,getMinMaxAvg:!0,getSerialDiff:!1},this._collectedAudioStats)}_computeCustomVideoStats(e){var t,n,i,r,s,a,o,c,d,l,u;const p=this._getTimestamp(),h=null===(n=null===(t=this._collectedVideoStats.codecId)||void 0===t?void 0:t.lastValue)||void 0===n?void 0:n.value,m=this._findInnerReportValue(e,h,"mimeType");m?this._collectedVideoStats.codec={values:[],lastValue:{timestamp:p,value:m}}:delete this._collectedAudioStats.codec;const f=null===(s=null===(r=null===(i=this._collectedVideoStats.packetsSent)||void 0===i?void 0:i.values)||void 0===r?void 0:r.at(-1))||void 0===s?void 0:s.value,g=null===(c=null===(o=null===(a=this._collectedVideoStats.packetsLost)||void 0===a?void 0:a.values)||void 0===o?void 0:o.at(-1))||void 0===c?void 0:c.value,v={value:100*this._getFractionOrZero(g,f),timestamp:p};this._aggregate(v,{renameTo:"packetsLostPct",aggregate:!0,getMinMaxAvg:!0,getSerialDiff:!1},this._collectedVideoStats);const y=(null===(u=null===(l=null===(d=this._collectedVideoStats.totalPacketSendDelay)||void 0===d?void 0:d.values)||void 0===l?void 0:l.at(-1))||void 0===u?void 0:u.value)/f*1e3;this._aggregate({timestamp:p,value:y},{renameTo:"sendDelay",aggregate:!0,getMinMaxAvg:!0,getSerialDiff:!1},this._collectedVideoStats)}_computeCustomStats(){var e,t,n,i,r,s,a,o,c,d,l,u,p,h,m,f,g,v;const y=this._getTimestamp(),_=this._collectedAudioStats.rtt,b=this._collectedVideoStats.rtt,S=pn(null===(e=null==_?void 0:_.lastValue)||void 0===e?void 0:e.value),C=pn(null===(t=null==b?void 0:b.lastValue)||void 0===t?void 0:t.value),w=(S+C)/(un(S)+un(C));this._aggregate({timestamp:y,value:w},{renameTo:"rtt",multiplier:1e3,aggregate:!0,getMinMaxAvg:!0,getSerialDiff:!1},this._collectedCustomStats);const T=null===(i=null===(n=this._collectedVideoStats.framesEncoded)||void 0===n?void 0:n.lastValue)||void 0===i?void 0:i.value,x=null===(s=null===(r=this._collectedVideoStats.totalEncodeTime)||void 0===r?void 0:r.lastValue)||void 0===s?void 0:s.value;if(T&&x&&this._firstReportTimestamp){const e=100*x/((y-this._firstReportTimestamp)/1e3),t=100-e;this._aggregate({timestamp:y,value:e},{renameTo:"encodeTimePercentage",aggregate:!0,getMinMaxAvg:!0},this._collectedVideoStats),this._aggregate({timestamp:y,value:t},{renameTo:"idleTimePercentage",aggregate:!0,getMinMaxAvg:!0},this._collectedVideoStats),this._aggregate({timestamp:y,value:x},{renameTo:"encodeTime",aggregate:!0,getMinMaxAvg:!0,getSerialDiff:!0},this._collectedVideoStats),this._aggregate({timestamp:y,value:T},{renameTo:"framerate",getSerialDiff:!0,getMinMaxAvg:!0,aggregate:!0},this._collectedVideoStats)}const k=null===(o=null===(a=this._collectedVideoStats.pliCount)||void 0===a?void 0:a.lastValue)||void 0===o?void 0:o.value;k&&this._aggregate({timestamp:y,value:k},{renameTo:"pliFrequency",getSerialDiff:!0,aggregate:!0,getMinMaxAvg:!0},this._collectedVideoStats);const R=pn(null===(d=null===(c=this._collectedAudioStats.packetsLostPct)||void 0===c?void 0:c.lastValue)||void 0===d?void 0:d.value),O=pn(null===(u=null===(l=this._collectedVideoStats.packetsLostPct)||void 0===l?void 0:l.lastValue)||void 0===u?void 0:u.value);let P=0;P=R&&O?(R+O)/2:R+O,this._aggregate({timestamp:y,value:P},{renameTo:"packetLoss",getSerialDiff:!0,aggregate:!0,getMinMaxAvg:!0},this._collectedCustomStats);const E=null===(h=null===(p=this._collectedVideoStats.width)||void 0===p?void 0:p.lastValue)||void 0===h?void 0:h.value,j=null===(f=null===(m=this._collectedVideoStats.height)||void 0===m?void 0:m.lastValue)||void 0===f?void 0:f.value;null!==(g=this._lastVideoWidth)&&void 0!==g||(this._lastVideoWidth=E),null!==(v=this._lastVideoHeight)&&void 0!==v||(this._lastVideoHeight=j);const N=this._lastVideoWidth!=E||this._lastVideoHeight!=j;this._aggregate({timestamp:y,value:N?"1":"0"},{renameTo:"resolutionChanged"},this._collectedVideoStats),N&&(this._lastVideoHeight=j,this._lastVideoWidth=E)}_trimValuesToTimeFrame(e){if(!e.length)return;let t=e[e.length-1],n=e[0],i=t.timestamp-n.timestamp;for(;i>this._config.timeFrameMs;)e.shift(),n=e[0],t=e[e.length-1],i=t.timestamp-n.timestamp}}var gn=function(e,t,n,i){return new(n||(n=Promise))((function(r,s){function a(e){try{c(i.next(e))}catch(e){s(e)}}function o(e){try{c(i.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}c((i=i.apply(e,t||[])).next())}))};const{isEmpty:vn}=e,{debug:yn,log:_n,info:bn,error:Sn}=g("upstream-connection");class Cn{constructor(e){this._inputCfg=e,this._mediaStreamCfg=null,this._broadcastCfg=null,this._mediaStream=null,this._activeStreamConstraints=null,this._peerConnection=null,this._answerSdp=null,this._statsCollector=null,this._statsCollectIntervalTimer=null,this._mediaStreamCfg=this._inputCfg.mediaStreamCfg,this._broadcastCfg=this._inputCfg.broadcastCfg,this._isMuted=this._handleIsMutedInitConfig(this._inputCfg.muted,this._inputCfg.mediaStream),bn("created UpstreamConnection with config:",this._mediaStreamCfg,"_broadcastCfg:",this._broadcastCfg,"_isMuted:",this._isMuted)}get isMuted(){return this._isMuted}get connectionState(){var e;return(null===(e=this._peerConnection)||void 0===e?void 0:e.connectionState)||null}get iceState(){var e;return(null===(e=this._peerConnection)||void 0===e?void 0:e.iceConnectionState)||null}get gatheringState(){var e;return(null===(e=this._peerConnection)||void 0===e?void 0:e.iceGatheringState)||null}get localDescription(){var e;return(null===(e=this._peerConnection)||void 0===e?void 0:e.localDescription)||null}get remoteDescription(){var e;return(null===(e=this._peerConnection)||void 0===e?void 0:e.remoteDescription)||null}onPeerConnectionEvent(e){}onConnectionStateChange(e){}onMediaStreamEvent(e){}getMediaStream(){return this._mediaStream}hasRemoteDescription(){var e;return!!(null===(e=this._peerConnection)||void 0===e?void 0:e.remoteDescription)}getActiveConstraints(){return this._activeStreamConstraints}getAppliedSettings(){if(!this._mediaStream)throw new Error("Cannot obtain media stream settings as upstreamConnection is not setup");return{audio:Xt.getAudioTrackSettings(this._mediaStream),video:Xt.getVideoTrackSettings(this._mediaStream)}}getAudioVideoOnly(){if(!this._mediaStream)throw new Error("Cannot obtain info if the media stream is audioVideoOnly as one does not exist");const e=this._mediaStream.getAudioTracks().length,t=this._mediaStream.getVideoTracks().length;return e&&t?null:e?"audio":"video"}createMediaStream(){return gn(this,void 0,void 0,(function*(){if(bn("Configuring input MediaStream"),this._mediaStream)throw Gt.StreamError("Cannot setup as media stream already exists");let e=this._inputCfg.mediaStream,t=null;e?t=Xt.getSyntheticMediaStreamConstraints(e):(bn("Creating new MediaStream internally (no user-provided set in config)"),[e,t]=yield this._createMediaStream(this._mediaStreamCfg)),this._mediaStream=e,this._activeStreamConstraints=t;const n=e=>{this.onMediaStreamEvent(e)};this._mediaStream.onaddtrack=n,this._mediaStream.onremovetrack=n,this._mediaStream.getTracks().forEach((e=>{e.onended=n,e.onmute=n,e.onunmute=n})),bn("Applying initial muted setting to media-stream:",this._isMuted),this.setMuted(this._isMuted)}))}createOffer(e={}){return gn(this,void 0,void 0,(function*(){if(this._peerConnection)throw Gt.StreamError("Cannot create an offer as peerconnection already exists");if(!this._mediaStream)throw Gt.StreamError("Cannot create an offer as upstreamConnection is not setup");const t=this._peerConnection=new RTCPeerConnection(e),n=e=>{this.onPeerConnectionEvent(e)};t.onconnectionstatechange=e=>{this.onConnectionStateChange(t.connectionState),n(e)},t.oniceconnectionstatechange=n,t.onicecandidate=n,t.onicecandidateerror=n,t.onicegatheringstatechange=n,t.onnegotiationneeded=n,t.onsignalingstatechange=n,t.ontrack=n;const i=this._statsCollector=new fn({collectPeriodMs:1e3,timeFrameMs:1e4});this._mediaStream.getTracks().forEach((e=>{yn("peerconnection: added transceiver for track:",e.id,e.kind);const n=t.addTransceiver(e,{direction:"sendonly"});i.addSelector(n.sender)}));const r=yield t.createOffer();if(!r.sdp)throw new Error("Connection offer has empty SDP");const s=new RTCSessionDescription({type:r.type,sdp:Qt.preferCodec(r.sdp,"h264")});return yield t.setLocalDescription(s),s}))}_handleIsMutedInitConfig(e,t){const n=Et(),i=n.inputCfg.muted.audio,r=n.inputCfg.muted.video;let s=t?!t.getAudioTracks().some((e=>e.enabled)):i,a=t?!t.getVideoTracks().some((e=>e.enabled)):r;return s=void 0!==(null==e?void 0:e.audio)?e.audio:s,a=void 0!==(null==e?void 0:e.video)?e.video:a,{audio:s,video:a}}onRtcStats(e){}_isStatsCollectorRunning(){return null!==this._statsCollectIntervalTimer}_startStatsCollector(){var e;if(this._isStatsCollectorRunning())throw new Error("Stats collection task is already running");null===(e=this._statsCollector)||void 0===e||e.start(),this._statsCollectIntervalTimer=window.setInterval((()=>{if(this._statsCollector){const e=this._statsCollector.pullData();this.onRtcStats(e)}}),1e3)}_stopStatsCollector(){var e;if(!this._isStatsCollectorRunning())throw new Error("Stats collection task not running");null===(e=this._statsCollector)||void 0===e||e.reset(),this._statsCollector=null,window.clearInterval(this._statsCollectIntervalTimer),this._statsCollectIntervalTimer=null}setAnswer(e){return gn(this,void 0,void 0,(function*(){if(bn("setAnswer()"),!this._peerConnection)throw Gt.StreamError("Cannot set answer as peerconnection does not exist");if(this._answerSdp)throw Gt.StreamError("Cannot set answer as one already exists");const t=this._answerSdp=new RTCSessionDescription({type:"answer",sdp:e});yn("calling peer-conn setRemoteDescription:",t),yield this._peerConnection.setRemoteDescription(t),bn("remote SDP (answer) set successfully");const n=yield this._applySendersConstraints();bn("sender constraints applied, result:",n),this._startStatsCollector()}))}setMuted(e){var t,n;_n("setMuted:",e);const i=Et();this._isMuted=e=Object.assign({},i.inputCfg.muted,e);const{audio:r,video:s}=this._isMuted;null===(t=this._mediaStream)||void 0===t||t.getAudioTracks().forEach((e=>{e.enabled===r&&(e.enabled=!r,yn((e.enabled?"enabled":"disabled")+" audio track:",e.id))})),null===(n=this._mediaStream)||void 0===n||n.getVideoTracks().forEach((e=>{e.enabled===s&&(e.enabled=!s,yn((e.enabled?"enabled":"disabled")+" video track:",e.id))}))}resetConnection(){var e;if(bn("resetConnection()"),!this._peerConnection)throw Gt.StreamError("Cannot reset the connection as it does not exist");(null===(e=this._statsCollector)||void 0===e?void 0:e.isRunning())&&this._stopStatsCollector(),this._answerSdp=null,this._peerConnection.close(),this._peerConnection=null}dispose(e=!1){bn("dispose() - withMediaStream=",e),this._peerConnection&&this.resetConnection(),e&&this._mediaStream&&(_n("Disposing MediaStream"),Xt.disposeStream(this._mediaStream)),this._mediaStream=null}_createMediaStream(e){return gn(this,void 0,void 0,(function*(){if(!e){const e={audio:!0,video:!0};bn("MediaStream creation without MediaStreamCfg, using default constraints:",e);const t=yield Xt.createStream(e);return _n("MediaStream created successfully"),[t,e]}const{maxFramerate:t,resolution:n,audioVideoOnly:i,audioConstraints:r}=e;let s={};if(n){const[e,t]=n;s={width:e,height:t}}const a=null==e?void 0:e.audioDeviceId,o=null==e?void 0:e.videoDeviceId,c={audio:{deviceId:a},video:Object.assign({deviceId:o,frameRate:t},s)};"video"!==i&&r&&(c.audio=Object.assign(c.audio||{},Object.assign({},r))),"video"===i?c.audio=!1:"audio"===i&&(c.video=!1),bn("MediaStream create attempt: config resulting constraints:",c);const d=yield Xt.createStream(c);return _n("MediaStream created successfully"),[d,c]}))}_applySendersConstraints(){return gn(this,void 0,void 0,(function*(){const e=this._broadcastCfg,t=this.getAudioVideoOnly();bn("_applySendersConstraints() - audioVideoOnly:",t);const n={maxBitrate:null==e?void 0:e.maxAudioBitrateBps},i={maxFramerate:null==e?void 0:e.maxEncodingFramerate,maxBitrate:null==e?void 0:e.maxVideoBitrateBps},r=[Promise.resolve(null),Promise.resolve(null)];vn(n)||"video"===t||(_n("setting audio encoding params:",n),r[0]=this._setSenderEncodingParams("audio",n)),vn(i)||"audio"===t||(_n("setting video encoding params:",i),r[1]=this._setSenderEncodingParams("video",i));try{return yield Promise.all(r)}catch(e){const t=e;throw Sn("_applySendersConstraints:",t),new Error("Fatal error setting encoder params:"+t.message)}}))}_setSenderEncodingParams(e,t){var n;return gn(this,void 0,void 0,(function*(){if(!this._peerConnection)throw Gt.StreamError("Cannot set an encoding option as peerconnection does not exist");const i=this._peerConnection.getSenders().filter((t=>{var n;return(null===(n=t.track)||void 0===n?void 0:n.kind)===e}));if(!i.length)throw Gt.StreamError(`Cannot set any encoding params as there are no senders of kind '${e}'`);const r=i[0],s=r.getParameters();(null===(n=s.encodings)||void 0===n?void 0:n.length)||(s.encodings=[{}]),s.encodings[0]=Object.assign({},s.encodings[0],t),yn("calling RTCRtpSender.setParameters():",s);try{yield r.setParameters(s)}catch(t){return Sn("RTCRtpSender.setParameters error:",t),new Error(`For sender of kind ${e} setParameters(${JSON.stringify(s)}) failed with error:`+t.message)}return _n("Successfully set encoding params for track kind:",e),null}))}}var wn=function(e,t,n,i){return new(n||(n=Promise))((function(r,s){function a(e){try{c(i.next(e))}catch(e){s(e)}}function o(e){try{c(i.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}c((i=i.apply(e,t||[])).next())}))};function Tn(e){const t={};return e.forEach(((e,n)=>{t[n]=e})),t}var xn=function(e,t,n,i){return new(n||(n=Promise))((function(r,s){function a(e){try{c(i.next(e))}catch(e){s(e)}}function o(e){try{c(i.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}c((i=i.apply(e,t||[])).next())}))};const{removeLastPathPart:kn}=e;function Rn(e){let t="";return t+=e.streamName?`stream_name=${e.streamName}`:"",t+=e.ingestUrl?`&stream_url=${e.ingestUrl}`:"",t+=e.audioRateBps?`&audio_bitrate=${e.audioRateBps}`:"",t+=e.connectInfo?`&connect_info=${e.connectInfo}`:"",t}class On{static createResource(e,t,n){return xn(this,void 0,void 0,(function*(){const i={};!function(e,t){e.token&&(t.Authorization=`Bearer ${e.token}`)}(n,i);const r=`${e}?${Rn(n)}`,s=yield On._doCall(r,"POST",t,i),a=s.headers.location;if(!a)throw new Error("Response header contains no Location field");const o=a.split("/").pop();if(!o)throw new Error(`Location field of response header seems malformed (expecting URL/path): ${a}`);const c=s.data;if(!c)throw new Error("Response body is empty, but expecting SDP data");return{resourceId:o,location:a,answerSdp:c,resolvedServerUrl:kn(a)}}))}static deleteResource(e,t){return xn(this,void 0,void 0,(function*(){return(yield On._doCall(`${e}/${t}`,"DELETE")).data}))}static sendMetadata(e,t,n){return xn(this,void 0,void 0,(function*(){return(yield On._doCall(`${e}/${t}/metadata`,"POST",JSON.stringify(n),{"Content-Type":"application/json"})).data}))}static addSink(e,t,n){return xn(this,void 0,void 0,(function*(){const i=`${e}/${t}/sink?${Rn(n)}`;return yield On._doCall(i,"POST")}))}static getSinks(e,t){return xn(this,void 0,void 0,(function*(){const n=yield On._doCall(`${e}/${t}/sink`,"GET");return JSON.parse(n.data)}))}static deleteSink(e,t,n){return xn(this,void 0,void 0,(function*(){return yield On._doCall(`${e}/${t}/sink/${n}`,"DELETE")}))}static getServerStatusInfo(e){return xn(this,void 0,void 0,(function*(){const t=yield On._doCall(`${e}/status.json`,"GET");return JSON.parse(t.data)}))}static _doCall(e,t,n,i={}){return xn(this,void 0,void 0,(function*(){const r=Object.assign({"Content-Type":"text/plain"},i),s={method:t,mode:"cors",cache:"no-cache",credentials:"same-origin",headers:r,body:n};let a;try{a=yield fetch(e,s)}catch(e){const t=e;throw Gt.ServerRequestError(t.message,{request:s})}const o=Tn(a.headers);let c;try{c=yield a.text()}catch(e){const t=e;throw Gt.ServerRequestError("Failed to read response: "+t.message)}if(!a.ok)throw Gt.ServerRequestError("Bad response status: "+a.status,{responseText:c});return{data:c,headers:o}}))}}var Pn=function(e,t,n,i){return new(n||(n=Promise))((function(r,s){function a(e){try{c(i.next(e))}catch(e){s(e)}}function o(e){try{c(i.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}c((i=i.apply(e,t||[])).next())}))};class En{get _authToken(){var e;return(null===(e=this._config.auth)||void 0===e?void 0:e.token)||""}constructor(e){this._config=e,this._resource=null,this._requestPending=!1,this._baseUrl=e.serverUrl}createResource(e,t){return Pn(this,void 0,void 0,(function*(){if(this._resource)throw new Error("Cannot create a resource as one already exists");const{streamName:n,ingestUrl:i}=this._config,r={streamName:null!=n?n:"",ingestUrl:i,token:this._authToken};if(t&&Object.assign(r,t),yield this._assertNoRequestPendingCall((()=>Pn(this,void 0,void 0,(function*(){this._resource=yield On.createResource(this._baseUrl,e.sdp,r)})))),!this._resource)throw new Error("createResource did not set internal member");return this._resource}))}getResource(){return this._resource}deleteResource(){return Pn(this,void 0,void 0,(function*(){yield this._assertNoRequestPendingCall((()=>Pn(this,void 0,void 0,(function*(){if(!this._resource)throw new Error("Cannot delete resource which does not exist");const{resolvedServerUrl:e,resourceId:t}=this._resource;this._resource=null,yield On.deleteResource(e,t)}))))}))}sendMetadata(e,t){return Pn(this,void 0,void 0,(function*(){if(!this._resource)throw new Error("Cannot send metadata as resource does not exist.");const n={handlerName:e,payload:t},{resolvedServerUrl:i,resourceId:r}=this._resource;return On.sendMetadata(i,r,n)}))}dispose(){return Pn(this,void 0,void 0,(function*(){this._resource&&(yield this.deleteResource())}))}_assertNoRequestPendingCall(e){return Pn(this,void 0,void 0,(function*(){if(this._requestPending)throw new Error("A client request is already pending");let t;this._requestPending=!0;try{t=yield e()}catch(e){throw this._requestPending=!1,e}return this._requestPending=!1,t}))}}var jn=n(428);const Nn=Object.freeze({RECEIVED_WEB_RTC_STATS:"RECEIVED_WEB_RTC_STATS",SETUP_ERROR:"SETUP_ERROR",PREVIEW_ERROR:"PREVIEW_ERROR",START_BROADCAST_ERROR:"START_BROADCAST_ERROR",STOP_BROADCAST_ERROR:"STOP_BROADCAST_ERROR",GET_MEDIA_STREAM_SETTINGS_ERROR:"GET_MEDIA_STREAM_SETTINGS_ERROR",DISPOSE_ERROR:"DISPOSE_ERROR"});var Mn=function(e,t,n,i){return new(n||(n=Promise))((function(r,s){function a(e){try{c(i.next(e))}catch(e){s(e)}}function o(e){try{c(i.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}c((i=i.apply(e,t||[])).next())}))};const{filterObjectByMask:Dn,msToSecs:In,roundToPrecision:An}=e,{log:Ln,error:Vn}=g("MetricsFunnel");const Zn=performance;class Fn{constructor(e,t){this._metricsAccount=e,this._metricsConfig=t,this._sendPeriodMs=1e4,this._emitIntervalTimer=null,this._sendIntervalTimer=null,this._broadcastStartTime=null,this._metricsResultDataDefaults={clientVersion:"",broadcastStatus:{peerConnectionState:"",iceConnectionState:"",iceGatheringState:"",startUpTime:NaN,totalTime:NaN,reconnects:NaN},stream:{name:"",url:""},server:{url:"",host:"",resourceId:""},userAgent:null,rtcstats:{video:{bitrate:{value:NaN,min:NaN,max:NaN,avg:NaN},codec:{value:""},framerate:{value:NaN,min:NaN,max:NaN,avg:NaN},height:{value:NaN,min:NaN,max:NaN,avg:NaN},width:{value:NaN,min:NaN,max:NaN,avg:NaN},jitter:{value:NaN,min:NaN,max:NaN,avg:NaN},rtt:{value:NaN,min:NaN,max:NaN,avg:NaN},sendDelay:{value:NaN,min:NaN,max:NaN,avg:NaN}},audio:{bitrate:{value:NaN,min:NaN,max:NaN,avg:NaN},codec:{value:""},jitter:{value:NaN,min:NaN,max:NaN,avg:NaN},rtt:{value:NaN,min:NaN,max:NaN,avg:NaN}},connection:{rtt:{value:NaN,min:NaN,max:NaN,avg:NaN},packetLoss:{value:NaN,min:NaN,max:NaN,avg:NaN}}}},this._metricsEndpoint=this._metricsConfig.sendUrl+this._metricsAccount.application_account_id,this._metrics={},this._setDefaults(),this._emit(this._metrics)}put(e,t){this._metrics[e]=t}putPartial(e,t){const n=this._metrics[e];this._metrics[e]=Object.assign({},n,t)}onMetrics(e){}start(){this._emitIntervalTimer=window.setInterval((()=>{this._updateBroadcastTime(),this._emit(this._metrics)}),this._metricsConfig.emitPeriodMs),this._sendIntervalTimer=window.setInterval((()=>{this._updateBroadcastTime(),this._send(this._metrics)}),this._sendPeriodMs)}stop(){window.clearInterval(this._emitIntervalTimer),window.clearInterval(this._sendIntervalTimer)}setStartTime(){this._broadcastStartTime=this._getTimestamp()}putBroadcastStartupTime(){const e=this._getTimestamp(),t=In(e-(this._broadcastStartTime||e));this.putPartial("broadcastStatus",{startUpTime:An(t,2)})}putError(e,t){return Mn(this,void 0,void 0,(function*(){const n=Object.assign({},this._metrics,{message:e,errorMessage:t.message,errorCode:t.code});this._send(n),this._emit(n)}))}_getTimestamp(){return Zn.now()}_updateBroadcastTime(){const e=this._getTimestamp(),t=In(e-(this._broadcastStartTime||e));this.putPartial("broadcastStatus",{totalTime:An(t,2)})}_setDefaults(){var e,t,n,i,r,s,a,o,c,d,l,u,p,h;const m=(new jn.UAParser).getResult(),f={document:{origin:null===(e=null===document||void 0===document?void 0:document.location)||void 0===e?void 0:e.origin,pathName:null===(t=null===document||void 0===document?void 0:document.location)||void 0===t?void 0:t.pathname,referrer:null===(n=null===document||void 0===document?void 0:document.location)||void 0===n?void 0:n.href,search:null===(i=null===document||void 0===document?void 0:document.location)||void 0===i?void 0:i.search},browser:{name:null===(r=null==m?void 0:m.browser)||void 0===r?void 0:r.name,version:null===(s=null==m?void 0:m.browser)||void 0===s?void 0:s.version,engine:null===(a=null==m?void 0:m.engine)||void 0===a?void 0:a.name,engineVersion:null===(o=null==m?void 0:m.engine)||void 0===o?void 0:o.version},os:{name:null===(c=null==m?void 0:m.os)||void 0===c?void 0:c.name,version:null===(d=null==m?void 0:m.os)||void 0===d?void 0:d.version},cpu:{architecture:null===(l=null==m?void 0:m.cpu)||void 0===l?void 0:l.architecture},device:{model:null===(u=null==m?void 0:m.device)||void 0===u?void 0:u.model,type:null===(p=null==m?void 0:m.device)||void 0===p?void 0:p.type,vendor:null===(h=null==m?void 0:m.device)||void 0===h?void 0:h.vendor}};this._metrics=Object.assign(Object.assign({},this._metricsAccount),{clientVersion:"6.1.0",message:Nn.RECEIVED_WEB_RTC_STATS,userAgent:f})}_filterMetricsByDefaults(e){return Dn(e,this._metricsResultDataDefaults,!0)}_emit(e){const t=this._filterMetricsByDefaults(e);this.onMetrics(t)}_send(e){return Mn(this,void 0,void 0,(function*(){let t;try{t=JSON.stringify(e)}catch(e){return void Vn("Error stringifying metrics:",e)}try{yield function(e,t,n,i={}){return wn(this,void 0,void 0,(function*(){const r=Object.assign({"Content-Type":"text/plain"},i),s={method:t,mode:"cors",cache:"no-cache",credentials:"same-origin",headers:r,body:n};let a;try{a=yield fetch(e,s)}catch(e){const t=e;throw Gt.ServerRequestError(t.message,{request:s})}const o=Tn(a.headers);let c;try{c=yield a.text()}catch(e){const t=e;throw Gt.ServerRequestError("Failed to read response: "+t.message)}if(!a.ok)throw Gt.ServerRequestError("Bad response status: "+a.status,{responseText:c});return{data:c,headers:o}}))}(this._metricsEndpoint,"POST",t)}catch(e){Vn("Error sending metrics request:",e)}}))}}var Un=function(e,t,n,i){return new(n||(n=Promise))((function(r,s){function a(e){try{c(i.next(e))}catch(e){s(e)}}function o(e){try{c(i.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}c((i=i.apply(e,t||[])).next())}))};const{cloneSerializable:Bn,isEmpty:$n,isUndefined:zn}=e,{log:qn,info:Gn,warn:Wn,error:Kn,debug:Jn}=g("webcaster");var Hn;!function(e){e.Idle="idle",e.Reconnecting="reconnecting",e.Failed="failed"}(Hn||(Hn={}));class Xn{constructor(e){this._previewVidElList=[],this._reconnectionState=null,this._reconnects=0,this._config=function(e){return zt(e,$t)}(e),Gn("Creating new client instance from config:",this._config);const[t,n,i]=this._init();this._upstreamConnection=t,this._whipClient=n,this._metricsFunnel=i}onReconnectionStateChange(e){}onConnectionStateChange(e){}onStateChange(){}onError(e){}onMetrics(e){}setup(){return Un(this,void 0,void 0,(function*(){Gn("Setting up the webcaster instance");try{yield this._upstreamConnection.createMediaStream()}catch(e){this._handleStreamError("Failure on attempt creating stream",Nn.SETUP_ERROR,e)}return this._emitOnStateChange(),this._emitOnReconnectionStateChange(Hn.Idle),Bn(this._config)}))}startPreview(e){this._assertHaveMediaStream(),Gn("Starting preview on video-element with id:",e);const t=e||this._config.previewVideoElId;t||this._handleStreamError("Preview video-element id needs to be set in config if not passed as argument",Nn.PREVIEW_ERROR);const n=document.getElementById(t);n||this._handleStreamError(`HTML document does not contain element id: ${t}`,Nn.PREVIEW_ERROR),this._addPreviewVideoEl(n)}startBroadcast(){var e,t,n,i,r,s;return Un(this,void 0,void 0,(function*(){this._assertHaveMediaStream(),Gn("Starting broadcast"),this._metricsFunnel.start(),this._metricsFunnel.setStartTime();const a=null===(n=null===(t=null===(e=this._config)||void 0===e?void 0:e.inputCfg)||void 0===t?void 0:t.broadcastCfg)||void 0===n?void 0:n.transcodeAudioBitrateBps;try{qn("Creating RTC offer SDP");const e=yield this._upstreamConnection.createOffer();qn("Calling createResource with offer and sink-params");const t={audioRateBps:a},n=yield this._whipClient.createResource(e,t),o=null===(r=null===(i=n.location.split("//"))||void 0===i?void 0:i[1].split("."))||void 0===r?void 0:r[0];this._metricsFunnel.put("server",{url:this._config.serverUrl,host:o,resourceId:n.resourceId}),this._metricsFunnel.put("stream",{name:null!==(s=this._config.streamName)&&void 0!==s?s:"",url:this._config.ingestUrl}),qn("Setting received answer SDP"),yield this._upstreamConnection.setAnswer(n.answerSdp),this._metricsFunnel.putBroadcastStartupTime()}catch(e){const t=e;this._handleStreamError("Failed starting broadcast",Nn.START_BROADCAST_ERROR,t)}this._emitOnStateChange()}))}stopBroadcast(){return Un(this,void 0,void 0,(function*(){Gn("Stopping the broadcast"),this._assertHaveMediaStream();try{yield this._whipClient.deleteResource()}catch(e){Kn("Deleting resource only on the client-side",e)}try{this._upstreamConnection.resetConnection()}catch(e){this._handleStreamError("Failed stopping broadcast",Nn.STOP_BROADCAST_ERROR,e)}this._metricsFunnel.stop(),this._emitOnStateChange()}))}getConfiguredConstraints(){return this._upstreamConnection.getActiveConstraints()}getMediaStreamSettings(){this._assertHaveMediaStream();try{return this._upstreamConnection.getAppliedSettings()}catch(e){this._handleStreamError("Failed to obtain media stream settings",Nn.GET_MEDIA_STREAM_SETTINGS_ERROR,e)}return{audio:null,video:null}}getUpstreamStatus(){const{connectionState:e,iceState:t,gatheringState:n,localDescription:i,remoteDescription:r}=this._upstreamConnection;return{connectionState:e,iceState:t,gatheringState:n,localDescription:Bn(i),remoteDescription:Bn(r)}}setMuted(e){const t=zt(e,Vt);this._upstreamConnection.setMuted(t)}isMuted(){return this._upstreamConnection.isMuted}dispose(e=!1){return Un(this,void 0,void 0,(function*(){Gn("Disposing the Webcaster instance"),this._assertHaveMediaStream();try{this._upstreamConnection.hasRemoteDescription()&&(yield this.stopBroadcast()),yield this._whipClient.dispose(),this._upstreamConnection.dispose(e),this._previewVidElList.forEach((e=>{e.srcObject=null})),this._previewVidElList.length=0,this._reconnectionState=null,this._reconnects=0}catch(e){this._handleStreamError("Failed to dispose",Nn.DISPOSE_ERROR,e)}}))}_startReconnecting(){return Un(this,void 0,void 0,(function*(){if(!this._config.reconnect)return;if(this._reconnectionState===Hn.Reconnecting)return void qn("Webcaster is already reconnecting.");Gn("Started reconnecting.");const{maxDelaySec:t,minDelaySec:n,maxRetries:i}=this._config.reconnect,r=1e3*t,s=1e3*n;let a=0,o=s;const c=Math.max(i,2),d=e.exponentialBaseOnRange(s,r,c);for(this._emitOnReconnectionStateChange(Hn.Reconnecting);a<i;){if(a++,qn(`Attempting to reconnect...Try #${a} with delay: ${o} ms`),yield this._reconnect(o))return qn("Reconnected successfully!"),this._emitOnReconnectionStateChange(Hn.Idle),void this._metricsFunnel.putPartial("broadcastStatus",{reconnects:++this._reconnects});o=o<r?Math.min(o*d,r):r}qn("Max retries reached. Stopping attempts to reconnect."),this._emitOnReconnectionStateChange(Hn.Failed)}))}_reconnect(t){return Un(this,void 0,void 0,(function*(){try{return qn("Cleaning up before reconnect"),yield this.stopBroadcast(),yield e.wait(t),yield this.startBroadcast(),!0}catch(e){return Kn("Reconnect attempt failed",e),!1}}))}recover(e=!1){var t;return Un(this,void 0,void 0,(function*(){if(Gn("recover called, disposeMediaStream=",e),(null===(t=this._config.inputCfg)||void 0===t?void 0:t.mediaStream)&&e)throw new Error("Can not recover a user-provided stream, please call this method without `disposeMediaStream` flag");const n=!!this._upstreamConnection.getMediaStream(),i=this._upstreamConnection.hasRemoteDescription(),r=this._previewVidElList.slice();qn("saved prior state before dispose call - wasSetup:",n,"wasCasting:",i,"previewVidEls:",r);try{if(n&&(yield this.dispose(e)),this._init(),n){qn("attempt recovering setup state");const e=yield this.setup();qn("recovered setup with config:",e),r.forEach((e=>{try{this._addPreviewVideoEl(e)}catch(e){Wn("recovering startPreview failed with error:",e)}})),i&&(qn("attempt recovering broacast state"),yield this.startBroadcast())}}catch(e){throw Kn("Recovery failing error:",e),new Error("Failed recovery routine, internal message: "+e.message)}}))}sendMetadata(e,t){return Un(this,void 0,void 0,(function*(){if(Gn("Sending metadata"),this._assertHaveMediaStream(),this._assertHaveRemoteDescription(),zn(t))throw Gt.GeneralError("Metadata object should be defined");if($n(t))throw Gt.GeneralError("Metadata object should not be empty");yield this._whipClient.sendMetadata(e,t)}))}_init(){return qn("internal init called"),this._metricsFunnel=new Fn({application_name:"webrtc-client",application_account_id:this._config.metrics.accountId,application_account_key:this._config.metrics.accountKey,application_event_id:""},{emitPeriodMs:1e3,sendUrl:"https://glog1.nanocosmos.de/gelf/"}),this._metricsFunnel.onMetrics=e=>{this._emitOnMetrics(e)},this._upstreamConnection=new Cn(this._config.inputCfg),this._upstreamConnection.onPeerConnectionEvent=()=>{const{connectionState:e,iceState:t,gatheringState:n}=this.getUpstreamStatus();this._metricsFunnel.putPartial("broadcastStatus",{peerConnectionState:null!=e?e:"",iceConnectionState:null!=t?t:"",iceGatheringState:null!=n?n:""}),"failed"!==t&&"failed"!==e||this._startReconnecting(),this._emitOnStateChange()},this._upstreamConnection.onMediaStreamEvent=()=>{this._emitOnStateChange()},this._upstreamConnection.onRtcStats=e=>{this._metricsFunnel.put("rtcstats",e)},this._upstreamConnection.onConnectionStateChange=e=>{this._emitOnConnectionStateChange(e)},this._whipClient=new En(this._config),qn("internal init succeeded"),[this._upstreamConnection,this._whipClient,this._metricsFunnel]}_addPreviewVideoEl(e){const t=this._assertHaveMediaStream();"VIDEO"!==e.tagName&&this._handleStreamError("Provided element is not a video tag",Nn.PREVIEW_ERROR),(e.srcObject||e.src)&&this._handleStreamError("Preview video-element already has a source set (this may have been called twice with same arguments)",Nn.PREVIEW_ERROR),this._previewVidElList.push(e),e.srcObject=t,qn("Added preview video-element with id:",e.id)}_emitOnStateChange(){this.onStateChange&&this.onStateChange()}_emitOnError(e){this.onError&&this.onError(e)}_emitOnMetrics(e){this.onMetrics&&this.onMetrics(Bn(e))}_emitOnConnectionStateChange(e){this.onConnectionStateChange&&this.onConnectionStateChange(e)}_emitOnReconnectionStateChange(e){this._reconnectionState=e,this.onReconnectionStateChange&&this.onReconnectionStateChange(e)}_handleStreamError(e,t,n){Kn("_handleStreamError:",e,n);const i=Gt.StreamError(`${e}${n?": "+n.message:""}`);throw this._metricsFunnel.putError(t,i),this._emitOnError(i),i}_assertHaveMediaStream(){const e=this._upstreamConnection.getMediaStream();if(!e)throw Gt.GeneralError("Webcaster is not set up (no MediaStream exists yet)");return e}_assertHaveRemoteDescription(){if(!this._upstreamConnection.hasRemoteDescription())throw Gt.GeneralError("Webcaster has not started broadcast (no remote description exists yet)")}}n(404);f({level:o.TRACE,enableDebug:!1},!0);const Yn="6.1.0",Qn="75cf24b09cfd62a3b8a00565f5e1796f69776cdd"})(),i})()));